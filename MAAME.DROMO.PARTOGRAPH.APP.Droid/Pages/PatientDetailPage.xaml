<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.PatientDetailPage"
             xmlns:cards="clr-namespace:Syncfusion.Maui.Cards;assembly=Syncfusion.Maui.Cards"
             xmlns:buttons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
             xmlns:core="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
             xmlns:effects="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
             xmlns:picker="clr-namespace:Syncfusion.Maui.Picker;assembly=Syncfusion.Maui.Picker"
             xmlns:editors="clr-namespace:Syncfusion.Maui.Inputs;assembly=Syncfusion.Maui.Inputs"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:models="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Models"
             xmlns:fonts="clr-namespace:Fonts"
             Title="Patient Registration"
             BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#121212}">
    <!--<ContentPage.ToolbarItems>
        <ToolbarItem Text="Edit" 
                     Command="{Binding ToggleEditModeCommand}"/>
        --><!--IconImageSource="{FontImageSource FontFamily={x:Static fonts:FluentUI.FontFamily}, Glyph=&#xE70F;, Color=White}"--><!--
        <ToolbarItem Text="Delete" 
                     Command="{Binding DeleteCommand}" />
        --><!--IconImageSource="{FontImageSource FontFamily={x:Static fonts:FluentUI.FontFamily}, Glyph=&#xE74D;, Color=White}"--><!--
    </ContentPage.ToolbarItems>-->


    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Hospital Theme Colors -->
            <Color x:Key="PrimaryBlue">#0078D4</Color>
            <Color x:Key="PrimaryLightBlue">#40E0FF</Color>
            <Color x:Key="SecondaryGreen">#107C10</Color>
            <Color x:Key="AccentTeal">#008575</Color>
            <Color x:Key="SurfaceWhite">#FFFFFF</Color>
            <Color x:Key="BackgroundGray">#F8F9FA</Color>
            <Color x:Key="TextPrimary">#323130</Color>
            <Color x:Key="TextSecondary">#605E5C</Color>
            <Color x:Key="BorderLight">#E1DFDD</Color>
            <Color x:Key="ErrorRed">#D13438</Color>
            <Color x:Key="SuccessGreen">#107C10</Color>
            <Color x:Key="WarningOrange">#FF8C00</Color>

            <!-- Gradients -->
            <LinearGradientBrush x:Key="HeaderGradient" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#0078D4" Offset="0.0" />
                <GradientStop Color="#40E0FF" Offset="1.0" />
            </LinearGradientBrush>

            <!-- Card Styles -->
            <Style x:Key="SectionCard" TargetType="cards:SfCardView">
                <Setter Property="BackgroundColor" Value="{StaticResource SurfaceWhite}" />
                <Setter Property="CornerRadius" Value="16" />
                <Setter Property="Shadow" Value="True" />
                <Setter Property="Margin" Value="16,8" />
            </Style>

            <Style x:Key="HeaderCard" TargetType="cards:SfCardView">
                <Setter Property="Background" Value="{StaticResource HeaderGradient}" />
                <Setter Property="CornerRadius" Value="20" />
                <Setter Property="Shadow" Value="True" />
                <Setter Property="Margin" Value="16,16,16,8" />
            </Style>

            <!-- Button Styles -->
            <Style x:Key="PrimaryButton" TargetType="buttons:SfButton">
                <Setter Property="Background" Value="{StaticResource PrimaryBlue}" />
                <Setter Property="TextColor" Value="{StaticResource SurfaceWhite}" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HeightRequest" Value="50" />
            </Style>

            <Style x:Key="SecondaryButton" TargetType="buttons:SfButton">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="TextColor" Value="{StaticResource PrimaryBlue}" />
                <Setter Property="Stroke" Value="{StaticResource PrimaryBlue}" />
                <Setter Property="StrokeThickness" Value="2" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HeightRequest" Value="48" />
            </Style>

            <!-- Input Styles -->
            <Style x:Key="PatientInput" TargetType="core:SfTextInputLayout">
                <Setter Property="ContainerType" Value="Outlined" />
                <Setter Property="OutlineCornerRadius" Value="8" />
                <!--<Setter Property="Stroke" Value="{StaticResource BorderLight}" />-->
                <!--<Setter Property="FocusedStroke" Value="{StaticResource PrimaryBlue}" />-->
                <!--<Setter Property="ContainerBackground" Value="{StaticResource SurfaceWhite}" />-->
                <!--<Setter Property="Margin" Value="0,4" />-->
            </Style>

            <!-- Typography Styles -->
            <Style x:Key="SectionTitle" TargetType="Label">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource TextPrimary}" />
                <Setter Property="Margin" Value="0,0,0,8" />
            </Style>

            <Style x:Key="HeaderTitle" TargetType="Label">
                <Setter Property="FontSize" Value="24" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource SurfaceWhite}" />
                <Setter Property="HorizontalTextAlignment" Value="Center" />
            </Style>

            <Style x:Key="HeaderSubtitle" TargetType="Label">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TextColor" Value="#E6FFFFFF" />
                <Setter Property="HorizontalTextAlignment" Value="Center" />
            </Style>

            <Style x:Key="ErrorText" TargetType="Label">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="TextColor" Value="{StaticResource ErrorRed}" />
                <Setter Property="HorizontalTextAlignment" Value="Start" />
            </Style>

        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout Spacing="0" Padding="0,0,0,10">

            <!-- Header Card -->
            <!--<Label Text="Patient Registration" FontSize="20" Margin="10,0" />-->
            <Label Text="👤 Demographics" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />

            <!-- Patient Demographics Section -->

            <StackLayout Padding="20" Spacing="0">

                <!-- Patient ID -->
                <core:SfTextInputLayout Hint="Patient ID"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Auto-generated or manual entry">
                    <Entry Text="{Binding PatientId}"
                               IsReadOnly="{Binding IsPatientIdReadOnly}"
                               ReturnType="Next" />
                </core:SfTextInputLayout>

                <!-- Name Fields -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="First Name"
                                                Style="{StaticResource PatientInput}">
                        <Entry Text="{Binding FirstName}"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Last Name"
                                                Style="{StaticResource PatientInput}">
                        <Entry Text="{Binding LastName}"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>
                </Grid>

                <!-- Date of Birth / Age -->
                <Grid ColumnDefinitions="2*,*" ColumnSpacing="12">
                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Date of Birth"
                                                Style="{StaticResource PatientInput}">
                        <DatePicker Date="{Binding DateOfBirth}"
                                       Format="dd/MM/yyyy" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Age"
                                                Style="{StaticResource PatientInput}">
                        <Entry Text="{Binding Age}"
                                   Keyboard="Numeric"
                                   IsReadOnly="True"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>
                </Grid>

                <!-- Contact Information -->
                <core:SfTextInputLayout Hint="Phone Number"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Primary contact number">
                    <Entry Text="{Binding PhoneNumber}"
                               Keyboard="Telephone"
                               ReturnType="Next" />
                </core:SfTextInputLayout>

                <!-- Address -->
                <core:SfTextInputLayout Hint="Address"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Complete residential address">
                    <Entry Text="{Binding Address}"
                               ReturnType="Next" />
                </core:SfTextInputLayout>

            </StackLayout>

            <Label Text="🚨 Emergency Contact" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />

            <!-- Emergency Contact Section -->

            <StackLayout Padding="20" Spacing="0">
                <Grid ColumnDefinitions="2*,*" ColumnSpacing="12">
                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Emergency Contact Name"
                                                Style="{StaticResource PatientInput}">
                        <Entry Text="{Binding EmergencyContactName}"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Relationship"
                                                Style="{StaticResource PatientInput}">
                        <Entry Text="{Binding EmergencyContactRelationship}"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>
                </Grid>

                <core:SfTextInputLayout Hint="Emergency Contact Phone"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Available 24/7">
                    <Entry Text="{Binding EmergencyContactPhone}"
                               Keyboard="Telephone"
                               ReturnType="Next" />
                </core:SfTextInputLayout>
            </StackLayout>

            <!-- Obstetric History Section -->
            <Label Text="🤱 Obstetric History" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />


            <StackLayout Padding="20" Spacing="0">

                <!-- Gravida and Para -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Gravida (G)"
                                                Style="{StaticResource PatientInput}"
                                                HelperText="Total pregnancies">
                        <Entry Text="{Binding Gravida}"
                                   Keyboard="Numeric"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Para (P)"
                                                Style="{StaticResource PatientInput}"
                                                HelperText="Previous births">
                        <Entry Text="{Binding Para}"
                                   Keyboard="Numeric"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>
                </Grid>

                <!-- Gestational Age -->
                <Label Text="Gestational Age" 
                           FontSize="14" 
                           FontAttributes="Bold" 
                           TextColor="{StaticResource TextPrimary}"
                           Margin="0,8,0,4" />

                <Grid ColumnDefinitions="2*,*" ColumnSpacing="12">
                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Weeks"
                                                Style="{StaticResource PatientInput}">
                        <Entry Text="{Binding GestationalWeeks}"
                                   Keyboard="Numeric"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Days"
                                                Style="{StaticResource PatientInput}">
                        <Entry Text="{Binding GestationalDays}"
                                   Keyboard="Numeric"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>
                </Grid>

                <Label Text="{Binding FormattedGestationalAge}"
                           FontSize="12"
                           TextColor="{StaticResource AccentTeal}"
                           FontAttributes="Bold"
                           Margin="0,4,0,0" />

            </StackLayout>

            <!-- Medical Information Section -->
            <Label Text="🏥 Medical Information" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />

            <StackLayout Padding="20" Spacing="0">

                <!-- Insurance -->
                <core:SfTextInputLayout Hint="Insurance Provider"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Health insurance details">
                    <Entry Text="{Binding Insurance}"
                               ReturnType="Next" />
                </core:SfTextInputLayout>

                <!-- Risk Factors -->
                <core:SfTextInputLayout Hint="Risk Factors"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="High-risk conditions or complications">
                    <Entry Text="{Binding RiskFactors}"
                               ReturnType="Next" />
                </core:SfTextInputLayout>

                <!-- Allergies -->
                <core:SfTextInputLayout Hint="Allergies"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Drug allergies and reactions">
                    <Entry Text="{Binding Allergies}"
                               ReturnType="Next" />
                </core:SfTextInputLayout>

            </StackLayout>

            <!-- Labour Information Section -->
            <Label Text="⏱️ Labour Information" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />

            <StackLayout Padding="20" Spacing="0">

                <!-- Labour Onset -->
                <Label Text="Labour Onset Date &amp; Time" 
                           FontSize="14" 
                           FontAttributes="Bold" 
                           TextColor="{StaticResource TextPrimary}"
                           Margin="0,0,0,4" />

                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Date"
                                                Style="{StaticResource PatientInput}">
                        <DatePicker Date="{Binding LabourOnsetDate}"
                                       Format="dd/MM/yyyy" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Time"
                                                Style="{StaticResource PatientInput}">
                        <TimePicker Time="{Binding LabourOnsetTime}" Format="HH:mm" />
                    </core:SfTextInputLayout>
                </Grid>

                <!-- Active Labour Diagnosis -->
                <core:SfTextInputLayout Hint="Active Labour Diagnosis"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Clinical assessment of active labour">
                    <Entry Text="{Binding ActiveLabourDiagnosis}"
                               ReturnType="Next" />
                </core:SfTextInputLayout>

                <!-- Ruptured Membrane -->
                <Label Text="Ruptured Membrane Date &amp; Time" 
                           FontSize="14" 
                           FontAttributes="Bold" 
                           TextColor="{StaticResource TextPrimary}"
                           Margin="0,8,0,4" />

                <StackLayout Orientation="Horizontal" Spacing="12">
                    <CheckBox IsChecked="{Binding HasRupturedMembrane}"
                                  Color="{StaticResource PrimaryBlue}"
                                  VerticalOptions="Center" />
                    <Label Text="Membrane has ruptured"
                               FontSize="14"
                               TextColor="{StaticResource TextPrimary}"
                               VerticalOptions="Center" />
                </StackLayout>

                <Grid ColumnDefinitions="*,*" 
                          ColumnSpacing="12"
                          IsVisible="{Binding HasRupturedMembrane}">
                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Rupture Date"
                                                Style="{StaticResource PatientInput}">
                        <DatePicker Date="{Binding RupturedMembraneDate}"
                                       Format="dd/MM/yyyy" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Rupture Time"
                                                Style="{StaticResource PatientInput}">
                        <TimePicker Time="{Binding RupturedMembraneTime}"
                                       Format="HH:mm" />
                    </core:SfTextInputLayout>
                </Grid>

            </StackLayout>

            <!-- Action Buttons -->
            <StackLayout Padding="16" Spacing="12">

                <!-- Error Messages -->
                <Label Text="{Binding ErrorMessage}"
                   Style="{StaticResource ErrorText}"
                   IsVisible="{Binding HasError}"
                   Margin="0,0,0,8" />

                <!-- Save and Continue Button -->
                <buttons:SfButton Text="Save Patient &amp; Start Partograph" 
                              Style="{StaticResource PrimaryButton}"
                              Command="{Binding SavePatientCommand}">
                    <buttons:SfButton.ImageSource>
                        <FontImageSource FontFamily="MaterialIcons"
                                   Glyph="&#xe161;"
                                   Size="20"
                                   Color="{StaticResource SurfaceWhite}" />
                    </buttons:SfButton.ImageSource>
                </buttons:SfButton>

                <!-- Save Draft Button -->
                <buttons:SfButton Text="Save as Draft" 
                              Style="{StaticResource SecondaryButton}"
                              Command="{Binding SaveDraftCommand}">
                    <buttons:SfButton.ImageSource>
                        <FontImageSource FontFamily="MaterialIcons"
                                   Glyph="&#xe161;"
                                   Size="18"
                                   Color="{StaticResource PrimaryBlue}" />
                    </buttons:SfButton.ImageSource>
                </buttons:SfButton>

                <!-- Quick Action Grid -->
                <!--<Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,16,0,0">
                    <buttons:SfButton Grid.Column="0"
                                 Text="📋 View Template"
                                 FontSize="12"
                                 HeightRequest="40"
                                 CornerRadius="8"
                                 Background="{StaticResource AccentTeal}"
                                 TextColor="{StaticResource SurfaceWhite}"
                                 Command="{Binding ViewTemplateCommand}" />

                    <buttons:SfButton Grid.Column="1"
                                 Text="🔄 Reset Form"
                                 FontSize="12"
                                 HeightRequest="40"
                                 CornerRadius="8"
                                 Background="{StaticResource WarningOrange}"
                                 TextColor="{StaticResource SurfaceWhite}"
                                 Command="{Binding ResetFormCommand}" />
                </Grid>-->

            </StackLayout>

        </StackLayout>
    </ScrollView>
</ContentPage>