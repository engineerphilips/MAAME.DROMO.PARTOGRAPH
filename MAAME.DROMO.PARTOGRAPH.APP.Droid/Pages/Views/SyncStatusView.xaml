<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:fonts="clr-namespace:Fonts"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.Views.SyncStatusView">

    <ScrollView>
        <VerticalStackLayout Spacing="16" Padding="8,20">

            <!-- Summary Cards Row 1 -->
            <Grid ColumnDefinitions="*,12,*" ColumnSpacing="0">
                <!-- Total Devices -->
                <Border Grid.Column="0"
                        BackgroundColor="{AppThemeBinding Light=#26A69A, Dark=#00897B}"
                        Padding="16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="8">
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="&#xE70A;"
                                   FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                                   FontSize="28"
                                   VerticalOptions="Center"/>
                            <Label Text="Total Devices"
                                   FontSize="14"
                                   Opacity="0.9"
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                        <Label Text="{Binding TotalDevices}"
                               FontSize="32"
                               FontAttributes="Bold"/>
                    </VerticalStackLayout>
                </Border>

                <!-- Active Devices -->
                <Border Grid.Column="2"
                        BackgroundColor="{AppThemeBinding Light=#4CAF50, Dark=#388E3C}"
                        Padding="16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="8">
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="&#xE73E;"
                                   FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                                   FontSize="28"
                                   VerticalOptions="Center"/>
                            <Label Text="Active Devices"
                                   FontSize="14"
                                   Opacity="0.9"
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                        <Label Text="{Binding ActiveDevices}"
                               FontSize="32"
                               FontAttributes="Bold"/>
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Summary Cards Row 2 -->
            <Grid ColumnDefinitions="*,12,*,12,*" ColumnSpacing="0">
                <!-- Offline -->
                <Border Grid.Column="0"
                        BackgroundColor="{AppThemeBinding Light=#FF9800, Dark=#F57C00}"
                        Padding="16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Offline"
                               FontSize="12"
                               Opacity="0.9"/>
                        <Label Text="{Binding OfflineDevices}"
                               FontSize="28"
                               FontAttributes="Bold"/>
                    </VerticalStackLayout>
                </Border>

                <!-- Pending -->
                <Border Grid.Column="2"
                        BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1976D2}"
                        Padding="16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Pending"
                               FontSize="12"
                               Opacity="0.9"/>
                        <Label Text="{Binding TotalPendingChanges}"
                               FontSize="28"
                               FontAttributes="Bold"/>
                    </VerticalStackLayout>
                </Border>

                <!-- Conflicts -->
                <Border Grid.Column="4"
                        BackgroundColor="{AppThemeBinding Light=#F44336, Dark=#D32F2F}"
                        Padding="16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Conflicts"
                               FontSize="12"
                               Opacity="0.9"/>
                        <Label Text="{Binding UnresolvedConflicts}"
                               FontSize="28"
                               FontAttributes="Bold"/>
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Sync Statistics -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Sync Statistics"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="12">
                        <Label Text="Syncs Today"
                               Grid.Row="0" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding TotalSyncsToday}"
                               Grid.Row="0" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"/>

                        <Label Text="Syncs This Week"
                               Grid.Row="1" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding TotalSyncsThisWeek}"
                               Grid.Row="1" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"/>

                        <Label Text="Success Rate"
                               Grid.Row="2" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding SyncSuccessRate, StringFormat='{0:F1}%'}"
                               Grid.Row="2" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#4CAF50"/>

                        <Label Text="Failed Syncs"
                               Grid.Row="3" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding FailedSyncs}"
                               Grid.Row="3" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#F44336"/>

                        <Label Text="Avg Sync Duration"
                               Grid.Row="4" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding AverageSyncDurationSeconds, StringFormat='{0:F1}s'}"
                               Grid.Row="4" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Data Volume -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Data Volume"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto" RowSpacing="12">
                        <Label Text="Total Synced"
                               Grid.Row="0" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding TotalDataSyncedFormatted}"
                               Grid.Row="0" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#4CAF50"/>

                        <Label Text="Pending"
                               Grid.Row="1" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding TotalPendingDataFormatted}"
                               Grid.Row="1" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#FF9800"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Device Health -->
            <Border BackgroundColor="{AppThemeBinding Light=#FFF3E0, Dark=#E65100}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Device Health Alerts"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#E65100, Dark=#FFB74D}"/>

                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto" RowSpacing="12">
                        <Label Text="Needs Attention"
                               Grid.Row="0" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#D84315, Dark=#FFAB91}"/>
                        <Label Text="{Binding DevicesNeedingAttention}"
                               Grid.Row="0" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#BF360C, Dark=#FFCCBC}"/>

                        <Label Text="With Errors"
                               Grid.Row="1" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#D84315, Dark=#FFAB91}"/>
                        <Label Text="{Binding DevicesWithErrors}"
                               Grid.Row="1" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#BF360C, Dark=#FFCCBC}"/>

                        <Label Text="Out of Sync (>24h)"
                               Grid.Row="2" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#D84315, Dark=#FFAB91}"/>
                        <Label Text="{Binding DevicesOutOfSync}"
                               Grid.Row="2" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#BF360C, Dark=#FFCCBC}"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Entity Sync Status -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Entity Sync Status"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <CollectionView ItemsSource="{Binding EntitySyncStatuses}"
                                    EmptyView="No entity data available">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border BackgroundColor="{AppThemeBinding Light=#FAFAFA, Dark=#2C2C2C}"
                                        Padding="12"
                                        Margin="0,0,0,8">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8" />
                                    </Border.StrokeShape>
                                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto">
                                        <Label Text="{Binding EntityType}"
                                               Grid.Row="0" Grid.Column="0"
                                               FontSize="14"
                                               FontAttributes="Bold"/>
                                        <Label Text="{Binding SyncPercentage, StringFormat='{0:F1}%'}"
                                               Grid.Row="0" Grid.Column="1"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="#26A69A"/>

                                        <Label Grid.Row="1" Grid.Column="0"
                                               Grid.ColumnSpan="2"
                                               FontSize="12"
                                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="Synced: " />
                                                    <Span Text="{Binding SyncedRecords}" FontAttributes="Bold"/>
                                                    <Span Text=" / " />
                                                    <Span Text="{Binding TotalRecords}"/>
                                                    <Span Text=" • Pending: " />
                                                    <Span Text="{Binding PendingRecords}" FontAttributes="Bold" />
                                                    <Span Text=" • Conflicts: " />
                                                    <Span Text="{Binding ConflictedRecords}" FontAttributes="Bold"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>

                                        <ProgressBar Progress="{Binding SyncPercentage}"
                                                     Grid.Row="2" Grid.Column="0"
                                                     Grid.ColumnSpan="2"
                                                     ProgressColor="#26A69A"
                                                     Margin="0,4,0,0"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

            <!-- Device Status List -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Device Details"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <CollectionView ItemsSource="{Binding DeviceStatuses}"
                                    EmptyView="No device data available">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border BackgroundColor="{AppThemeBinding Light=#FAFAFA, Dark=#2C2C2C}"
                                        Padding="16"
                                        Margin="0,0,0,12">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="10" />
                                    </Border.StrokeShape>
                                    <VerticalStackLayout Spacing="12">
                                        <!-- Device Name and Status -->
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label Text="{Binding DeviceName}"
                                                   FontSize="16"
                                                   FontAttributes="Bold"
                                                   Grid.Column="0"/>
                                            <Border BackgroundColor="{AppThemeBinding Light=#E8F5E9, Dark=#1B5E20}"
                                                    Padding="8,4"
                                                    Grid.Column="1">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="6" />
                                                </Border.StrokeShape>
                                                <Label Text="{Binding SyncStatus}"
                                                       FontSize="12"
                                                       FontAttributes="Bold"
                                                       TextColor="{AppThemeBinding Light=#2E7D32, Dark=#81C784}"/>
                                            </Border>
                                        </Grid>

                                        <!-- Device Info -->
                                        <Label FontSize="12"
                                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding DeviceModel}"/>
                                                    <Span Text=" • " />
                                                    <Span Text="{Binding OSVersion}"/>
                                                    <Span Text=" • " />
                                                    <Span Text="{Binding AssignedUser}" FontAttributes="Bold"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>

                                        <!-- Sync Details -->
                                        <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto" RowSpacing="8" ColumnSpacing="12">
                                            <Label Text="Last Sync"
                                                   Grid.Row="0" Grid.Column="0"
                                                   FontSize="12"
                                                   TextColor="{AppThemeBinding Light=#999, Dark=#777}"/>
                                            <Label Text="{Binding LastSyncTime, StringFormat='{0:MMM dd, HH:mm}'}"
                                                   Grid.Row="0" Grid.Column="1"
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   HorizontalOptions="End"/>

                                            <Label Text="Pending Changes"
                                                   Grid.Row="1" Grid.Column="0"
                                                   FontSize="12"
                                                   TextColor="{AppThemeBinding Light=#999, Dark=#777}"/>
                                            <Label Text="{Binding PendingChanges}"
                                                   Grid.Row="1" Grid.Column="1"
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   HorizontalOptions="End"
                                                   TextColor="#FF9800"/>

                                            <Label Text="Conflicts"
                                                   Grid.Row="2" Grid.Column="0"
                                                   FontSize="12"
                                                   TextColor="{AppThemeBinding Light=#999, Dark=#777}"/>
                                            <Label Text="{Binding Conflicts}"
                                                   Grid.Row="2" Grid.Column="1"
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   HorizontalOptions="End"
                                                   TextColor="#F44336"/>
                                        </Grid>

                                        <!-- Data Volume -->
                                        <HorizontalStackLayout Spacing="8">
                                            <Label Text="&#xE896;"
                                                   FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                                                   FontSize="14"
                                                   VerticalOptions="Center"
                                                   TextColor="#26A69A"/>
                                            <Label Text="{Binding DataVolumeFormatted}"
                                                   FontSize="12"
                                                   VerticalOptions="Center"
                                                   TextColor="#26A69A"/>
                                        </HorizontalStackLayout>
                                    </VerticalStackLayout>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>
</ContentView>
