<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:fonts="clr-namespace:Fonts"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.Views.BirthWeightApgarView">

    <ScrollView>
        <VerticalStackLayout Spacing="16" Padding="8,20">

            <!-- Summary Cards -->
            <Grid ColumnDefinitions="*,12,*" ColumnSpacing="0">
                <!-- Total Babies -->
                <Border Grid.Column="0"
                        BackgroundColor="{AppThemeBinding Light=#5C6BC0, Dark=#3949AB}"
                        Padding="16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="8">
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="&#xE8A7;"
                                   FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                                   FontSize="28"
                                   VerticalOptions="Center"/>
                            <Label Text="Total Babies"
                                   FontSize="14"
                                   Opacity="0.9"
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                        <Label Text="{Binding TotalBabies}"
                               FontSize="32"
                               FontAttributes="Bold"/>
                    </VerticalStackLayout>
                </Border>

                <!-- Average Birth Weight -->
                <Border Grid.Column="2"
                        BackgroundColor="{AppThemeBinding Light=#7E57C2, Dark=#5E35B1}"
                        Padding="16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="8">
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="&#xE9F9;"
                                   FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                                   FontSize="28"
                                   VerticalOptions="Center"/>
                            <Label Text="Avg Weight"
                                   FontSize="14"
                                   Opacity="0.9"
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                        <Label FontSize="32"
                               FontAttributes="Bold">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding AverageBirthWeight, StringFormat='{0:F0}'}" />
                                    <Span Text="g" FontSize="20" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Birth Weight Statistics -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Birth Weight Statistics"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="12">
                        <Label Text="Average Weight"
                               Grid.Row="0" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding AverageBirthWeight, StringFormat='{0:F0}g'}"
                               Grid.Row="0" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"/>

                        <Label Text="Median Weight"
                               Grid.Row="1" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding MedianBirthWeight, StringFormat='{0:F0}g'}"
                               Grid.Row="1" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"/>

                        <Label Text="Standard Deviation"
                               Grid.Row="2" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding StandardDeviation, StringFormat='{0:F0}g'}"
                               Grid.Row="2" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"/>

                        <Label Text="Weight Range"
                               Grid.Row="3" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Grid.Row="3" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding MinBirthWeight, StringFormat='{0:F0}'}" />
                                    <Span Text=" - " />
                                    <Span Text="{Binding MaxBirthWeight, StringFormat='{0:F0}g'}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>

                        <Label Text="Low Birth Weight Rate"
                               Grid.Row="4" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Grid.Row="4" Grid.Column="1"
                               FontSize="14">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding LowBirthWeightCount}" FontAttributes="Bold"/>
                                    <Span Text=" (" />
                                    <Span Text="{Binding LowBirthWeightRate, StringFormat='{0:F1}%'}" FontAttributes="Bold" TextColor="#FF9800"/>
                                    <Span Text=")" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- APGAR Score Statistics -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Label Text="APGAR Score Statistics"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <Grid ColumnDefinitions="2*,*,*" RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="12">
                        <!-- Header -->
                        <Label Text=""
                               Grid.Row="0" Grid.Column="0"
                               FontSize="12"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="1 Min"
                               Grid.Row="0" Grid.Column="1"
                               FontSize="12"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"
                               HorizontalOptions="End"/>
                        <Label Text="5 Min"
                               Grid.Row="0" Grid.Column="2"
                               FontSize="12"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"
                               HorizontalOptions="End"/>

                        <!-- Average -->
                        <Label Text="Average Score"
                               Grid.Row="1" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding AverageApgar1Min, StringFormat='{0:F1}'}"
                               Grid.Row="1" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"/>
                        <Label Text="{Binding AverageApgar5Min, StringFormat='{0:F1}'}"
                               Grid.Row="1" Grid.Column="2"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"
                               TextColor="#4CAF50"/>

                        <!-- Low APGAR (<7) -->
                        <Label Text="Low APGAR (&lt;7)"
                               Grid.Row="2" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding LowApgar1MinCount}"
                               Grid.Row="2" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"
                               TextColor="#FF9800"/>
                        <Label Text="{Binding LowApgar5MinCount}"
                               Grid.Row="2" Grid.Column="2"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"
                               TextColor="#FF9800"/>

                        <!-- Critical APGAR (0-3) -->
                        <Label Text="Critical (0-3)"
                               Grid.Row="3" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding CriticalApgar1MinCount}"
                               Grid.Row="3" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"
                               TextColor="#F44336"/>
                        <Label Text="{Binding CriticalApgar5MinCount}"
                               Grid.Row="3" Grid.Column="2"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"
                               TextColor="#F44336"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Weight Distribution -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Birth Weight Distribution"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <CollectionView ItemsSource="{Binding WeightDistribution}"
                                    EmptyView="No distribution data available">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border BackgroundColor="{AppThemeBinding Light=#FAFAFA, Dark=#2C2C2C}"
                                        Padding="12"
                                        Margin="0,0,0,8">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8" />
                                    </Border.StrokeShape>
                                    <Grid ColumnDefinitions="*,Auto,Auto" RowDefinitions="Auto,Auto">
                                        <Label Text="{Binding Category}"
                                               Grid.Row="0" Grid.Column="0"
                                               FontSize="14"
                                               FontAttributes="Bold"/>
                                        <Label Text="{Binding Count}"
                                               Grid.Row="0" Grid.Column="1"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               Margin="0,0,8,0"/>
                                        <Label Text="{Binding Percentage, StringFormat='({0:F1}%)'}"
                                               Grid.Row="0" Grid.Column="2"
                                               FontSize="14"
                                               TextColor="#5C6BC0"/>

                                        <Label Grid.Row="1" Grid.Column="0"
                                               Grid.ColumnSpan="3"
                                               FontSize="12"
                                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding MinWeight, StringFormat='{0:F0}'}" />
                                                    <Span Text="g - " />
                                                    <Span Text="{Binding MaxWeight, StringFormat='{0:F0}g'}" />
                                                    <Span Text=" • Avg: " />
                                                    <Span Text="{Binding AverageWeight, StringFormat='{0:F0}g'}" FontAttributes="Bold"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>

                                        <ProgressBar Progress="{Binding Percentage}"
                                                     Grid.Row="2" Grid.Column="0"
                                                     Grid.ColumnSpan="3"
                                                     ProgressColor="#5C6BC0"
                                                     Margin="0,4,0,0"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

            <!-- Correlation Analysis -->
            <Border BackgroundColor="{AppThemeBinding Light=#E8EAF6, Dark=#1A237E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Birth Weight & APGAR Correlation"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#283593, Dark=#9FA8DA}"/>

                    <Label FontSize="14"
                           TextColor="{AppThemeBinding Light=#3949AB, Dark=#C5CAE9}">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Pearson Correlation Coefficient: " />
                                <Span Text="{Binding PearsonCorrelationCoefficient, StringFormat='{0:F3}'}" FontAttributes="Bold"/>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>

                    <CollectionView ItemsSource="{Binding CorrelationData}"
                                    EmptyView="No correlation data available">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border BackgroundColor="{AppThemeBinding Light=#F3E5F5, Dark=#4A148C}"
                                        Padding="12"
                                        Margin="0,0,0,8">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8" />
                                    </Border.StrokeShape>
                                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                                        <Label Text="{Binding WeightCategory}"
                                               Grid.Row="0" Grid.Column="0"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="{AppThemeBinding Light=#4A148C, Dark=#E1BEE7}"/>
                                        <Label Grid.Row="0" Grid.Column="1"
                                               FontSize="14"
                                               TextColor="{AppThemeBinding Light=#6A1B9A, Dark=#CE93D8}">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="n=" />
                                                    <Span Text="{Binding Count}" FontAttributes="Bold"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>

                                        <Label Grid.Row="1" Grid.Column="0"
                                               Grid.ColumnSpan="2"
                                               FontSize="12"
                                               TextColor="{AppThemeBinding Light=#6A1B9A, Dark=#CE93D8}">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="APGAR 1min: " />
                                                    <Span Text="{Binding AverageApgar1Min, StringFormat='{0:F1}'}" FontAttributes="Bold"/>
                                                    <Span Text=" • 5min: " />
                                                    <Span Text="{Binding AverageApgar5Min, StringFormat='{0:F1}'}" FontAttributes="Bold"/>
                                                    <Span Text=" • Low APGAR: " />
                                                    <Span Text="{Binding LowApgar5MinCount}" FontAttributes="Bold"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

            <!-- Gender Comparison -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Gender Comparison"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <Grid ColumnDefinitions="2*,*,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="12">
                        <!-- Header -->
                        <Label Text=""
                               Grid.Row="0" Grid.Column="0"
                               FontSize="12"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="Male"
                               Grid.Row="0" Grid.Column="1"
                               FontSize="12"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"
                               HorizontalOptions="End"/>
                        <Label Text="Female"
                               Grid.Row="0" Grid.Column="2"
                               FontSize="12"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"
                               HorizontalOptions="End"/>

                        <!-- Count -->
                        <Label Text="Count"
                               Grid.Row="1" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding MaleStatistics.Count}"
                               Grid.Row="1" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"/>
                        <Label Text="{Binding FemaleStatistics.Count}"
                               Grid.Row="1" Grid.Column="2"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"/>

                        <!-- Average Weight -->
                        <Label Text="Avg Weight"
                               Grid.Row="2" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding MaleStatistics.AverageBirthWeight, StringFormat='{0:F0}g'}"
                               Grid.Row="2" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"/>
                        <Label Text="{Binding FemaleStatistics.AverageBirthWeight, StringFormat='{0:F0}g'}"
                               Grid.Row="2" Grid.Column="2"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"/>

                        <!-- Avg APGAR 1 -->
                        <Label Text="Avg APGAR 1min"
                               Grid.Row="3" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding MaleStatistics.AverageApgar1Min, StringFormat='{0:F1}'}"
                               Grid.Row="3" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"/>
                        <Label Text="{Binding FemaleStatistics.AverageApgar1Min, StringFormat='{0:F1}'}"
                               Grid.Row="3" Grid.Column="2"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"/>

                        <!-- LBW Rate -->
                        <Label Text="LBW Rate"
                               Grid.Row="4" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding MaleStatistics.LowBirthWeightRate, StringFormat='{0:F1}%'}"
                               Grid.Row="4" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"
                               TextColor="#FF9800"/>
                        <Label Text="{Binding FemaleStatistics.LowBirthWeightRate, StringFormat='{0:F1}%'}"
                               Grid.Row="4" Grid.Column="2"
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="End"
                               TextColor="#FF9800"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- High Risk Analysis -->
            <Border BackgroundColor="{AppThemeBinding Light=#FFEBEE, Dark=#B71C1C}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="16">
                    <HorizontalStackLayout Spacing="8">
                        <Label Text="High Risk Babies"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#C62828, Dark=#FFCDD2}"/>
                        <Label FontSize="14"
                               VerticalOptions="End"
                               Margin="0,0,0,2">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="(" />
                                    <Span Text="{Binding HighRiskPercentage, StringFormat='{0:F1}%'}" TextColor="{AppThemeBinding Light=#D32F2F, Dark=#EF9A9A}" FontAttributes="Bold"/>
                                    <Span Text=")" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </HorizontalStackLayout>

                    <Label FontSize="48"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light=#C62828, Dark=#FFCDD2}">
                        <Label.Text>
                            <Binding Path="HighRiskBabies" StringFormat="{}{0}" />
                        </Label.Text>
                    </Label>

                    <Label Text="Babies with low birth weight (&lt;2500g) and/or low APGAR scores requiring specialized care"
                           FontSize="12"
                           HorizontalTextAlignment="Center"
                           TextColor="{AppThemeBinding Light=#D32F2F, Dark=#EF9A9A}"/>
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>
</ContentView>
