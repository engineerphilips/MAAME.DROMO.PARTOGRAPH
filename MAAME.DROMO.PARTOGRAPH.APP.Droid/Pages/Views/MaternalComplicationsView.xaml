<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:fonts="clr-namespace:Fonts"
             xmlns:models="clr-namespace:MAAME.DROMO.PARTOGRAPH.MODEL;assembly=MAAME.DROMO.PARTOGRAPH.MODEL"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.Views.MaternalComplicationsView">

    <ScrollView>
        <VerticalStackLayout Spacing="16" Padding="4,20">

            <!-- Summary Header -->
            <Border BackgroundColor="{AppThemeBinding Light=#F44336, Dark=#D32F2F}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="16">
                    <Label Text="&#xEA39;"
                           FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                           FontSize="48"
                           Grid.Column="0"
                           VerticalOptions="Center"/>
                    <VerticalStackLayout Grid.Column="1" Spacing="4">
                        <Label Text="Maternal Complications"
                               FontSize="22"
                               FontAttributes="Bold"/>
                        <Label FontSize="16" 
                               Opacity="0.9">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding TotalCases}" FontAttributes="Bold"/>
                                    <Span Text=" total cases " />
                                    <Span Text="{Binding ComplicationRate, StringFormat='({0:F1}% rate)'}" FontAttributes="Bold"/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!-- Critical Statistics Row -->
            <Grid ColumnDefinitions="*,12,*,12,*" ColumnSpacing="0">
                <Border Grid.Column="0"
                        BackgroundColor="{AppThemeBinding Light=#B71C1C, Dark=#7F0000}"
                        Padding="16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="10" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Maternal Deaths"
                               FontSize="12" 
                               Opacity="0.9"/>
                        <Label Text="{Binding MaternalDeaths}"
                               FontSize="28"
                               FontAttributes="Bold" />
                        <Label FontSize="10" 
                               Opacity="0.8">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding MaternalMortalityRate, StringFormat='{0:F1}'}" />
                                    <Span Text=" per 100k" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </VerticalStackLayout>
                </Border>

                <Border Grid.Column="2"
                        BackgroundColor="{AppThemeBinding Light=#D32F2F, Dark=#C62828}"
                        Padding="16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="10" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="4">
                        <Label Text="PPH Cases"
                               FontSize="12" 
                               Opacity="0.9"/>
                        <Label Text="{Binding PostpartumHemorrhages}"
                               FontSize="28"
                               FontAttributes="Bold" />
                    </VerticalStackLayout>
                </Border>

                <Border Grid.Column="4"
                        BackgroundColor="{AppThemeBinding Light=#E53935, Dark=#D32F2F}"
                        Padding="16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="10" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="4">
                        <Label Text="ICU Admissions"
                               FontSize="12" 
                               Opacity="0.9"/>
                        <Label Text="{Binding ICUAdmissions}"
                               FontSize="28"
                               FontAttributes="Bold" />
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Complication Types Section -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Complication Types"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" RowSpacing="12">
                        <Label Text="Hypertensive Disorders"
                               Grid.Row="0" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding HypertensiveDisorders}"
                               Grid.Row="0" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#F44336"/>

                        <Label Text="Postpartum Hemorrhage"
                               Grid.Row="1" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding PostpartumHemorrhages}"
                               Grid.Row="1" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#F44336"/>

                        <Label Text="Eclampsia"
                               Grid.Row="2" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding Eclampsia}"
                               Grid.Row="2" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#FF9800"/>

                        <Label Text="Obstructed Labor"
                               Grid.Row="3" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding ObstructedLabor}"
                               Grid.Row="3" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#FF9800"/>

                        <Label Text="Ruptured Uterus"
                               Grid.Row="4" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding RupturedUterus}"
                               Grid.Row="4" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#E91E63"/>

                        <Label Text="Septic Shock"
                               Grid.Row="5" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding SepticShock}"
                               Grid.Row="5" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#E91E63"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Blood Loss Statistics -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Blood Loss Statistics"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="12">
                        <Label Text="Average Blood Loss"
                               Grid.Row="0" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding AverageBloodLoss, StringFormat='{0:F0} ml'}"
                               Grid.Row="0" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"/>

                        <Label Text="Cases Exceeding 500ml"
                               Grid.Row="1" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding CasesExceeding500ml}"
                               Grid.Row="1" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#FF9800"/>

                        <Label Text="Cases Exceeding 1000ml"
                               Grid.Row="2" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding CasesExceeding1000ml}"
                               Grid.Row="2" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#F44336"/>

                        <Label Text="Blood Transfusions Required"
                               Grid.Row="3" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding BloodTransfusionsRequired}"
                               Grid.Row="3" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#E91E63"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Perineal Trauma Section -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <HorizontalStackLayout Spacing="8">
                        <Label Text="Perineal Trauma"
                               FontSize="18"
                               FontAttributes="Bold"/>
                        <Label FontSize="14"
                               VerticalOptions="End"
                               Margin="0,0,0,2">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="(Severe: " />
                                    <Span Text="{Binding SeverePerinealTraumaRate, StringFormat='{0:F1}%'}" TextColor="#F44336" FontAttributes="Bold"/>
                                    <Span Text=")" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </HorizontalStackLayout>

                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" RowSpacing="12">
                        <Label Text="Intact Perineum"
                               Grid.Row="0" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding IntactPerineum}"
                               Grid.Row="0" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#4CAF50"/>

                        <Label Text="First Degree Tears"
                               Grid.Row="1" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding FirstDegreeTears}"
                               Grid.Row="1" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"/>

                        <Label Text="Second Degree Tears"
                               Grid.Row="2" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding SecondDegreeTears}"
                               Grid.Row="2" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"/>

                        <Label Text="Third Degree Tears"
                               Grid.Row="3" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding ThirdDegreeTears}"
                               Grid.Row="3" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#FF9800"/>

                        <Label Text="Fourth Degree Tears"
                               Grid.Row="4" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding FourthDegreeTears}"
                               Grid.Row="4" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#F44336"/>

                        <Label Text="Episiotomies"
                               Grid.Row="5" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding Episiotomies}"
                               Grid.Row="5" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Interventions Section -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Major Interventions"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="12">
                        <Label Text="Emergency Caesareans"
                               Grid.Row="0" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding EmergencyCaesareans}"
                               Grid.Row="0" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"/>

                        <Label Text="Manual Placenta Removal"
                               Grid.Row="1" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding ManualPlacentaRemoval}"
                               Grid.Row="1" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"/>

                        <Label Text="Hysterectomies Performed"
                               Grid.Row="2" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding HysterectomiesPerformed}"
                               Grid.Row="2" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#F44336"/>

                        <Label Text="ICU Admissions"
                               Grid.Row="3" Grid.Column="0"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                        <Label Text="{Binding ICUAdmissions}"
                               Grid.Row="3" Grid.Column="1"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#FF9800"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Detailed Cases Section -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#40000000, Dark=#80000000}"
                            Offset="0,2"
                            Radius="8"
                            Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Label Text="Recent Complication Cases"
                           FontSize="18"
                           FontAttributes="Bold"/>

                    <CollectionView ItemsSource="{Binding Cases}"
                                    ItemsLayout="VerticalList"
                                    SelectionMode="None">
                        <CollectionView.EmptyView>
                            <Label Text="No complication cases in this period"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#888, Dark=#AAA}"
                                   HorizontalOptions="Center"
                                   Margin="0,20,0,0"/>
                        </CollectionView.EmptyView>
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:MaternalComplicationCase">
                                <Border BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2A2A2A}"
                                        Padding="16"
                                        Margin="0,0,0,12">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8" />
                                    </Border.StrokeShape>
                                    <Grid RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="8">
                                        <HorizontalStackLayout Grid.Row="0" Spacing="8">
                                            <Label Text="{Binding PatientName}"
                                                   FontSize="16"
                                                   FontAttributes="Bold"/>
                                            <Label Text="{Binding Age, StringFormat='({0}y)'}"
                                                   FontSize="14"
                                                   TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"
                                                   VerticalOptions="End"/>
                                        </HorizontalStackLayout>

                                        <Label Grid.Row="1"
                                               Text="{Binding HospitalNumber}"
                                               FontSize="12"
                                               FontFamily="monospace"
                                               TextColor="{AppThemeBinding Light=#888, Dark=#AAA}"/>

                                        <Label Grid.Row="2"
                                               FontSize="13"
                                               TextColor="{AppThemeBinding Light=#666, Dark=#BBB}">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="Delivered: " />
                                                    <Span Text="{Binding DeliveryDate, StringFormat='{0:MMM dd, yyyy HH:mm}'}" FontAttributes="Bold"/>
                                                    <Span Text=" | Mode: " />
                                                    <Span Text="{Binding DeliveryMode}" FontAttributes="Bold"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>

                                        <VerticalStackLayout Grid.Row="3" Spacing="4">
                                            <Label Text="Complications:"
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="#F44336"/>
                                            <Label Text="{Binding Complications}"
                                                   FontSize="12"
                                                   TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
                                            <HorizontalStackLayout Spacing="8">
                                                <Label Text="{Binding EstimatedBloodLoss, StringFormat='Blood Loss: {0}ml'}"
                                                       FontSize="12"
                                                       TextColor="{AppThemeBinding Light=#888, Dark=#999}"/>
                                                <Label Text="{Binding Outcome, StringFormat='Outcome: {0}'}"
                                                       FontSize="12"
                                                       TextColor="{AppThemeBinding Light=#888, Dark=#999}"/>
                                            </HorizontalStackLayout>
                                        </VerticalStackLayout>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>
</ContentView>
