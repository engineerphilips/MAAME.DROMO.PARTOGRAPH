<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.VitalSignsPage"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:fonts="clr-namespace:Fonts"
             xmlns:converters="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Converters"
             Title="Record Vital Signs">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:HighBPConverter x:Key="HighBPConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Patient Info Header -->
            <Border StrokeThickness="0"
                    BackgroundColor="{AppThemeBinding Light=#FFF3E0, Dark=#E65100}"
                    Padding="15">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
                <VerticalStackLayout>
                    <Label Text="{Binding PatientName}" FontSize="20" FontAttributes="Bold" />
                    <Label Text="{Binding PatientInfo}" FontSize="14" Opacity="0.8" />
                </VerticalStackLayout>
            </Border>

            <!-- Time Recording -->
            <Border StrokeThickness="1"
                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                    BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="15">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
                <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                    <VerticalStackLayout Grid.Column="0">
                        <Label Text="Date" FontSize="12" TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                        <DatePicker Date="{Binding RecordedDate}" />
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Column="1">
                        <Label Text="Time" FontSize="12" TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                        <TimePicker Time="{Binding RecordedTime}" />
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!-- Blood Pressure -->
            <Border StrokeThickness="1"
                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                    BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="15">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="15">
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="&#xE95E;" 
                               FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                               FontSize="24"
                               TextColor="#EF5350"
                               VerticalOptions="Center" />
                        <Label Text="Blood Pressure" FontSize="18" FontAttributes="Bold" VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <Grid ColumnDefinitions="*,Auto,*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Systolic" FontSize="12" TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                            <Entry Text="{Binding SystolicBP}" 
                                   Keyboard="Numeric"
                                   Placeholder="120">
                                <Entry.Behaviors>
                                    <toolkit:NumericValidationBehavior MinimumValue="60" MaximumValue="250" />
                                </Entry.Behaviors>
                                <Entry.Triggers>
                                    <DataTrigger TargetType="Entry" 
                                                Binding="{Binding SystolicBP, Converter={StaticResource HighBPConverter}}" 
                                                Value="True">
                                        <Setter Property="TextColor" Value="#EF5350" />
                                    </DataTrigger>
                                </Entry.Triggers>
                            </Entry>
                        </VerticalStackLayout>

                        <Label Grid.Column="1" Text="/" FontSize="24" VerticalOptions="Center" />

                        <VerticalStackLayout Grid.Column="2">
                            <Label Text="Diastolic" FontSize="12" TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                            <Entry Text="{Binding DiastolicBP}" 
                                   Keyboard="Numeric"
                                   Placeholder="80">
                                <Entry.Behaviors>
                                    <toolkit:NumericValidationBehavior MinimumValue="40" MaximumValue="150" />
                                </Entry.Behaviors>
                                <Entry.Triggers>
                                    <DataTrigger TargetType="Entry" 
                                                Binding="{Binding DiastolicBP, Converter={StaticResource HighBPConverter}}" 
                                                Value="True">
                                        <Setter Property="TextColor" Value="#EF5350" />
                                    </DataTrigger>
                                </Entry.Triggers>
                            </Entry>
                        </VerticalStackLayout>
                    </Grid>

                    <Label Text="âš  High blood pressure detected" 
                           TextColor="#EF5350"
                           FontAttributes="Bold"
                           IsVisible="{Binding IsHypertensive}" />
                </VerticalStackLayout>
            </Border>

            <!-- Temperature -->
            <Border StrokeThickness="1"
                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                    BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="15">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="15">
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="&#xE9CA;" 
                               FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                               FontSize="24"
                               TextColor="#FF9800"
                               VerticalOptions="Center" />
                        <Label Text="Temperature" FontSize="18" FontAttributes="Bold" VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Grid.Column="0">
                            <Slider Minimum="35" Maximum="42" 
                                    Value="{Binding Temperature}"
                                    ThumbColor="#FF9800"
                                    MinimumTrackColor="#FF9800"
                                    MaximumTrackColor="{AppThemeBinding Light=#E0E0E0, Dark=#424242}" />
                            <Label Text="{Binding Temperature, StringFormat='{0:F1} Â°C'}" 
                                   HorizontalOptions="Center"
                                   FontSize="24"
                                   FontAttributes="Bold" />
                        </VerticalStackLayout>

                        <Label Grid.Column="1"
                               Text="ðŸ”¥"
                               FontSize="32"
                               VerticalOptions="Center"
                               IsVisible="{Binding HasFever}" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Pulse & Respiration -->
            <Border StrokeThickness="1"
                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                    BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="15">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="15">
                    <Label Text="Pulse &amp; Respiration" FontSize="18" FontAttributes="Bold" />

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                        <VerticalStackLayout Grid.Column="0">
                            <HorizontalStackLayout Spacing="5">
                                <Label Text="&#xE95D;" 
                                       FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                                       FontSize="20"
                                       TextColor="#E91E63" />
                                <Label Text="Pulse Rate (bpm)" FontSize="12" TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                            </HorizontalStackLayout>
                            <Entry Text="{Binding PulseRate}" 
                                   Keyboard="Numeric"
                                   Placeholder="60-100">
                                <Entry.Behaviors>
                                    <toolkit:NumericValidationBehavior MinimumValue="40" MaximumValue="200" />
                                </Entry.Behaviors>
                            </Entry>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1">
                            <HorizontalStackLayout Spacing="5">
                                <Label Text="&#xE945;" 
                                       FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                                       FontSize="20"
                                       TextColor="#03A9F4" />
                                <Label Text="Respiratory Rate" FontSize="12" TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                            </HorizontalStackLayout>
                            <Entry Text="{Binding RespiratoryRate}" 
                                   Keyboard="Numeric"
                                   Placeholder="12-20">
                                <Entry.Behaviors>
                                    <toolkit:NumericValidationBehavior MinimumValue="8" MaximumValue="40" />
                                </Entry.Behaviors>
                            </Entry>
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Urine Analysis -->
            <Border StrokeThickness="1"
                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                    BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="15">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="15">
                    <Label Text="Urine Analysis" FontSize="18" FontAttributes="Bold" />

                    <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,*" RowSpacing="15" ColumnSpacing="15">
                        <VerticalStackLayout Grid.Row="0" Grid.ColumnSpan="2">
                            <Label Text="Output (ml)" FontSize="12" TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                            <Entry Text="{Binding UrineOutput}" 
                                   Placeholder="Amount in ml" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Row="1" Grid.Column="0">
                            <Label Text="Protein" FontSize="12" TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                            <Picker SelectedItem="{Binding UrineProtein}">
                                <Picker.ItemsSource>
                                    <x:Array Type="{x:Type x:String}">
                                        <x:String>Nil</x:String>
                                        <x:String>Trace</x:String>
                                        <x:String>+</x:String>
                                        <x:String>++</x:String>
                                        <x:String>+++</x:String>
                                    </x:Array>
                                </Picker.ItemsSource>
                            </Picker>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Row="1" Grid.Column="1">
                            <Label Text="Acetone" FontSize="12" TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                            <Picker SelectedItem="{Binding UrineAcetone}">
                                <Picker.ItemsSource>
                                    <x:Array Type="{x:Type x:String}">
                                        <x:String>Nil</x:String>
                                        <x:String>+</x:String>
                                        <x:String>++</x:String>
                                        <x:String>+++</x:String>
                                    </x:Array>
                                </Picker.ItemsSource>
                            </Picker>
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Recorded By -->
            <Border StrokeThickness="1"
                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                    BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                    Padding="15">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
                <VerticalStackLayout>
                    <Label Text="Recorded By" FontSize="12" TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                    <Entry Text="{Binding RecordedBy}" 
                           Placeholder="Staff name" />
                </VerticalStackLayout>
            </Border>

            <!-- Summary Alert -->
            <Border StrokeThickness="2"
                    Stroke="#EF5350"
                    BackgroundColor="{AppThemeBinding Light=#FFEBEE, Dark=#3E2723}"
                    Padding="15"
                    IsVisible="{Binding HasAbnormalValues}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
                <HorizontalStackLayout Spacing="10">
                    <Label Text="âš " FontSize="24" TextColor="#EF5350" />
                    <VerticalStackLayout VerticalOptions="Center">
                        <Label Text="Abnormal Values Detected" 
                               FontAttributes="Bold"
                               TextColor="#EF5350" />
                        <Label Text="{Binding AbnormalValuesSummary}" 
                               FontSize="12"
                               TextColor="#EF5350" />
                    </VerticalStackLayout>
                </HorizontalStackLayout>
            </Border>

            <!-- Action Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="15" Margin="0,20,0,40">
                <Button Grid.Column="0"
                        Text="Cancel"
                        Command="{Binding CancelCommand}"
                        BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                        TextColor="{AppThemeBinding Light=#333, Dark=White}"
                        HeightRequest="50"
                        CornerRadius="10" />

                <Button Grid.Column="1"
                        Text="Save Vital Signs"
                        Command="{Binding SaveCommand}"
                        BackgroundColor="#4CAF50"
                        TextColor="White"
                        HeightRequest="50"
                        CornerRadius="10" />
            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>