<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.PatientPage"
             xmlns:cards="clr-namespace:Syncfusion.Maui.Cards;assembly=Syncfusion.Maui.Cards"
             xmlns:buttons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
             xmlns:core="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
             xmlns:effects="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
             xmlns:picker="clr-namespace:Syncfusion.Maui.Picker;assembly=Syncfusion.Maui.Picker"
             xmlns:editors="clr-namespace:Syncfusion.Maui.Inputs;assembly=Syncfusion.Maui.Inputs"
             xmlns:chip="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:models="clr-namespace:MAAME.DROMO.PARTOGRAPH.MODEL;assembly=MAAME.DROMO.PARTOGRAPH.MODEL"
             xmlns:fonts="clr-namespace:Fonts"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             Title="Patient Registration"
             BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#121212}">
    <!--<ContentPage.ToolbarItems>
        <ToolbarItem Text="Edit" 
                     Command="{Binding ToggleEditModeCommand}"/>
        --><!--IconImageSource="{FontImageSource FontFamily={x:Static fonts:FluentUI.FontFamily}, Glyph=&#xE70F;, Color=White}"--><!--
        <ToolbarItem Text="Delete" 
                     Command="{Binding DeleteCommand}" />
        --><!--IconImageSource="{FontImageSource FontFamily={x:Static fonts:FluentUI.FontFamily}, Glyph=&#xE74D;, Color=White}"--><!--
    </ContentPage.ToolbarItems>-->


    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Hospital Theme Colors -->
            <Color x:Key="PrimaryBlue">#0078D4</Color>
            <Color x:Key="PrimaryLightBlue">#40E0FF</Color>
            <Color x:Key="SecondaryGreen">#107C10</Color>
            <Color x:Key="AccentTeal">#008575</Color>
            <Color x:Key="SurfaceWhite">#FFFFFF</Color>
            <Color x:Key="BackgroundGray">#F8F9FA</Color>
            <Color x:Key="TextPrimary">#323130</Color>
            <Color x:Key="TextSecondary">#605E5C</Color>
            <Color x:Key="BorderLight">#E1DFDD</Color>
            <Color x:Key="ErrorRed">#D13438</Color>
            <Color x:Key="SuccessGreen">#107C10</Color>
            <Color x:Key="WarningOrange">#FF8C00</Color>

            <!-- Gradients -->
            <LinearGradientBrush x:Key="HeaderGradient" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#0078D4" Offset="0.0" />
                <GradientStop Color="#40E0FF" Offset="1.0" />
            </LinearGradientBrush>

            <!-- Card Styles -->
            <Style x:Key="SectionCard" TargetType="cards:SfCardView">
                <Setter Property="BackgroundColor" Value="{StaticResource SurfaceWhite}" />
                <Setter Property="CornerRadius" Value="16" />
                <Setter Property="Shadow" Value="True" />
                <Setter Property="Margin" Value="16,8" />
            </Style>

            <Style x:Key="HeaderCard" TargetType="cards:SfCardView">
                <Setter Property="Background" Value="{StaticResource HeaderGradient}" />
                <Setter Property="CornerRadius" Value="20" />
                <Setter Property="Shadow" Value="True" />
                <Setter Property="Margin" Value="16,16,16,8" />
            </Style>

            <!-- Button Styles -->
            <Style x:Key="PrimaryButton" TargetType="buttons:SfButton">
                <Setter Property="Background" Value="{StaticResource PrimaryBlue}" />
                <Setter Property="TextColor" Value="{StaticResource SurfaceWhite}" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HeightRequest" Value="50" />
            </Style>

            <Style x:Key="SecondaryButton" TargetType="buttons:SfButton">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="TextColor" Value="{StaticResource PrimaryBlue}" />
                <Setter Property="Stroke" Value="{StaticResource PrimaryBlue}" />
                <Setter Property="StrokeThickness" Value="2" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HeightRequest" Value="48" />
            </Style>

            <!-- Input Styles -->
            <Style x:Key="PatientInput" TargetType="core:SfTextInputLayout">
                <Setter Property="ContainerType" Value="Outlined" />
                <Setter Property="OutlineCornerRadius" Value="8" />
                <!--<Setter Property="Stroke" Value="{StaticResource BorderLight}" />-->
                <!--<Setter Property="FocusedStroke" Value="{StaticResource PrimaryBlue}" />-->
                <!--<Setter Property="ContainerBackground" Value="{StaticResource SurfaceWhite}" />-->
                <!--<Setter Property="Margin" Value="0,4" />-->
            </Style>

            <!-- Typography Styles -->
            <Style x:Key="SectionTitle" TargetType="Label">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource TextPrimary}" />
                <Setter Property="Margin" Value="0,0,0,8" />
            </Style>

            <Style x:Key="HeaderTitle" TargetType="Label">
                <Setter Property="FontSize" Value="24" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource SurfaceWhite}" />
                <Setter Property="HorizontalTextAlignment" Value="Center" />
            </Style>

            <Style x:Key="HeaderSubtitle" TargetType="Label">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TextColor" Value="#E6FFFFFF" />
                <Setter Property="HorizontalTextAlignment" Value="Center" />
            </Style>

            <Style x:Key="ErrorText" TargetType="Label">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="TextColor" Value="{StaticResource ErrorRed}" />
                <Setter Property="HorizontalTextAlignment" Value="Start" />
            </Style>

        </ResourceDictionary>

        <x:Static Member="system:DateTime.Today" x:Key="Today" />
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout Spacing="0" Padding="0,0,0,10">

            <!-- Header Card -->
            <!--<Label Text="ðŸ‘¤ Demographics" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />-->
            <Label Text="Demographics" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />

            <!-- Patient Demographics Section -->

            <StackLayout Padding="20" Spacing="0">

                <!-- Patient ID -->
                <core:SfTextInputLayout Hint="MRN *"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Medical Record Number/Folder Number">
                    <Entry Text="{Binding HospitalNumber, Mode=TwoWay}"
                           ReturnType="Next" />
                </core:SfTextInputLayout>

                <!-- Name Fields -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="First Name *"
                                                Style="{StaticResource PatientInput}">
                        <Entry Text="{Binding FirstName, Mode=TwoWay}"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1" Hint="Last Name *" Style="{StaticResource PatientInput}">
                        <Entry Text="{Binding LastName, Mode=TwoWay}"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>
                </Grid>

                <!-- Date of Birth / Age -->
                <Grid ColumnDefinitions="2*,*" ColumnSpacing="12">
                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Date of Birth *"
                                                Style="{StaticResource PatientInput}">
                        <DatePicker Date="{Binding DateOfBirth, Mode=TwoWay}"
                                       Format="dd-MM-yyyy" MinimumDate="01/01/1950" MaximumDate="{StaticResource Today}" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1" Hint="Age *"
                                                Style="{StaticResource PatientInput}">
                        <editors:SfNumericEntry Value="{Binding Age, Mode=TwoWay}"
                                                ReturnType="Next"
                                                IsEditable="{Binding AgeIsReadOnly}"
                                                    Minimum="0"
                                                Maximum="60"
                                                MaximumNumberDecimalDigits="0" />
                    </core:SfTextInputLayout>
                </Grid>

                <!-- Blood Group -->
                <core:SfTextInputLayout Hint="Blood Group *"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Patient's blood type">
                    <Picker ItemsSource="{Binding BloodGroupOptions}"
                            SelectedItem="{Binding BloodGroup, Mode=TwoWay}" />
                </core:SfTextInputLayout>

                <!-- Contact Information -->
                <core:SfTextInputLayout Hint="Phone Number"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Primary contact number">
                    <Entry Text="{Binding PhoneNumber, Mode=TwoWay}"
                               Keyboard="Telephone"
                               ReturnType="Next" />
                </core:SfTextInputLayout>

                <!-- Address -->
                <core:SfTextInputLayout Hint="Address"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Complete residential address">
                    <Entry Text="{Binding Address, Mode=TwoWay}"
                               ReturnType="Next" />
                </core:SfTextInputLayout>

            </StackLayout>

            <!--<Label Text="ðŸš¨ Emergency Contact" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />-->
            <Label Text="Emergency Contact" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />

            <!-- Emergency Contact Section -->

            <StackLayout Padding="20" Spacing="0">
                <Grid ColumnDefinitions="2*,*" ColumnSpacing="12">
                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Emergency Contact Name"
                                                Style="{StaticResource PatientInput}">
                        <Entry Text="{Binding EmergencyContactName, Mode=TwoWay}"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Relationship"
                                                Style="{StaticResource PatientInput}">
                        <Entry Text="{Binding EmergencyContactRelationship, Mode=TwoWay}"
                                   ReturnType="Next" />
                    </core:SfTextInputLayout>
                </Grid>

                <core:SfTextInputLayout Hint="Emergency Contact Phone"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Available 24/7">
                    <Entry Text="{Binding EmergencyContactPhone, Mode=TwoWay}"
                               Keyboard="Telephone"
                               ReturnType="Next" />
                </core:SfTextInputLayout>
            </StackLayout>

            <!-- Anthropometric Data Section -->
            <Label Text="âš–ï¸ Anthropometric Data" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />

            <StackLayout Padding="20" Spacing="0">

                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">

                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Weight (kg)"
                                                Style="{StaticResource PatientInput}">
                        <editors:SfNumericEntry Value="{Binding Weight, Mode=TwoWay}"
                                                Minimum="30"
                                                Maximum="200"
                                                MaximumNumberDecimalDigits="1"
                                                ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Height (cm)"
                                                Style="{StaticResource PatientInput}">
                        <editors:SfNumericEntry Value="{Binding Height, Mode=TwoWay}"
                                                Minimum="100"
                                                Maximum="220"
                                                MaximumNumberDecimalDigits="0"
                                                ReturnType="Next" />
                    </core:SfTextInputLayout>
                </Grid>

                <!-- Calculated BMI Display -->
                <Border BackgroundColor="{Binding BmiColor}"
                        Padding="12"
                        Margin="0,8,0,0"
                        StrokeShape="RoundRectangle 8"
                        IsVisible="{Binding HasBmiData}">
                    <StackLayout>
                        <Label Text="{Binding FormattedBmi}"
                               TextColor="White"
                               FontSize="16"
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center" />
                        <Label Text="{Binding BmiCategory}"
                               TextColor="White"
                               FontSize="12"
                               HorizontalTextAlignment="Center" />
                    </StackLayout>
                </Border>

            </StackLayout>

            <!-- Obstetric History Section -->
            <!--<Label Text="ðŸ¤± Obstetric History" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />-->
            <Label Text="Obstetric History" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />

            <StackLayout Padding="20" Spacing="0">

                <!-- Gravida and Para -->
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto, Auto" ColumnSpacing="12">
                    
                        <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Gravida (G)"
                                                Style="{StaticResource PatientInput}"
                                                HelperText="Total pregnancies">
                       
                        <editors:SfNumericEntry Value="{Binding Gravidity, Mode=TwoWay}" 
                                                    ReturnType="Next" 
                                                    Maximum="20"
                                                    Minimum="0" 
                                                MaximumNumberDecimalDigits="0"/>
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Parity (P)"
                                                Style="{StaticResource PatientInput}"
                                                HelperText="Previous births">
                        
                        <editors:SfNumericEntry Value="{Binding Parity, Mode=TwoWay}" 
                                                    ReturnType="Next" 
                                                    Maximum="20"
                                                    Minimum="0"
                                                MaximumNumberDecimalDigits="0"/>
                        </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="0" Grid.Row="1"
                            Hint="Abortion"
                            Style="{StaticResource PatientInput}"
                            HelperText="Number of abortions"
                                            IsVisible="{Binding AbortionVisibility, Mode=OneWay}">

                        <editors:SfNumericEntry Value="{Binding Abortion, Mode=TwoWay}"
                                                    ReturnType="Next"
                                                    Maximum="20"
                                                    Minimum="0"
                                                MaximumNumberDecimalDigits="0"/>
                        </core:SfTextInputLayout>
                </Grid>

                <!-- Previous Pregnancy Outcomes -->
                <Label Text="ðŸ“‹ Previous Pregnancy Outcomes"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{StaticResource TextPrimary}"
                       Margin="0,12,0,4"
                       IsVisible="{Binding HasPreviousPregnancies}" />

                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12" IsVisible="{Binding HasPreviousPregnancies}">

                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Live Births"
                                                Style="{StaticResource PatientInput}">
                        <editors:SfNumericEntry Value="{Binding LiveBirths, Mode=TwoWay}"
                                                Minimum="0"
                                                Maximum="20"
                                                MaximumNumberDecimalDigits="0"
                                                ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Stillbirths"
                                                Style="{StaticResource PatientInput}">
                        <editors:SfNumericEntry Value="{Binding Stillbirths, Mode=TwoWay}"
                                                Minimum="0"
                                                Maximum="20"
                                                MaximumNumberDecimalDigits="0"
                                                ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="2"
                                                Hint="Neo. Deaths"
                                                Style="{StaticResource PatientInput}">
                        <editors:SfNumericEntry Value="{Binding NeonatalDeaths, Mode=TwoWay}"
                                                Minimum="0"
                                                Maximum="20"
                                                MaximumNumberDecimalDigits="0"
                                                ReturnType="Next" />
                    </core:SfTextInputLayout>
                </Grid>

                <!-- Previous C-Section -->
                <StackLayout Orientation="Horizontal" Spacing="12" Margin="0,8,0,0" IsVisible="{Binding HasPreviousPregnancies}">
                    <CheckBox IsChecked="{Binding HasPreviousCSection, Mode=TwoWay}"
                              Color="{StaticResource ErrorRed}"
                              VerticalOptions="Center" />
                    <Label Text="Previous Cesarean Section (VBAC Risk)"
                           FontSize="14"
                           TextColor="{StaticResource ErrorRed}"
                           FontAttributes="Bold"
                           VerticalOptions="Center" />
                </StackLayout>

                <core:SfTextInputLayout Hint="Number of Previous C-Sections"
                                            Style="{StaticResource PatientInput}"
                                            IsVisible="{Binding HasPreviousCSection}">
                    <editors:SfNumericEntry Value="{Binding NumberOfPreviousCsections, Mode=TwoWay}"
                                            Minimum="1"
                                            Maximum="5"
                                            MaximumNumberDecimalDigits="0"
                                            ReturnType="Next" />
                </core:SfTextInputLayout>

                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <core:SfTextInputLayout Grid.Column="0"
                            Hint="Estimated Delivery Date *"
                            Style="{StaticResource PatientInput}"
                            HelperText="EDD or LMP required">
                        <DatePicker Date="{Binding ExpectedDeliveryDate, Mode=TwoWay}" Format="dd-MM-yyyy" MinimumDate="01/01/1950" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                            Hint="Last Menstrual Date *"
                            Style="{StaticResource PatientInput}"
                            HelperText="EDD or LMP required">
                        <DatePicker Date="{Binding LastMenstrualDate, Mode=TwoWay}" Format="dd-MM-yyyy" MinimumDate="01/01/1950" MaximumDate="{StaticResource Today}" />
                    </core:SfTextInputLayout>
                </Grid>
                
                <Label Text="{Binding FormattedGestationalAge}"
                           FontSize="18"
                           TextColor="{StaticResource AccentTeal}"
                           FontAttributes="Bold"
                           Margin="0,4,0,0"
                       Visual="{Binding GestationalAgeVisibility}"/>

            </StackLayout>

            <!-- Medical Information Section -->
            <!--<Label Text="ðŸ¥ Medical Information" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />-->
            <Label Text="Medical Information" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />

            <StackLayout Padding="20" Spacing="0">
                <!-- Risk Factors -->
                <!--<core:SfTextInputLayout Hint="Risk Factors"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="High-risk conditions or complications">
                    <Entry Text="{Binding RiskFactors, Mode=TwoWay}" ReturnType="Next" />
                </core:SfTextInputLayout>-->

                <chip:SfChipGroup ItemsSource="{Binding RiskFactors}" 
                  DisplayMemberPath="Name" Margin="0,8,16,8" FlowDirection="MatchParent"  />

                <core:SfTextInputLayout Hint="Risk Factors"
                            Style="{StaticResource PatientInput}"
                            HelperText="Clinical assessment of risk factors" >
                    <!--<Entry ReturnType="Next" />-->
                    <Entry Completed="RiskFactorsEntry_Completed" Unfocused="RiskFactorsEntry_Completed"
                                   ReturnType="Next" />
                </core:SfTextInputLayout>
            </StackLayout>

            <!-- Labour Information Section -->
            <Label Text="â±ï¸ Labour Information" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />

            <StackLayout Padding="20" Spacing="0">
                <!-- Labour Onset -->
                <Label Text="Labour Onset Date &amp; Time" 
                           FontSize="14" 
                           FontAttributes="Bold" 
                           TextColor="{StaticResource TextPrimary}"
                           Margin="0,0,0,4" />

                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Date *"
                                                Style="{StaticResource PatientInput}">
                        <DatePicker Date="{Binding LaborStartDate, Mode=TwoWay}" Format="dd-MM-yyyy" MinimumDate="01/01/1950" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Time *"
                                                Style="{StaticResource PatientInput}">
                        <TimePicker Time="{Binding LaborStartTime, Mode=TwoWay}" Format="HH:mm" />
                    </core:SfTextInputLayout>
                </Grid>

                <!-- Active Labour Diagnosis -->
                <!--<Label Text="â±ï¸ Active Labour Diagnosis" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />-->
                <Label Text="Active Labour Diagnosis" Style="{StaticResource SectionTitle}" Margin="10,10,0,0" />

                <chip:SfChipGroup ItemsSource="{Binding Diagnoses}" 
                  DisplayMemberPath="Name" Margin="0,8,16,8" FlowDirection="MatchParent"  />

                <core:SfTextInputLayout Hint="Active Labour Diagnosis"
                            Style="{StaticResource PatientInput}"
                            HelperText="Clinical assessment of active labour" >
                    <!--<Entry ReturnType="Next" />-->
                    <Entry Text="{Binding ActiveLabourDiagnosis}"
                                Completed="Entry_Completed" Unfocused="Entry_Completed"
                                   ReturnType="Next" />

                </core:SfTextInputLayout>


                <!-- Ruptured Membrane -->
                <Label Text="Ruptured Membrane Date &amp; Time" 
                           FontSize="14" 
                           FontAttributes="Bold" 
                           TextColor="{StaticResource TextPrimary}"
                           Margin="0,8,0,4" />

                <StackLayout Orientation="Horizontal" Spacing="12">
                    <CheckBox IsChecked="{Binding HasRupturedMembrane}"
                                  Color="{StaticResource PrimaryBlue}"
                                  VerticalOptions="Center" />
                    <Label Text="Membrane has ruptured"
                               FontSize="14"
                               TextColor="{StaticResource TextPrimary}"
                               VerticalOptions="Center" />
                </StackLayout>

                <Grid ColumnDefinitions="*,*"
                          ColumnSpacing="12"
                          IsVisible="{Binding HasRupturedMembrane}">
                    <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Rupture Date"
                                                Style="{StaticResource PatientInput}">
                        <DatePicker Date="{Binding RupturedMembraneDate, Mode=TwoWay}"
                                       Format="dd-MM-yyyy" MinimumDate="01/01/1950" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Column="1"
                                            Hint="Rupture Time"
                                            Style="{StaticResource PatientInput}">
                        <TimePicker Time="{Binding RupturedMembraneTime, Mode=TwoWay}"
                                       Format="HH:mm" />
                    </core:SfTextInputLayout>
                </Grid>

                <!-- Cervical Dilatation on Admission (CRITICAL) -->
                <Label Text="Cervical Dilatation Assessment"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{StaticResource TextPrimary}"
                       Margin="0,12,0,4" />

                <core:SfTextInputLayout Hint="Dilatation on Arrival (cm) *"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Cervical dilatation at admission (0-10 cm)">
                    <editors:SfNumericEntry Value="{Binding CervicalDilationOnAdmission, Mode=TwoWay}"
                                            ReturnType="Next"
                                            Minimum="0"
                                            Maximum="10"
                                            MaximumNumberDecimalDigits="0"
                                            Placeholder="Enter dilatation in cm" />
                </core:SfTextInputLayout>

                <!-- Labor Status Indicator -->
                <Border BackgroundColor="{Binding LaborStatusColor}"
                        Padding="12"
                        Margin="0,8,0,0"
                        StrokeShape="RoundRectangle 8"
                        IsVisible="{Binding HasDilatationValue}">
                    <Label Text="{Binding LaborStatusIndicator}"
                           TextColor="White"
                           FontSize="14"
                           FontAttributes="Bold"
                           HorizontalTextAlignment="Center" />
                </Border>

            </StackLayout>

            <!-- Bishop Score Calculator Section -->
            <Label Text="ðŸ”¬ Bishop Score (Induction Assessment)"
                   Style="{StaticResource SectionTitle}"
                   Margin="10,10,0,0" />

            <StackLayout Padding="20" Spacing="0">

                <StackLayout Orientation="Horizontal" Spacing="12" Margin="0,0,0,8">
                    <CheckBox IsChecked="{Binding IsInductionPlanned, Mode=TwoWay}"
                              Color="{StaticResource PrimaryBlue}"
                              VerticalOptions="Center" />
                    <Label Text="Patient scheduled for labor induction"
                           FontSize="14"
                           TextColor="{StaticResource TextPrimary}"
                           VerticalOptions="Center" />
                </StackLayout>

                <!-- Bishop Score Components -->
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="12" IsVisible="{Binding IsInductionPlanned}">

                    <!-- Row 0: Dilatation and Effacement -->
                    <core:SfTextInputLayout Grid.Row="0" Grid.Column="0"
                                                Hint="Dilatation (cm)"
                                                Style="{StaticResource PatientInput}">
                        <editors:SfNumericEntry Value="{Binding BishopDilatation, Mode=TwoWay}"
                                                Minimum="0"
                                                Maximum="10"
                                                MaximumNumberDecimalDigits="0" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Row="0" Grid.Column="1"
                                                Hint="Effacement (%)"
                                                Style="{StaticResource PatientInput}">
                        <editors:SfNumericEntry Value="{Binding BishopEffacement, Mode=TwoWay}"
                                                Minimum="0"
                                                Maximum="100"
                                                MaximumNumberDecimalDigits="0" />
                    </core:SfTextInputLayout>

                    <!-- Row 1: Station and Consistency -->
                    <core:SfTextInputLayout Grid.Row="1" Grid.Column="0"
                                                Hint="Station"
                                                Style="{StaticResource PatientInput}">
                        <Picker ItemsSource="{Binding StationOptions}"
                                SelectedItem="{Binding BishopStation, Mode=TwoWay}" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Grid.Row="1" Grid.Column="1"
                                                Hint="Consistency"
                                                Style="{StaticResource PatientInput}">
                        <Picker ItemsSource="{Binding ConsistencyOptions}"
                                SelectedItem="{Binding BishopConsistency, Mode=TwoWay}" />
                    </core:SfTextInputLayout>

                    <!-- Row 2: Position -->
                    <core:SfTextInputLayout Grid.Row="2" Grid.Column="0"
                                                Hint="Position"
                                                Style="{StaticResource PatientInput}">
                        <Picker ItemsSource="{Binding PositionOptions}"
                                SelectedItem="{Binding BishopPosition, Mode=TwoWay}" />
                    </core:SfTextInputLayout>

                </Grid>

                <!-- Calculated Bishop Score Display -->
                <Border BackgroundColor="{StaticResource PrimaryBlue}"
                        Padding="16"
                        Margin="0,16,0,0"
                        StrokeShape="RoundRectangle 12"
                        IsVisible="{Binding IsInductionPlanned}">
                    <StackLayout Orientation="Horizontal" HorizontalOptions="Center">
                        <Label Text="Bishop Score: "
                               TextColor="White"
                               FontSize="18"
                               FontAttributes="Bold" />
                        <Label Text="{Binding CalculatedBishopScore}"
                               TextColor="White"
                               FontSize="24"
                               FontAttributes="Bold" />
                        <Label Text="{Binding BishopScoreInterpretation}"
                               TextColor="White"
                               FontSize="14"
                               Margin="8,0,0,0" />
                    </StackLayout>
                </Border>

            </StackLayout>

            <!-- Risk Assessment Display Section -->
            <Label Text="âš ï¸ Risk Assessment"
                   Style="{StaticResource SectionTitle}"
                   Margin="10,10,0,0" />

            <StackLayout Padding="20" Spacing="0">

                <!-- Risk Level Card -->
                <Border BackgroundColor="{Binding RiskColor}"
                        Padding="16"
                        Margin="0,0,0,12"
                        StrokeShape="RoundRectangle 12">
                    <StackLayout>
                        <Label Text="{Binding RiskLevel}"
                               TextColor="White"
                               FontSize="20"
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center" />
                        <Label Text="{Binding RiskScore, StringFormat='Risk Score: {0}'}"
                               TextColor="White"
                               FontSize="14"
                               HorizontalTextAlignment="Center"
                               Margin="0,4,0,0" />
                    </StackLayout>
                </Border>

                <!-- Risk Factors List -->
                <Label Text="Risk Factors Identified:"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{StaticResource TextPrimary}"
                       Margin="0,0,0,8" />

                <CollectionView ItemsSource="{Binding RiskAssessmentFactors}"
                                Margin="0,0,0,12">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Label Text="{Binding .}"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}"
                                   Margin="0,2" />
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Recommended Actions List -->
                <Label Text="Recommended Actions:"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{StaticResource TextPrimary}"
                       Margin="0,8,0,8" />

                <CollectionView ItemsSource="{Binding RecommendedActions}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Label Text="{Binding .}"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}"
                                   FontAttributes="Bold"
                                   Margin="0,2" />
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </StackLayout>

            <!-- Action Buttons -->
            <StackLayout Padding="16" Spacing="12">

                <!-- Error Messages -->
                <Label Text="{Binding ErrorMessage}"
                   Style="{StaticResource ErrorText}"
                   IsVisible="{Binding HasError}"
                   Margin="0,0,0,8" />

                <!-- Save and Continue Button -->
                <buttons:SfButton Text="Save Patient &amp; Start Partograph" 
                              Style="{StaticResource PrimaryButton}"
                              Command="{Binding SaveCommand}">
                    <buttons:SfButton.ImageSource>
                        <FontImageSource FontFamily="MaterialIcons"
                                   Glyph="&#xe161;"
                                   Size="20"
                                   Color="{StaticResource SurfaceWhite}" />
                    </buttons:SfButton.ImageSource>
                </buttons:SfButton>

                <!-- Save Draft Button -->
                <buttons:SfButton Text="Save as Draft" 
                              Style="{StaticResource SecondaryButton}"
                              Command="{Binding SaveDraftCommand}">
                    <buttons:SfButton.ImageSource>
                        <FontImageSource FontFamily="MaterialIcons"
                                   Glyph="&#xe161;"
                                   Size="18"
                                   Color="{StaticResource PrimaryBlue}" />
                    </buttons:SfButton.ImageSource>
                </buttons:SfButton>

                <!-- Quick Action Grid -->
                <!--<Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,16,0,0">
                    <buttons:SfButton Grid.Column="0"
                                 Text="ðŸ“‹ View Template"
                                 FontSize="12"
                                 HeightRequest="40"
                                 CornerRadius="8"
                                 Background="{StaticResource AccentTeal}"
                                 TextColor="{StaticResource SurfaceWhite}"
                                 Command="{Binding ViewTemplateCommand}" />

                    <buttons:SfButton Grid.Column="1"
                                 Text="ðŸ”„ Reset Form"
                                 FontSize="12"
                                 HeightRequest="40"
                                 CornerRadius="8"
                                 Background="{StaticResource WarningOrange}"
                                 TextColor="{StaticResource SurfaceWhite}"
                                 Command="{Binding ResetFormCommand}" />
                </Grid>-->

            </StackLayout>

        </StackLayout>
    </ScrollView>
</ContentPage>