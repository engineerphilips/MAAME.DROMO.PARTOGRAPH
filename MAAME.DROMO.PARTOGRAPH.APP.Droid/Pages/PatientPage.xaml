<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.PatientPage"
             xmlns:converters="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Converters"
             xmlns:cards="clr-namespace:Syncfusion.Maui.Cards;assembly=Syncfusion.Maui.Cards"
             xmlns:buttons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
             xmlns:core="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
             xmlns:effects="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
             xmlns:picker="clr-namespace:Syncfusion.Maui.Picker;assembly=Syncfusion.Maui.Picker"
             xmlns:editors="clr-namespace:Syncfusion.Maui.Inputs;assembly=Syncfusion.Maui.Inputs"
             xmlns:chip="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:models="clr-namespace:MAAME.DROMO.PARTOGRAPH.MODEL;assembly=MAAME.DROMO.PARTOGRAPH.MODEL"
             xmlns:fonts="clr-namespace:Fonts"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             Title="Patient Registration"
             BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#121212}">
    <!--<ContentPage.ToolbarItems>
        <ToolbarItem Text="Edit" 
                     Command="{Binding ToggleEditModeCommand}"/>
        --><!--IconImageSource="{FontImageSource FontFamily={x:Static fonts:FluentUI.FontFamily}, Glyph=&#xE70F;, Color=White}"--><!--
        <ToolbarItem Text="Delete" 
                     Command="{Binding DeleteCommand}" />
        --><!--IconImageSource="{FontImageSource FontFamily={x:Static fonts:FluentUI.FontFamily}, Glyph=&#xE74D;, Color=White}"--><!--
    </ContentPage.ToolbarItems>-->

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Hospital Theme Colors -->
            <Color x:Key="PrimaryBlue">#0078D4</Color>
            <Color x:Key="PrimaryLightBlue">#40E0FF</Color>
            <Color x:Key="SecondaryGreen">#107C10</Color>
            <Color x:Key="AccentTeal">#008575</Color>
            <Color x:Key="SurfaceWhite">#FFFFFF</Color>
            <Color x:Key="BackgroundGray">#F8F9FA</Color>
            <Color x:Key="TextPrimary">#323130</Color>
            <Color x:Key="TextSecondary">#605E5C</Color>
            <Color x:Key="BorderLight">#E1DFDD</Color>
            <Color x:Key="ErrorRed">#D13438</Color>
            <Color x:Key="SuccessGreen">#107C10</Color>
            <Color x:Key="WarningOrange">#FF8C00</Color>

            <!-- Gradients -->
            <LinearGradientBrush x:Key="HeaderGradient" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#0078D4" Offset="0.0" />
                <GradientStop Color="#40E0FF" Offset="1.0" />
            </LinearGradientBrush>

            <!-- Card Styles -->
            <Style x:Key="SectionBorder" TargetType="Border">
                <Setter Property="BackgroundColor" Value="{StaticResource SurfaceWhite}" />
                <!--<Setter Property="CornerRadius" Value="16" />-->
                <!--<Setter Property="Shadow" Value="True" />-->
                <Setter Property="Margin" Value="16,8" />
            </Style>

            <!-- Card Styles -->
            <Style x:Key="SectionCard" TargetType="cards:SfCardView">
                <Setter Property="BackgroundColor" Value="{StaticResource SurfaceWhite}" />
                <Setter Property="CornerRadius" Value="16" />
                <!--<Setter Property="Shadow" Value="True" />-->
                <Setter Property="Margin" Value="16,8" />
            </Style>

            <Style x:Key="HeaderCard" TargetType="cards:SfCardView">
                <Setter Property="Background" Value="{StaticResource HeaderGradient}" />
                <Setter Property="CornerRadius" Value="20" />
                <!--<Setter Property="Shadow" Value="True" />-->
                <Setter Property="Margin" Value="16,16,16,8" />
            </Style>

            <!-- Button Styles -->
            <Style x:Key="PrimaryButton" TargetType="buttons:SfButton">
                <Setter Property="Background" Value="{StaticResource PrimaryBlue}" />
                <Setter Property="TextColor" Value="{StaticResource SurfaceWhite}" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HeightRequest" Value="50" />
            </Style>

            <Style x:Key="SecondaryButton" TargetType="buttons:SfButton">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="TextColor" Value="{StaticResource PrimaryBlue}" />
                <Setter Property="Stroke" Value="{StaticResource PrimaryBlue}" />
                <Setter Property="StrokeThickness" Value="2" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HeightRequest" Value="48" />
            </Style>

            <!-- Input Styles -->
            <Style x:Key="PatientInput" TargetType="core:SfTextInputLayout">
                <Setter Property="ContainerType" Value="Outlined" />
                <Setter Property="OutlineCornerRadius" Value="8" />
                <Setter Property="Stroke" Value="{StaticResource PrimaryBlue}" />
                <!--<Setter Property="Stroke" Value="{StaticResource BorderLight}" />-->
                <!--<Setter Property="FocusedStroke" Value="{StaticResource PrimaryBlue}" />-->
                <!--<Setter Property="ContainerBackground" Value="{StaticResource SurfaceWhite}" />-->
                <!--<Setter Property="Margin" Value="0,4" />-->
            </Style>

            <!-- Typography Styles -->
            <Style x:Key="SectionTitle" TargetType="Label">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource TextPrimary}" />
                <Setter Property="Margin" Value="0,0,0,8" />
            </Style>

            <Style x:Key="HeaderTitle" TargetType="Label">
                <Setter Property="FontSize" Value="24" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource SurfaceWhite}" />
                <Setter Property="HorizontalTextAlignment" Value="Center" />
            </Style>

            <Style x:Key="HeaderSubtitle" TargetType="Label">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TextColor" Value="#E6FFFFFF" />
                <Setter Property="HorizontalTextAlignment" Value="Center" />
            </Style>

            <Style x:Key="ErrorText" TargetType="Label">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="TextColor" Value="{StaticResource ErrorRed}" />
                <Setter Property="HorizontalTextAlignment" Value="Start" />
            </Style>

            <converters:InitialsConverter x:Key="StringInitialsConverter" />
            <converters:IsNotNullConverter x:Key="IsNotNullConverter" />
            <converters:IsNotNullOrEmptyConverter x:Key="IsNotNullOrEmptyConverter" />
            <converters:EqualConverter x:Key="EqualConverter" />
        </ResourceDictionary>

        <x:Static Member="system:DateTime.Today" x:Key="Today" />
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout Spacing="0" Padding="0,0,0,10">

            <!-- Patient Demographics Section -->
            <Border Style="{StaticResource SectionBorder}" Margin="16,16,16,8">
                <StackLayout Padding="16" Spacing="8">
                    <!-- Section Header with Icon -->
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" Margin="0,0,0,8">
                        <!--<Border Grid.Column="0"
                                BackgroundColor="{StaticResource PrimaryBlue}"
                                WidthRequest="40"
                                HeightRequest="40"
                                StrokeShape="RoundRectangle 10">
                            <Label Text="&#xE7FD;"
                                   FontFamily="MaterialIcons"
                                   FontSize="20"
                                   TextColor="White"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>-->
                        <StackLayout Grid.Column="1" VerticalOptions="Center">
                            <Label Text="Patient Demographics"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}" />
                            <Label Text="Basic patient identification and contact details"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}" />
                        </StackLayout>
                    </Grid>

                    <!-- Patient ID -->
                    <core:SfTextInputLayout Hint="MRN *"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Medical Record Number/Folder Number">
                        <Entry Text="{Binding HospitalNumber, Mode=TwoWay}"
                               ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <!-- Name Fields -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <core:SfTextInputLayout Grid.Column="0"
                                                Hint="First Name *"
                                                Style="{StaticResource PatientInput}">
                            <Entry Text="{Binding FirstName, Mode=TwoWay}"
                                   ReturnType="Next" />
                        </core:SfTextInputLayout>

                        <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Last Name *"
                                                Style="{StaticResource PatientInput}">
                            <Entry Text="{Binding LastName, Mode=TwoWay}"
                                   ReturnType="Next" />
                        </core:SfTextInputLayout>
                    </Grid>

                    <!-- Date of Birth / Age -->
                    <Grid ColumnDefinitions="2*,*" ColumnSpacing="12">
                        <Grid Grid.Column="0">
                            <core:SfTextInputLayout Hint="Date of Birth *"
                                                    Style="{StaticResource PatientInput}">
                                <Entry Text="{Binding DateOfBirth, Mode=OneWay, StringFormat='{0:dd-MM-yyyy}'}"
                                       IsReadOnly="True" />
                            </core:SfTextInputLayout>
                            <BoxView Color="Transparent" InputTransparent="False">
                                <BoxView.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="DateOfBirthPicker_Tapped" />
                                </BoxView.GestureRecognizers>
                            </BoxView>
                        </Grid>
                        <picker:SfDatePicker x:Name="DateOfBirthPicker"
                                             SelectedDate="{Binding DateOfBirth, Mode=TwoWay}"
                                             Format="dd_MM_yyyy"
                                             MinimumDate="01/01/1950"
                                             MaximumDate="{StaticResource Today}"
                                             Mode="Dialog"
                                             IsVisible="False">
                            <picker:SfDatePicker.HeaderView>
                                <picker:PickerHeaderView Text="Date of Birth *"
                                                         Background="{StaticResource PrimaryBlue}"
                                                         TextColor="White" />
                            </picker:SfDatePicker.HeaderView>
                        </picker:SfDatePicker>
                        
                        <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Age *"
                                                Style="{StaticResource PatientInput}">
                            <editors:SfNumericEntry Value="{Binding Age, Mode=TwoWay}"
                                                    ReturnType="Next"
                                                    IsEditable="{Binding AgeIsReadOnly}"
                                                    Minimum="0"
                                                    Maximum="60"
                                                    MaximumNumberDecimalDigits="0" />
                        </core:SfTextInputLayout>
                    </Grid>
                    
                    
                    <!-- Blood Group -->
                    <core:SfTextInputLayout Hint="Blood Group *"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Patient's blood type">
                        <Picker ItemsSource="{Binding BloodGroupOptions}"
                                SelectedItem="{Binding BloodGroup, Mode=TwoWay}"
                                Title="Select Blood Group" />
                    </core:SfTextInputLayout>

                    <!-- Contact Information -->
                    <core:SfTextInputLayout Hint="Phone Number"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Primary contact number">
                        <Entry Text="{Binding PhoneNumber, Mode=TwoWay}"
                               Keyboard="Telephone"
                               ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <!-- Address -->
                    <core:SfTextInputLayout Hint="Address"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Complete residential address">
                        <Entry Text="{Binding Address, Mode=TwoWay}"
                               ReturnType="Next" />
                    </core:SfTextInputLayout>
                </StackLayout>
            </Border>

            <!-- Emergency Contact Section -->
            <Border Style="{StaticResource SectionBorder}">
                <StackLayout Padding="16" Spacing="8">
                    <!-- Section Header with Icon -->
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" Margin="0,0,0,8">
                        <!--<Border Grid.Column="0"
                                BackgroundColor="{StaticResource ErrorRed}"
                                WidthRequest="40"
                                HeightRequest="40"
                                StrokeShape="RoundRectangle 10">
                            <Label Text="&#xE7EE;"
                                   FontFamily="MaterialIcons"
                                   FontSize="20"
                                   TextColor="White"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>-->
                        <StackLayout Grid.Column="1" VerticalOptions="Center">
                            <Label Text="Emergency Contact"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}" />
                            <Label Text="Person to contact in case of emergency"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}" />
                        </StackLayout>
                    </Grid>

                    <!-- Contact Name -->
                    <core:SfTextInputLayout Hint="Contact Name"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Full name of emergency contact">
                        <Entry Text="{Binding EmergencyContactName, Mode=TwoWay}"
                               ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <!-- Relationship Picker -->
                    <core:SfTextInputLayout Hint="Relationship *"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Select relationship to patient">
                        <Picker ItemsSource="{Binding RelationshipOptions}"
                                SelectedItem="{Binding EmergencyContactRelationship, Mode=TwoWay}"
                                Title="Select Relationship" />
                    </core:SfTextInputLayout>

                    <!-- Contact Phone -->
                    <core:SfTextInputLayout Hint="Phone Number"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Available 24/7 for emergencies">
                        <Entry Text="{Binding EmergencyContactPhone, Mode=TwoWay}"
                               Keyboard="Telephone"
                               ReturnType="Next" />
                    </core:SfTextInputLayout>
                </StackLayout>
            </Border>

            <!-- Anthropometric Data Section -->
            <Border Style="{StaticResource SectionBorder}">
                <StackLayout Padding="16" Spacing="8">
                    <!-- Section Header with Icon -->
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" Margin="0,0,0,8">
                        <!--<Border Grid.Column="0"
                                BackgroundColor="{StaticResource AccentTeal}"
                                WidthRequest="40"
                                HeightRequest="40"
                                StrokeShape="RoundRectangle 10">
                            <Label Text="&#xE915;"
                                   FontFamily="MaterialIcons"
                                   FontSize="20"
                                   TextColor="White"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>-->
                        <StackLayout Grid.Column="1" VerticalOptions="Center">
                            <Label Text="Anthropometric Data"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}" />
                            <Label Text="Physical measurements for BMI calculation"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}" />
                        </StackLayout>
                    </Grid>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Weight (kg)"
                                                Style="{StaticResource PatientInput}">
                            <editors:SfNumericEntry Value="{Binding Weight, Mode=TwoWay}"
                                                    Minimum="30"
                                                    Maximum="200"
                                                    MaximumNumberDecimalDigits="1"
                                                    ReturnType="Next" />
                        </core:SfTextInputLayout>

                        <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Height (cm)"
                                                Style="{StaticResource PatientInput}">
                            <editors:SfNumericEntry Value="{Binding Height, Mode=TwoWay}"
                                                    Minimum="100"
                                                    Maximum="220"
                                                    MaximumNumberDecimalDigits="0"
                                                    ReturnType="Next" />
                        </core:SfTextInputLayout>
                    </Grid>

                    <!-- Calculated BMI Display -->
                    <Border BackgroundColor="{Binding BmiColor}"
                            Padding="16"
                            Margin="0,8,0,0"
                            StrokeShape="RoundRectangle 12"
                            IsVisible="{Binding HasBmiData}">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                            <!--<Border Grid.Column="0"
                                    Opacity="0.3"
                                    WidthRequest="50"
                                    HeightRequest="50"
                                    StrokeShape="RoundRectangle 25">
                                <Label Text="&#xE915;"
                                       FontFamily="MaterialIcons"
                                       FontSize="24"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </Border>-->
                            <StackLayout Grid.Column="1" VerticalOptions="Center">
                                <Label Text="{Binding FormattedBmi}"
                                       FontSize="18"
                                       FontAttributes="Bold" HorizontalOptions="Center" />
                                <Label Text="{Binding BmiCategory}"
                                       FontSize="14"
                                       Opacity="0.9" HorizontalOptions="Center" />
                            </StackLayout>
                        </Grid>
                    </Border>
                </StackLayout>
            </Border>

            <!-- Obstetric History Section -->
            <Border Style="{StaticResource SectionBorder}">
                <StackLayout Padding="16" Spacing="8">
                    <!-- Section Header with Icon -->
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" Margin="0,0,0,8">
                        <!--<Border Grid.Column="0"
                                BackgroundColor="#E91E63"
                                WidthRequest="40"
                                HeightRequest="40"
                                StrokeShape="RoundRectangle 10">
                            <Label Text="&#xEA35;"
                                   FontFamily="MaterialIcons"
                                   FontSize="20"
                                   TextColor="White"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>-->
                        <StackLayout Grid.Column="1" VerticalOptions="Center">
                            <Label Text="Obstetric History"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}" />
                            <Label Text="Pregnancy history and expected delivery information"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}" />
                        </StackLayout>
                    </Grid>

                    <!-- Gravida and Para -->
                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto, Auto" ColumnSpacing="12">
                        <core:SfTextInputLayout Grid.Column="0"
                                                Hint="Gravida (G)"
                                                Style="{StaticResource PatientInput}"
                                                HelperText="Total pregnancies">
                            <editors:SfNumericEntry Value="{Binding Gravidity, Mode=TwoWay}"
                                                    ReturnType="Next"
                                                    Maximum="20"
                                                    Minimum="0"
                                                    MaximumNumberDecimalDigits="0" />
                        </core:SfTextInputLayout>

                        <core:SfTextInputLayout Grid.Column="1"
                                                Hint="Parity (P)"
                                                Style="{StaticResource PatientInput}"
                                                HelperText="Previous births">
                            <editors:SfNumericEntry Value="{Binding Parity, Mode=TwoWay}"
                                                    ReturnType="Next"
                                                    Maximum="20"
                                                    Minimum="0"
                                                    MaximumNumberDecimalDigits="0" />
                        </core:SfTextInputLayout>

                        <core:SfTextInputLayout Grid.Column="0"
                                                Grid.Row="1"
                                                Hint="Abortion"
                                                Style="{StaticResource PatientInput}"
                                                HelperText="Number of abortions"
                                                IsVisible="{Binding AbortionVisibility, Mode=OneWay}">
                            <editors:SfNumericEntry Value="{Binding Abortion, Mode=TwoWay}"
                                                    ReturnType="Next"
                                                    Maximum="20"
                                                    Minimum="0"
                                                    MaximumNumberDecimalDigits="0" />
                        </core:SfTextInputLayout>
                    </Grid>

                    <!-- Previous Pregnancy Outcomes -->
                    <Border BackgroundColor="#FFF3E0"
                            Padding="12"
                            Margin="0,8,0,0"
                            StrokeShape="RoundRectangle 8"
                            IsVisible="{Binding HasPreviousPregnancies}">
                        <StackLayout Spacing="8">
                            <Label Text="Previous Pregnancy Outcomes"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}" />

                            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12">
                                <core:SfTextInputLayout Grid.Column="0"
                                                        Hint="Live Births"
                                                        Style="{StaticResource PatientInput}">
                                    <editors:SfNumericEntry Value="{Binding LiveBirths, Mode=TwoWay}"
                                                            Minimum="0"
                                                            Maximum="20"
                                                            MaximumNumberDecimalDigits="0"
                                                            ReturnType="Next" />
                                </core:SfTextInputLayout>

                                <core:SfTextInputLayout Grid.Column="1"
                                                        Hint="Stillbirths"
                                                        Style="{StaticResource PatientInput}">
                                    <editors:SfNumericEntry Value="{Binding Stillbirths, Mode=TwoWay}"
                                                            Minimum="0"
                                                            Maximum="20"
                                                            MaximumNumberDecimalDigits="0"
                                                            ReturnType="Next" />
                                </core:SfTextInputLayout>

                                <core:SfTextInputLayout Grid.Column="2"
                                                        Hint="Neo. Deaths"
                                                        Style="{StaticResource PatientInput}">
                                    <editors:SfNumericEntry Value="{Binding NeonatalDeaths, Mode=TwoWay}"
                                                            Minimum="0"
                                                            Maximum="20"
                                                            MaximumNumberDecimalDigits="0"
                                                            ReturnType="Next" />
                                </core:SfTextInputLayout>
                            </Grid>
                        </StackLayout>
                    </Border>

                    <!-- Previous C-Section Warning -->
                    <Border BackgroundColor="#FFEBEE"
                            Padding="12"
                            Margin="0,8,0,0"
                            StrokeShape="RoundRectangle 8"
                            Stroke="{StaticResource ErrorRed}"
                            StrokeThickness="1"
                            IsVisible="{Binding HasPreviousPregnancies}">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                            <CheckBox Grid.Column="0"
                                      IsChecked="{Binding HasPreviousCSection, Mode=TwoWay}"
                                      Color="{StaticResource ErrorRed}"
                                      VerticalOptions="Center" />
                            <StackLayout Grid.Column="1" VerticalOptions="Center">
                                <Label Text="Previous Cesarean Section"
                                       FontSize="14"
                                       TextColor="{StaticResource ErrorRed}"
                                       FontAttributes="Bold" />
                                <Label Text="VBAC Risk - Requires close monitoring"
                                       FontSize="12"
                                       TextColor="{StaticResource TextSecondary}" />
                            </StackLayout>
                        </Grid>
                    </Border>

                    <core:SfTextInputLayout Hint="Number of Previous C-Sections"
                                            Style="{StaticResource PatientInput}"
                                            IsVisible="{Binding HasPreviousCSection}">
                        <editors:SfNumericEntry Value="{Binding NumberOfPreviousCsections, Mode=TwoWay}"
                                                Minimum="1"
                                                Maximum="5"
                                                MaximumNumberDecimalDigits="0"
                                                ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <!-- Delivery Dates -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,8,0,0">
                        <Grid Grid.Column="0">
                            <core:SfTextInputLayout Hint="Estimated Delivery Date *"
                                                    Style="{StaticResource PatientInput}"
                                                    HelperText="EDD or LMP required">
                                <Entry Text="{Binding ExpectedDeliveryDate, Mode=OneWay, StringFormat='{0:dd-MM-yyyy}'}"
                                       IsReadOnly="True" />
                            </core:SfTextInputLayout>
                            <BoxView Color="Transparent" InputTransparent="False">
                                <BoxView.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="EDDPicker_Tapped" />
                                </BoxView.GestureRecognizers>
                            </BoxView>
                        </Grid>
                        <picker:SfDatePicker x:Name="EDDPicker"
                                             SelectedDate="{Binding ExpectedDeliveryDate, Mode=TwoWay}"
                                             Format="dd_MM_yyyy"
                                             MinimumDate="01/01/1950"
                                             Mode="Dialog"
                                             IsVisible="False">
                            <picker:SfDatePicker.HeaderView>
                                <picker:PickerHeaderView Text="Estimated Delivery Date *"
                                                         Background="{StaticResource PrimaryBlue}"
                                                         TextColor="White" />
                            </picker:SfDatePicker.HeaderView>
                        </picker:SfDatePicker>

                        <Grid Grid.Column="1">
                            <core:SfTextInputLayout Hint="Last Menstrual Date *"
                                                    Style="{StaticResource PatientInput}"
                                                    HelperText="EDD or LMP required">
                                <Entry Text="{Binding LastMenstrualDate, Mode=OneWay, StringFormat='{0:dd-MM-yyyy}'}"
                                       IsReadOnly="True" />
                            </core:SfTextInputLayout>
                            <BoxView Color="Transparent" InputTransparent="False">
                                <BoxView.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="LMPPicker_Tapped" />
                                </BoxView.GestureRecognizers>
                            </BoxView>
                        </Grid>
                        <picker:SfDatePicker x:Name="LMPPicker"
                                             SelectedDate="{Binding LastMenstrualDate, Mode=TwoWay}"
                                             Format="dd_MM_yyyy"
                                             MinimumDate="01/01/1950"
                                             MaximumDate="{StaticResource Today}"
                                             Mode="Dialog"
                                             IsVisible="False">
                            <picker:SfDatePicker.HeaderView>
                                <picker:PickerHeaderView Text="Last Menstrual Date *"
                                                         Background="{StaticResource PrimaryBlue}"
                                                         TextColor="White" />
                            </picker:SfDatePicker.HeaderView>
                        </picker:SfDatePicker>
                    </Grid>

                    <!-- Gestational Age Display -->
                    <Border BackgroundColor="{StaticResource AccentTeal}"
                            Padding="12"
                            Margin="0,8,0,0"
                            StrokeShape="RoundRectangle 8"
                            IsVisible="{Binding GestationalAgeVisibility}">
                        <Label Text="{Binding FormattedGestationalAge}"
                               FontSize="16" 
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center" />
                    </Border>
                </StackLayout>
            </Border>

            <!-- Medical Information Section -->
            <Border Style="{StaticResource SectionBorder}">
                <StackLayout Padding="16" Spacing="8">
                    <!-- Section Header with Icon -->
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" Margin="0,0,0,8">
                        <!--<Border Grid.Column="0"
                                BackgroundColor="{StaticResource WarningOrange}"
                                WidthRequest="40"
                                HeightRequest="40"
                                StrokeShape="RoundRectangle 10">
                            <Label Text="&#xE8E8;"
                                   FontFamily="MaterialIcons"
                                   FontSize="20"
                                   TextColor="White"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>-->
                        <StackLayout Grid.Column="1" VerticalOptions="Center">
                            <Label Text="Medical Information"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}" />
                            <Label Text="Risk factors and clinical conditions"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}" />
                        </StackLayout>
                    </Grid>

                    <!-- Risk Factors Chips -->
                    <chip:SfChipGroup ItemsSource="{Binding RiskFactors}"
                                      DisplayMemberPath="Name"
                                      Margin="0,8,0,8"
                                      FlowDirection="MatchParent" />

                    <core:SfTextInputLayout Hint="Add Risk Factor"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Type and press Enter to add risk factors">
                        <Entry Completed="RiskFactorsEntry_Completed"
                               Unfocused="RiskFactorsEntry_Completed"
                               ReturnType="Next"
                               Placeholder="e.g., Hypertension, Diabetes, etc." />
                    </core:SfTextInputLayout>
                </StackLayout>
            </Border>

            <!-- Labour Information Section -->
            <Border Style="{StaticResource SectionBorder}">
                <StackLayout Padding="16" Spacing="8">
                    <!-- Section Header with Icon -->
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" Margin="0,0,0,8">
                        <!--<Border Grid.Column="0"
                                BackgroundColor="#9C27B0"
                                WidthRequest="40"
                                HeightRequest="40"
                                StrokeShape="RoundRectangle 10">
                            <Label Text="&#xE425;"
                                   FontFamily="MaterialIcons"
                                   FontSize="20"
                                   TextColor="White"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>-->
                        <StackLayout Grid.Column="1" VerticalOptions="Center">
                            <Label Text="Labour Information"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}" />
                            <Label Text="Labour onset and cervical assessment details"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}" />
                        </StackLayout>
                    </Grid>

                    <!-- Labour Onset -->
                    <Label Text="Labour Onset Date and Time"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}"
                           Margin="0,4,0,4" />

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <Grid Grid.Column="0">
                            <core:SfTextInputLayout Hint="Date *"
                                                    Style="{StaticResource PatientInput}">
                                <Entry Text="{Binding LaborStartDate, Mode=OneWay, StringFormat='{0:dd-MM-yyyy}'}"
                                       IsReadOnly="True" />
                            </core:SfTextInputLayout>
                            <BoxView Color="Transparent" InputTransparent="False">
                                <BoxView.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="LaborStartDatePicker_Tapped" />
                                </BoxView.GestureRecognizers>
                            </BoxView>
                        </Grid>
                        <picker:SfDatePicker x:Name="LaborStartDatePicker"
                                             SelectedDate="{Binding LaborStartDate, Mode=TwoWay}"
                                             Format="dd_MM_yyyy"
                                             MinimumDate="01/01/1950"
                                             Mode="Dialog"
                                             IsVisible="False">
                            <picker:SfDatePicker.HeaderView>
                                <picker:PickerHeaderView Text="Labour Start Date *"
                                                         Background="{StaticResource PrimaryBlue}"
                                                         TextColor="White" />
                            </picker:SfDatePicker.HeaderView>
                        </picker:SfDatePicker>

                        <Grid Grid.Column="1">
                            <core:SfTextInputLayout Hint="Time *"
                                                    Style="{StaticResource PatientInput}">
                                <Entry Text="{Binding LaborStartTime, Mode=OneWay, StringFormat='{0:hh\\:mm}'}"
                                       IsReadOnly="True" />
                            </core:SfTextInputLayout>
                            <BoxView Color="Transparent" InputTransparent="False">
                                <BoxView.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="LaborStartTimePicker_Tapped" />
                                </BoxView.GestureRecognizers>
                            </BoxView>
                        </Grid>
                        <picker:SfTimePicker x:Name="LaborStartTimePicker"
                                             SelectedTime="{Binding LaborStartTime, Mode=TwoWay}"
                                             Format="HH_mm"
                                             Mode="Dialog"
                                             IsVisible="False">
                            <picker:SfTimePicker.HeaderView>
                                <picker:PickerHeaderView Text="Labour Start Time *"
                                                         Background="{StaticResource PrimaryBlue}"
                                                         TextColor="White" />
                            </picker:SfTimePicker.HeaderView>
                        </picker:SfTimePicker>
                    </Grid>

                    <!-- Active Labour Diagnosis -->
                    <Border BackgroundColor="#F3E5F5"
                            Padding="12"
                            Margin="0,8,0,0"
                            StrokeShape="RoundRectangle 8">
                        <StackLayout Spacing="8">
                            <Label Text="Active Labour Diagnosis"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}" />

                            <chip:SfChipGroup ItemsSource="{Binding Diagnoses}"
                                              DisplayMemberPath="Name"
                                              Margin="0,4,0,4"
                                              FlowDirection="MatchParent" />

                            <core:SfTextInputLayout Hint="Add Diagnosis"
                                                    Style="{StaticResource PatientInput}"
                                                    HelperText="Clinical assessment of active labour">
                                <Entry Text="{Binding ActiveLabourDiagnosis}"
                                       Completed="Entry_Completed"
                                       Unfocused="Entry_Completed"
                                       ReturnType="Next"
                                       Placeholder="Type and press Enter to add" />
                            </core:SfTextInputLayout>
                        </StackLayout>
                    </Border>

                    <!-- Ruptured Membrane -->
                    <Border BackgroundColor="#E3F2FD"
                            Padding="12"
                            Margin="0,8,0,0"
                            StrokeShape="RoundRectangle 8">
                        <StackLayout Spacing="8">
                            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                                <CheckBox Grid.Column="0"
                                          IsChecked="{Binding HasRupturedMembrane}"
                                          Color="{StaticResource PrimaryBlue}"
                                          VerticalOptions="Center" />
                                <StackLayout Grid.Column="1" VerticalOptions="Center">
                                    <Label Text="Membrane has ruptured"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextPrimary}" />
                                    <Label Text="Record date and time of rupture"
                                           FontSize="12"
                                           TextColor="{StaticResource TextSecondary}" />
                                </StackLayout>
                            </Grid>

                            <Grid ColumnDefinitions="*,*"
                                  ColumnSpacing="12"
                                  IsVisible="{Binding HasRupturedMembrane}">
                                <Grid Grid.Column="0">
                                    <core:SfTextInputLayout Hint="Rupture Date"
                                                            Style="{StaticResource PatientInput}">
                                        <Entry Text="{Binding RupturedMembraneDate, Mode=OneWay, StringFormat='{0:dd-MM-yyyy}'}"
                                               IsReadOnly="True" />
                                    </core:SfTextInputLayout>
                                    <BoxView Color="Transparent" InputTransparent="False">
                                        <BoxView.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="RuptureDatePicker_Tapped" />
                                        </BoxView.GestureRecognizers>
                                    </BoxView>
                                </Grid>
                                <picker:SfDatePicker x:Name="RuptureDatePicker"
                                                     SelectedDate="{Binding RupturedMembraneDate, Mode=TwoWay}"
                                                     Format="dd_MM_yyyy"
                                                     MinimumDate="01/01/1950"
                                                     Mode="Dialog"
                                                     IsVisible="False">
                                    <picker:SfDatePicker.HeaderView>
                                        <picker:PickerHeaderView Text="Rupture Date"
                                                                 Background="{StaticResource PrimaryBlue}"
                                                                 TextColor="White" />
                                    </picker:SfDatePicker.HeaderView>
                                </picker:SfDatePicker>

                                <Grid Grid.Column="1">
                                    <core:SfTextInputLayout Hint="Rupture Time"
                                                            Style="{StaticResource PatientInput}">
                                        <Entry Text="{Binding RupturedMembraneTime, Mode=OneWay, StringFormat='{0:hh\\:mm}'}"
                                               IsReadOnly="True" />
                                    </core:SfTextInputLayout>
                                    <BoxView Color="Transparent" InputTransparent="False">
                                        <BoxView.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="RuptureTimePicker_Tapped" />
                                        </BoxView.GestureRecognizers>
                                    </BoxView>
                                </Grid>
                                <picker:SfTimePicker x:Name="RuptureTimePicker"
                                                     SelectedTime="{Binding RupturedMembraneTime, Mode=TwoWay}"
                                                     Format="HH_mm"
                                                     Mode="Dialog"
                                                     IsVisible="False">
                                    <picker:SfTimePicker.HeaderView>
                                        <picker:PickerHeaderView Text="Rupture Time"
                                                                 Background="{StaticResource PrimaryBlue}"
                                                                 TextColor="White" />
                                    </picker:SfTimePicker.HeaderView>
                                </picker:SfTimePicker>
                            </Grid>
                        </StackLayout>
                    </Border>

                    <!-- Cervical Dilatation on Admission -->
                    <Label Text="Cervical Dilatation Assessment"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}"
                           Margin="0,12,0,4" />

                    <core:SfTextInputLayout Hint="Dilatation on Arrival (cm) *"
                                            Style="{StaticResource PatientInput}"
                                            HelperText="Cervical dilatation at admission (0-10 cm)">
                        <editors:SfNumericEntry Value="{Binding CervicalDilationOnAdmission, Mode=TwoWay}"
                                                ReturnType="Next"
                                                Minimum="0"
                                                Maximum="10"
                                                MaximumNumberDecimalDigits="0"
                                                Placeholder="Enter dilatation in cm" />
                    </core:SfTextInputLayout>

                    <!-- Labor Status Indicator -->
                    <Border BackgroundColor="{Binding LaborStatusColor}"
                            Padding="16"
                            Margin="0,8,0,0"
                            StrokeShape="RoundRectangle 12"
                            IsVisible="{Binding HasDilatationValue}">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                            <!--<Border Grid.Column="0"
                                    BackgroundColor="White"
                                    Opacity="0.3"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    StrokeShape="RoundRectangle 20">
                                <Label Text="&#xE425;"
                                       FontFamily="MaterialIcons"
                                       FontSize="20"
                                       TextColor="White"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </Border>-->
                            <Label Grid.Column="1"
                                   Text="{Binding LaborStatusIndicator}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   VerticalOptions="Center" />
                        </Grid>
                    </Border>
                </StackLayout>
            </Border>

            <!-- Bishop Score Calculator Section -->
            <Border Style="{StaticResource SectionBorder}">
                <StackLayout Padding="16" Spacing="8">
                    <!-- Section Header with Icon -->
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" Margin="0,0,0,8">
                        <!--<Border Grid.Column="0"
                                BackgroundColor="#3F51B5"
                                WidthRequest="40"
                                HeightRequest="40"
                                StrokeShape="RoundRectangle 10">
                            <Label Text="&#xE6DD;"
                                   FontFamily="MaterialIcons"
                                   FontSize="20"
                                   TextColor="White"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>-->
                        <StackLayout Grid.Column="1" VerticalOptions="Center">
                            <Label Text="Bishop Score Calculator"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}" />
                            <Label Text="Induction assessment and cervical readiness"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}" />
                        </StackLayout>
                    </Grid>

                    <!-- Induction Checkbox -->
                    <Border BackgroundColor="#E8EAF6"
                            Padding="12"
                            Margin="0,0,0,8"
                            StrokeShape="RoundRectangle 8">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                            <CheckBox Grid.Column="0"
                                      IsChecked="{Binding IsInductionPlanned, Mode=TwoWay}"
                                      Color="#3F51B5"
                                      VerticalOptions="Center" />
                            <StackLayout Grid.Column="1" VerticalOptions="Center">
                                <Label Text="Patient scheduled for labour induction"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource TextPrimary}" />
                                <Label Text="Enable to calculate Bishop Score"
                                       FontSize="12"
                                       TextColor="{StaticResource TextSecondary}" />
                            </StackLayout>
                        </Grid>
                    </Border>

                    <!-- Bishop Score Components -->
                    <Grid ColumnDefinitions="*,*"
                          RowDefinitions="Auto,Auto,Auto"
                          ColumnSpacing="12"
                          IsVisible="{Binding IsInductionPlanned}">

                        <!-- Row 0: Dilatation and Effacement -->
                        <core:SfTextInputLayout Grid.Row="0"
                                                Grid.Column="0"
                                                Hint="Dilatation (cm)"
                                                Style="{StaticResource PatientInput}">
                            <editors:SfNumericEntry Value="{Binding BishopDilatation, Mode=TwoWay}"
                                                    Minimum="0"
                                                    Maximum="10"
                                                    MaximumNumberDecimalDigits="0" />
                        </core:SfTextInputLayout>

                        <core:SfTextInputLayout Grid.Row="0"
                                                Grid.Column="1"
                                                Hint="Effacement (%)"
                                                Style="{StaticResource PatientInput}">
                            <editors:SfNumericEntry Value="{Binding BishopEffacement, Mode=TwoWay}"
                                                    Minimum="0"
                                                    Maximum="100"
                                                    MaximumNumberDecimalDigits="0" />
                        </core:SfTextInputLayout>

                        <!-- Row 1: Station and Consistency -->
                        <core:SfTextInputLayout Grid.Row="1"
                                                Grid.Column="0"
                                                Hint="Station"
                                                Style="{StaticResource PatientInput}">
                            <Picker ItemsSource="{Binding StationOptions}"
                                    SelectedItem="{Binding BishopStation, Mode=TwoWay}"
                                    Title="Select Station" />
                        </core:SfTextInputLayout>

                        <core:SfTextInputLayout Grid.Row="1"
                                                Grid.Column="1"
                                                Hint="Consistency"
                                                Style="{StaticResource PatientInput}">
                            <Picker ItemsSource="{Binding ConsistencyOptions}"
                                    SelectedItem="{Binding BishopConsistency, Mode=TwoWay}"
                                    Title="Select Consistency" />
                        </core:SfTextInputLayout>

                        <!-- Row 2: Position -->
                        <core:SfTextInputLayout Grid.Row="2"
                                                Grid.Column="0"
                                                Hint="Position"
                                                Style="{StaticResource PatientInput}">
                            <Picker ItemsSource="{Binding PositionOptions}"
                                    SelectedItem="{Binding BishopPosition, Mode=TwoWay}"
                                    Title="Select Position" />
                        </core:SfTextInputLayout>
                    </Grid>

                    <!-- Calculated Bishop Score Display -->
                    <Border BackgroundColor="#3F51B5"
                            Padding="20"
                            Margin="0,8,0,0"
                            StrokeShape="RoundRectangle 12"
                            IsVisible="{Binding IsInductionPlanned}">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="16">
                            <Border Grid.Column="0"
                                    WidthRequest="60"
                                    HeightRequest="60"
                                    StrokeShape="RoundRectangle 30">
                                <Label Text="{Binding CalculatedBishopScore}"
                                       FontSize="28"
                                       FontAttributes="Bold"
                                       TextColor="#3F51B5"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </Border>
                            <StackLayout Grid.Column="1" VerticalOptions="Center">
                                <Label Text="Bishop Score"
                                       FontSize="16"
                                       FontAttributes="Bold" />
                                <Label Text="{Binding BishopScoreInterpretation}"
                                       FontSize="13"
                                       Opacity="0.9" />
                            </StackLayout>
                        </Grid>
                    </Border>
                </StackLayout>
            </Border>

            <!-- Risk Assessment Display Section -->
            <Border Style="{StaticResource SectionBorder}">
                <StackLayout Padding="16" Spacing="8">
                    <!-- Section Header with Icon -->
                    <Grid ColumnSpacing="12" Margin="0,0,0,8">
                        <!--<Border Grid.Column="0"
                                BackgroundColor="{StaticResource ErrorRed}"
                                WidthRequest="40"
                                HeightRequest="40"
                                StrokeShape="RoundRectangle 10">
                            <Label Text="&#xE002;"
                                   FontFamily="MaterialIcons"
                                   FontSize="20"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center" />
                        </Border>-->
                        <StackLayout Grid.Column="0" VerticalOptions="Center">
                            <Label Text="Risk Assessment"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}" />
                            <Label Text="Calculated risk level and recommended actions"
                                   FontSize="12"
                                   TextColor="{StaticResource TextSecondary}" />
                        </StackLayout>
                    </Grid>

                    <!-- Risk Level Card -->
                    <Border BackgroundColor="{Binding RiskColor}"
                            Padding="20"
                            Margin="0,8,0,12"
                            StrokeShape="RoundRectangle 12">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="16">
                            <Border Grid.Column="0"
                                    WidthRequest="60"
                                    HeightRequest="60"
                                    StrokeShape="RoundRectangle 30">
                                <Label Text="{Binding RiskScore}"
                                       FontSize="28"
                                       FontAttributes="Bold"
                                       TextColor="{Binding RiskColor}"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </Border>
                            <StackLayout Grid.Column="1" VerticalOptions="Center">
                                <Label Text="{Binding RiskLevel}"
                                       FontSize="18"
                                       FontAttributes="Bold" />
                                <Label Text="Based on clinical assessment"
                                       FontSize="12"
                                       Opacity="0.9" />
                            </StackLayout>
                        </Grid>
                    </Border>

                    <!-- Risk Factors List -->
                    <Border BackgroundColor="#FFF8E1"
                            Padding="12"
                            StrokeShape="RoundRectangle 8">
                        <StackLayout Spacing="8">
                            <Label Text="Risk Factors Identified"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}" />

                            <CollectionView ItemsSource="{Binding RiskAssessmentFactors}">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8" Padding="0,2">
                                            <Label Grid.Column="0"
                                                   Text=""
                                                   FontSize="12"
                                                   TextColor="{StaticResource WarningOrange}"
                                                   VerticalOptions="Start" />
                                            <Label Grid.Column="1"
                                                   Text="{Binding .}"
                                                   FontSize="12"
                                                   TextColor="{StaticResource TextSecondary}" />
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </StackLayout>
                    </Border>

                    <!-- Recommended Actions List -->
                    <Border BackgroundColor="#E8F5E9"
                            Padding="12"
                            Margin="0,8,0,0"
                            StrokeShape="RoundRectangle 8">
                        <StackLayout Spacing="8">
                            <Label Text="Recommended Actions"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource TextPrimary}" />

                            <CollectionView ItemsSource="{Binding RecommendedActions}">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8" Padding="0,2">
                                            <Label Grid.Column="0"
                                                   Text="&#xE5CA;" 
                                                   FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                                                   FontSize="14"
                                                   TextColor="{StaticResource SecondaryGreen}"
                                                   VerticalOptions="Start" />
                                            <Label Grid.Column="1"
                                                   Text="{Binding .}"
                                                   FontSize="12"
                                                   TextColor="{StaticResource TextSecondary}"
                                                   FontAttributes="Bold" />
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </StackLayout>
                    </Border>
                </StackLayout>
            </Border>

            <!-- Action Buttons Section -->
            <Border Style="{StaticResource SectionBorder}" Margin="16,8,16,16">
                <StackLayout Padding="16" Spacing="12">
                    <!-- Error Messages -->
                    <Border BackgroundColor="#FFEBEE"
                            Padding="12"
                            StrokeShape="RoundRectangle 8"
                            Stroke="{StaticResource ErrorRed}"
                            StrokeThickness="1"
                            IsVisible="{Binding HasError}">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                            <!--<Label Grid.Column="0"
                                   Text="&#xE000;"
                                   FontFamily="MaterialIcons"
                                   FontSize="20"
                                   TextColor="{StaticResource ErrorRed}"
                                   VerticalOptions="Start" />-->
                            <Label Grid.Column="1"
                                   Text="{Binding ErrorMessage}"
                                   Style="{StaticResource ErrorText}"
                                   FontSize="13" />
                        </Grid>
                    </Border>

                    <!-- Save and Continue Button -->
                    <buttons:SfButton Text="Save Patient and Start Partograph"
                                      Style="{StaticResource PrimaryButton}"
                                      Command="{Binding SaveCommand}"
                                      HeightRequest="56">
                        <buttons:SfButton.ImageSource>
                            <FontImageSource FontFamily="MaterialIcons"
                                             Glyph="&#xe161;"
                                             Size="22"
                                             Color="{StaticResource SurfaceWhite}" />
                        </buttons:SfButton.ImageSource>
                    </buttons:SfButton>

                    <!-- Save Draft Button -->
                    <!--<buttons:SfButton Text="Save as Draft"
                                      Style="{StaticResource SecondaryButton}"
                                      Command="{Binding SaveDraftCommand}"
                                      HeightRequest="50">
                        <buttons:SfButton.ImageSource>
                            <FontImageSource FontFamily="MaterialIcons"
                                             Glyph="&#xe161;"
                                             Size="18"
                                             Color="{StaticResource PrimaryBlue}" />
                        </buttons:SfButton.ImageSource>
                    </buttons:SfButton>-->
                </StackLayout>
            </Border>

        </StackLayout>
    </ScrollView>
</ContentPage>