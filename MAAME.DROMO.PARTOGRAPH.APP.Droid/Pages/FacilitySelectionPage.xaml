<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.FacilitySelectionPage"
             xmlns:model="clr-namespace:MAAME.DROMO.PARTOGRAPH.MODEL;assembly=MAAME.DROMO.PARTOGRAPH.MODEL"
             xmlns:fonts="clr-namespace:Fonts"
             Title="Select Facility"
             BackgroundColor="{AppThemeBinding Light=#F5F7FA, Dark=#1A1A1A}">

    <Grid RowDefinitions="Auto,*,Auto" Padding="0">

        <!-- Header -->
        <Border Grid.Row="0"
                BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1565C0}"
                Padding="24,40,24,24">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="0,0,24,24" />
            </Border.StrokeShape>

            <VerticalStackLayout Spacing="8">
                <Label Text="Welcome!"
                       FontSize="32"
                       FontAttributes="Bold" />
                <Label Text="{Binding UserName}"
                       FontSize="20"
                       Opacity="0.9" />
                <Label Text="{Binding UserRole, StringFormat='Role: {0}'}"
                       FontSize="16"
                       Opacity="0.8" />
                <Label Text="Please select a facility to continue"
                       FontSize="14"
                       Margin="0,16,0,0"
                       Opacity="0.9" />
            </VerticalStackLayout>
        </Border>

        <!-- Facilities List -->
        <ScrollView Grid.Row="1" Padding="20,20,20,0">
            <VerticalStackLayout Spacing="12">
                <Label Text="Available Facilities"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#F5F5F5}"
                       Margin="0,0,0,8" />

                <!-- Loading Indicator -->
                <ActivityIndicator IsRunning="{Binding IsBusy}"
                                 IsVisible="{Binding IsBusy}"
                                 Color="{AppThemeBinding Light=#2196F3, Dark=#64B5F6}"
                                 HeightRequest="50" />

                <!-- Facilities CollectionView -->
                <CollectionView ItemsSource="{Binding Facilities}"
                              SelectionMode="Single"
                                SelectedItem="{Binding SelectedFacility, Mode=TwoWay}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="model:Facility">
                            <Border Margin="0,0,0,12"
                                  BackgroundColor="{AppThemeBinding Light=White, Dark=#2A2A2A}"
                                  StrokeThickness="0">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="16" />
                                </Border.StrokeShape>
                                <Border.Shadow>
                                    <Shadow Brush="{AppThemeBinding Light=#20000000, Dark=#40000000}"
                                          Offset="0,2"
                                          Radius="8"
                                          Opacity="0.15" />
                                </Border.Shadow>

                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectFacilityCommand}" CommandParameter="{Binding .}" />
                                </Border.GestureRecognizers>

                                <Grid Padding="20" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="16" InputTransparent="True" CascadeInputTransparent="True">
                                    <!-- Icon -->
                                    <Border Grid.Column="0"
                                          WidthRequest="56"
                                          HeightRequest="56"
                                          BackgroundColor="{AppThemeBinding Light=#E3F2FD, Dark=#1E3A5F}">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="16" />
                                        </Border.StrokeShape>
                                        <Label Text="&#xE8DD;"
                                             FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                                             FontSize="28"
                                             TextColor="{AppThemeBinding Light=#2196F3, Dark=#64B5F6}"
                                             HorizontalOptions="Center"
                                             VerticalOptions="Center" />
                                    </Border>

                                    <!-- Facility Details -->
                                    <VerticalStackLayout Grid.Column="1"
                                                       VerticalOptions="Center"
                                                       Spacing="4">
                                        <Label Text="{Binding Name}"
                                             FontSize="18"
                                             FontAttributes="Bold"
                                             TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#F5F5F5}" />
                                        <Label Text="{Binding Type}"
                                             FontSize="14"
                                             TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                                        <Label Text="{Binding City}"
                                             FontSize="13"
                                             TextColor="{AppThemeBinding Light=#888, Dark=#888}" />
                                    </VerticalStackLayout>

                                    <!-- Selection Indicator -->
                                    <Label Grid.Column="2"
                                         Text="&#xE73E;"
                                         FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                                         FontSize="24"
                                         TextColor="{AppThemeBinding Light=#2196F3, Dark=#64B5F6}"
                                         VerticalOptions="Center"
                                         HorizontalOptions="Center" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Continue Button -->
        <Border Grid.Row="2"
                BackgroundColor="{AppThemeBinding Light=White, Dark=#2A2A2A}"
                Padding="20,16,20,32"
                StrokeThickness="0">
            <Border.Shadow>
                <Shadow Brush="{AppThemeBinding Light=#20000000, Dark=#40000000}"
                      Offset="0,-2"
                      Radius="8"
                      Opacity="0.1" />
            </Border.Shadow>

            <Button Text="Continue"
                  Command="{Binding ContinueCommand}"
                  BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1565C0}"
                  TextColor="White"
                  FontSize="18"
                  FontAttributes="Bold"
                  HeightRequest="56"
                  CornerRadius="16" />
        </Border>
    </Grid>
</ContentPage>
