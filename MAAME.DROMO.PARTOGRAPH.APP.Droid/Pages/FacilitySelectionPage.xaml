<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.FacilitySelectionPage"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:fonts="clr-namespace:Fonts"
             Title="Select Facility"
             BackgroundColor="{AppThemeBinding Light=#F5F7FA, Dark=#1A1A1A}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto" Padding="0">

        <!-- Header -->
        <Border Grid.Row="0"
                BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1565C0}"
                Padding="24,40,24,24">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="0,0,24,24" />
            </Border.StrokeShape>

            <VerticalStackLayout Spacing="8">
                <Label Text="Welcome!"
                       FontSize="32"
                       FontAttributes="Bold" />
                <Label Text="{Binding UserName}"
                       FontSize="20"
                       Opacity="0.9" />
                <Label Text="{Binding UserRole, StringFormat='Role: {0}'}"
                       FontSize="16"
                       Opacity="0.8" />
                <Label Text="Please select a facility to continue"
                       FontSize="14"
                       Margin="0,16,0,0"
                       Opacity="0.9" />
            </VerticalStackLayout>
        </Border>

        <!-- Facility Selection -->
        <VerticalStackLayout Grid.Row="1" Padding="20" Spacing="16" VerticalOptions="Center">

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                             IsVisible="{Binding IsBusy}"
                             Color="{AppThemeBinding Light=#2196F3, Dark=#64B5F6}"
                             HeightRequest="50" />

            <!-- Facility Picker Section -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#2A2A2A}"
                    Padding="20"
                    StrokeThickness="0"
                    IsVisible="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=#20000000, Dark=#40000000}"
                          Offset="0,2"
                          Radius="8"
                          Opacity="0.15" />
                </Border.Shadow>

                <VerticalStackLayout Spacing="16">
                    <HorizontalStackLayout Spacing="12">
                        <!-- Icon -->
                        <Border WidthRequest="48"
                              HeightRequest="48"
                              BackgroundColor="{AppThemeBinding Light=#E3F2FD, Dark=#1E3A5F}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12" />
                            </Border.StrokeShape>
                            <Label Text="{x:Static fonts:FluentUI.building_32_regular}"
                                 FontFamily="{x:Static fonts:FluentUI.FontFamily}"
                                 FontSize="24"
                                 TextColor="{AppThemeBinding Light=#2196F3, Dark=#64B5F6}"
                                 HorizontalOptions="Center"
                                 VerticalOptions="Center" />
                        </Border>
                        <Label Text="Select Facility"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#F5F5F5}"
                               VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <!-- Region Picker -->
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Region"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#444, Dark=#CCC}" />
                        <Border StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                                BackgroundColor="{AppThemeBinding Light=#FAFAFA, Dark=#1E1E1E}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12" />
                            </Border.StrokeShape>
                            <Picker ItemsSource="{Binding Regions}"
                                    SelectedItem="{Binding SelectedRegion, Mode=TwoWay}"
                                    ItemDisplayBinding="{Binding Name}"
                                    Title="Choose a region"
                                    TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#F5F5F5}"
                                    TitleColor="{AppThemeBinding Light=#999, Dark=#666}"
                                    HeightRequest="50" />
                        </Border>
                    </VerticalStackLayout>

                    <!-- District Picker (visible when region is selected) -->
                    <VerticalStackLayout Spacing="6" IsVisible="{Binding HasSelectedRegion}">
                        <Label Text="District"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#444, Dark=#CCC}" />
                        <Border StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                                BackgroundColor="{AppThemeBinding Light=#FAFAFA, Dark=#1E1E1E}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12" />
                            </Border.StrokeShape>
                            <Picker ItemsSource="{Binding Districts}"
                                    SelectedItem="{Binding SelectedDistrict, Mode=TwoWay}"
                                    ItemDisplayBinding="{Binding Name}"
                                    Title="Choose a district"
                                    TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#F5F5F5}"
                                    TitleColor="{AppThemeBinding Light=#999, Dark=#666}"
                                    HeightRequest="50" />
                        </Border>
                    </VerticalStackLayout>

                    <!-- Facility Picker (visible when district is selected) -->
                    <VerticalStackLayout Spacing="6" IsVisible="{Binding HasSelectedDistrict}">
                        <Label Text="Facility"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#444, Dark=#CCC}" />
                        <Border StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                                BackgroundColor="{AppThemeBinding Light=#FAFAFA, Dark=#1E1E1E}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12" />
                            </Border.StrokeShape>
                            <Picker ItemsSource="{Binding Facilities}"
                                    SelectedItem="{Binding SelectedFacility, Mode=TwoWay}"
                                    ItemDisplayBinding="{Binding Name}"
                                    Title="Choose a facility"
                                    TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#F5F5F5}"
                                    TitleColor="{AppThemeBinding Light=#999, Dark=#666}"
                                    HeightRequest="50" />
                        </Border>
                    </VerticalStackLayout>

                    <!-- Selected Facility Details -->
                    <Border BackgroundColor="{AppThemeBinding Light=#F0F7FF, Dark=#1E3A5F}"
                            Padding="16"
                            IsVisible="{Binding HasSelectedFacility}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <VerticalStackLayout Spacing="4">
                            <Label Text="{Binding SelectedFacility.Name}"
                                 FontSize="16"
                                 FontAttributes="Bold"
                                 TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#F5F5F5}" />
                            <Label Text="{Binding SelectedFacility.Type}"
                                 FontSize="14"
                                 TextColor="{AppThemeBinding Light=#666, Dark=#AAA}" />
                            <Label Text="{Binding SelectedFacility.City}"
                                 FontSize="13"
                                 TextColor="{AppThemeBinding Light=#888, Dark=#888}" />
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </Border>
        </VerticalStackLayout>

        <!-- Continue Button -->
        <Border Grid.Row="2"
                BackgroundColor="{AppThemeBinding Light=White, Dark=#2A2A2A}"
                Padding="20,16,20,32"
                StrokeThickness="0">
            <Border.Shadow>
                <Shadow Brush="{AppThemeBinding Light=#20000000, Dark=#40000000}"
                      Offset="0,-2"
                      Radius="8"
                      Opacity="0.1" />
            </Border.Shadow>

            <Button Text="Continue"
                  Command="{Binding ContinueCommand}"
                  BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1565C0}"
                  TextColor="White"
                  FontSize="18"
                  FontAttributes="Bold"
                  HeightRequest="56"
                  CornerRadius="16" />
        </Border>
    </Grid>
</ContentPage>
