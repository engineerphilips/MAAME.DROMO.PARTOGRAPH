<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.HomePage"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:sf="clr-namespace:Syncfusion.Maui.Toolkit.Charts;assembly=Syncfusion.Maui.Toolkit"
             xmlns:controls="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.Controls"
             xmlns:sfGauge="clr-namespace:Syncfusion.Maui.Gauges;assembly=Syncfusion.Maui.Gauges"
             xmlns:sfCards="clr-namespace:Syncfusion.Maui.Toolkit.Cards;assembly=Syncfusion.Maui.Toolkit"
             xmlns:models="clr-namespace:MAAME.DROMO.PARTOGRAPH.MODEL;assembly=MAAME.DROMO.PARTOGRAPH.MODEL"
             xmlns:pagemodels="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.PageModels"
             xmlns:views="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.Views"
             xmlns:converters="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Converters"
             xmlns:tabView="http://schemas.syncfusion.com/maui"
             xmlns:fonts="clr-namespace:Fonts"
             Title="Partograph Dashboard"
             BackgroundColor="{AppThemeBinding Light=#F0F4F8, Dark=#0F172A}">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior EventName="NavigatedTo" Command="{Binding NavigatedToCommand}" />
        <toolkit:EventToCommandBehavior EventName="Appearing" Command="{Binding AppearingCommand}" />
    </ContentPage.Behaviors>

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Converters -->
            <converters:SeverityToColorConverter x:Key="SeverityToColorConverter" />
            <converters:IsNotNullConverter x:Key="IsNotNullConverter" />
            <converters:StatusColorConverter x:Key="StatusColorConverter" />
            <converters:ComplianceToColorConverter x:Key="ComplianceToColorConverter" />
            <converters:ActivityTypeToColorConverter x:Key="ActivityTypeToColorConverter" />
            <converters:ActivityTypeToIconConverter x:Key="ActivityTypeToIconConverter" />
            <converters:PercentageToProgressConverter x:Key="PercentageToProgressConverter" />
            <converters:GreaterThanZeroConverter x:Key="GreaterThanZeroConverter" />

            <!-- Modern Card Style -->
            <Style x:Key="ModernCardStyle" TargetType="Border">
                <Setter Property="StrokeThickness" Value="0" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=White, Dark=#1E293B}" />
                <Setter Property="Padding" Value="20" />
                <Setter Property="StrokeShape">
                    <RoundRectangle CornerRadius="16" />
                </Setter>
                <Setter Property="Shadow">
                    <Shadow Brush="{AppThemeBinding Light=#15000000, Dark=#40000000}"
                            Offset="0,4"
                            Radius="16"
                            Opacity="0.2" />
                </Setter>
            </Style>

            <!-- Glass Card Style -->
            <Style x:Key="GlassCardStyle" TargetType="Border">
                <Setter Property="StrokeThickness" Value="1" />
                <Setter Property="Stroke" Value="{AppThemeBinding Light=#20000000, Dark=#20FFFFFF}" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#F8FAFC, Dark=#1E293B}" />
                <Setter Property="Padding" Value="16" />
                <Setter Property="StrokeShape">
                    <RoundRectangle CornerRadius="12" />
                </Setter>
            </Style>

            <!-- Stat Card Style -->
            <Style x:Key="StatCardStyle" TargetType="sfCards:SfCardView">
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="BorderWidth" Value="0" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=White, Dark=#1E293B}" />
            </Style>

            <!-- Header Text Style -->
            <Style x:Key="HeaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="26" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}" />
            </Style>

            <!-- Subheader Style -->
            <Style x:Key="SubheaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
            </Style>

            <!-- Section Header Style -->
            <Style x:Key="SectionHeaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="17" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}" />
            </Style>

            <!-- Large Metric Style -->
            <Style x:Key="LargeMetricStyle" TargetType="Label">
                <Setter Property="FontSize" Value="36" />
                <Setter Property="FontAttributes" Value="Bold" />
            </Style>

            <!-- Medium Metric Style -->
            <Style x:Key="MediumMetricStyle" TargetType="Label">
                <Setter Property="FontSize" Value="24" />
                <Setter Property="FontAttributes" Value="Bold" />
            </Style>

            <!-- Metric Label Style -->
            <Style x:Key="MetricLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="11" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="CharacterSpacing" Value="0.5" />
            </Style>

            <!-- Small Text Style -->
            <Style x:Key="SmallTextStyle" TargetType="Label">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <tabView:SfTabView x:Name="TabView" TabBarHeight="72" EnableSwiping="False" TabBarPlacement="Bottom">
        <tabView:SfTabItem Header="Home" ImagePosition="Top" ImageSource="home_svgrepo.png">
            <RefreshView IsRefreshing="{Binding IsRefreshing}" Command="{Binding RefreshCommand}">
                <ScrollView>
                    <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,*"
                          Padding="16,16,16,24"
                          RowSpacing="16">

                        <!-- ==================== HEADER SECTION ==================== -->
                        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,8">
                            <VerticalStackLayout VerticalOptions="Center" Spacing="4">
                                <Label Text="Labour Monitoring Dashboard" Style="{StaticResource HeaderStyle}" />
                                <HorizontalStackLayout Spacing="8">
                                    <Label Text="{Binding Today, StringFormat='{0:ddd, MMM dd, yyyy}'}"
                                           Style="{StaticResource SubheaderStyle}" />
                                    <Border BackgroundColor="#10B981"
                                            Padding="10,5"
                                            VerticalOptions="Center">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12" />
                                        </Border.StrokeShape>
                                        <HorizontalStackLayout Spacing="6">
                                            <Ellipse Fill="White"
                                                     WidthRequest="8"
                                                     HeightRequest="8"
                                                     VerticalOptions="Center">
                                                <Ellipse.Triggers>
                                                    <DataTrigger TargetType="Ellipse" Binding="{Binding IsBusy}" Value="True">
                                                        <Setter Property="Opacity" Value="0.5" />
                                                    </DataTrigger>
                                                </Ellipse.Triggers>
                                            </Ellipse>
                                            <Label Text="Live"
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="White"
                                                   VerticalOptions="Center" />
                                        </HorizontalStackLayout>
                                    </Border>
                                </HorizontalStackLayout>
                            </VerticalStackLayout>

                            <!-- Add Patient FAB -->
                            <controls:AddButton Grid.Column="1"
                                                BackgroundColor="#3B82F6"
                                                WidthRequest="56"
                                                HeightRequest="56"
                                                FontSize="24"
                                                ToolTipProperties.Text="Admit New Patient"
                                                Command="{Binding AddNewPatientCommand}" />
                        </Grid>

                        <!-- ==================== MAIN STATS CARDS ==================== -->
                        <Grid Grid.Row="1" ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">

                            <!-- Active Labour Card -->
                            <Border Grid.Column="0" Grid.Row="0" Style="{StaticResource ModernCardStyle}" Padding="16">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#10B981" Offset="0.0" />
                                        <GradientStop Color="#059669" Offset="1.0" />
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                                    <HorizontalStackLayout Grid.Row="0" Spacing="6">
                                        <Border BackgroundColor="#FFFFFF30" Padding="6" WidthRequest="28" HeightRequest="28">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="6" />
                                            </Border.StrokeShape>
                                            <Label Text="&#x1F4A1;" FontSize="14" HorizontalOptions="Center" VerticalOptions="Center" />
                                        </Border>
                                        <Label Text="ACTIVE LABOUR" Style="{StaticResource MetricLabelStyle}" TextColor="#FFFFFFCC" VerticalOptions="Center" />
                                    </HorizontalStackLayout>

                                    <Label Grid.Row="1"
                                           Text="{Binding DashboardStats.ActiveLabor}"
                                           Style="{StaticResource LargeMetricStyle}"
                                           TextColor="White" />

                                    <HorizontalStackLayout Grid.Row="2" Spacing="4">
                                        <Label Text="In progress now" FontSize="12" TextColor="#FFFFFFAA" />
                                    </HorizontalStackLayout>
                                </Grid>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding NavigateToActivePatientsCommand}" />
                                </Border.GestureRecognizers>
                            </Border>

                            <!-- Pre-Labour Card -->
                            <Border Grid.Column="1" Grid.Row="0" Style="{StaticResource ModernCardStyle}" Padding="16">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#F59E0B" Offset="0.0" />
                                        <GradientStop Color="#D97706" Offset="1.0" />
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                                    <HorizontalStackLayout Grid.Row="0" Spacing="6">
                                        <Border BackgroundColor="#FFFFFF30" Padding="6" WidthRequest="28" HeightRequest="28">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="6" />
                                            </Border.StrokeShape>
                                            <Label Text="&#x23F3;" FontSize="14" HorizontalOptions="Center" VerticalOptions="Center" />
                                        </Border>
                                        <Label Text="PENDING" Style="{StaticResource MetricLabelStyle}" TextColor="#FFFFFFCC" VerticalOptions="Center" />
                                    </HorizontalStackLayout>

                                    <Label Grid.Row="1"
                                           Text="{Binding DashboardStats.PendingLabor}"
                                           Style="{StaticResource LargeMetricStyle}"
                                           TextColor="White" />

                                    <HorizontalStackLayout Grid.Row="2" Spacing="4">
                                        <Label Text="Awaiting labour" FontSize="12" TextColor="#FFFFFFAA" />
                                    </HorizontalStackLayout>
                                </Grid>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding NavigateToPendingPatientsCommand}" />
                                </Border.GestureRecognizers>
                            </Border>

                            <!-- Delivered Today Card -->
                            <Border Grid.Column="0" Grid.Row="1" Style="{StaticResource ModernCardStyle}" Padding="16">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#3B82F6" Offset="0.0" />
                                        <GradientStop Color="#2563EB" Offset="1.0" />
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                                    <HorizontalStackLayout Grid.Row="0" Spacing="6">
                                        <Border BackgroundColor="#FFFFFF30" Padding="6" WidthRequest="28" HeightRequest="28">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="6" />
                                            </Border.StrokeShape>
                                            <Label Text="&#x1F476;" FontSize="14" HorizontalOptions="Center" VerticalOptions="Center" />
                                        </Border>
                                        <Label Text="DELIVERED" Style="{StaticResource MetricLabelStyle}" TextColor="#FFFFFFCC" VerticalOptions="Center" />
                                    </HorizontalStackLayout>

                                    <Label Grid.Row="1"
                                           Text="{Binding DashboardStats.CompletedToday}"
                                           Style="{StaticResource LargeMetricStyle}"
                                           TextColor="White" />

                                    <HorizontalStackLayout Grid.Row="2" Spacing="4">
                                        <Label Text="{Binding DashboardStats.AvgDeliveryTime, StringFormat='Avg: {0:F1}h'}"
                                               FontSize="12"
                                               TextColor="#FFFFFFAA" />
                                    </HorizontalStackLayout>
                                </Grid>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding NavigateToCompletedPatientsCommand}" />
                                </Border.GestureRecognizers>
                            </Border>

                            <!-- Emergency Card -->
                            <Border Grid.Column="1" Grid.Row="1" Style="{StaticResource ModernCardStyle}" Padding="16">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#EF4444" Offset="0.0" />
                                        <GradientStop Color="#DC2626" Offset="1.0" />
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                                    <HorizontalStackLayout Grid.Row="0" Spacing="6">
                                        <Border BackgroundColor="#FFFFFF30" Padding="6" WidthRequest="28" HeightRequest="28">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="6" />
                                            </Border.StrokeShape>
                                            <Label Text="&#x1F6A8;" FontSize="14" HorizontalOptions="Center" VerticalOptions="Center" />
                                        </Border>
                                        <Label Text="EMERGENCY" Style="{StaticResource MetricLabelStyle}" TextColor="#FFFFFFCC" VerticalOptions="Center" />
                                    </HorizontalStackLayout>

                                    <Label Grid.Row="1"
                                           Text="{Binding DashboardStats.EmergencyCases}"
                                           Style="{StaticResource LargeMetricStyle}"
                                           TextColor="White" />

                                    <HorizontalStackLayout Grid.Row="2" Spacing="4">
                                        <Label Text="Immediate attention" FontSize="12" TextColor="#FFFFFFAA" />
                                    </HorizontalStackLayout>
                                </Grid>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding NavigateToEmergencyPatientsCommand}" />
                                </Border.GestureRecognizers>
                            </Border>
                        </Grid>

                        <!-- ==================== LABOUR STAGE BREAKDOWN ==================== -->
                        <Border Grid.Row="2" Style="{StaticResource ModernCardStyle}">
                            <VerticalStackLayout Spacing="16">
                                <Label Text="Labour Stage Breakdown" Style="{StaticResource SectionHeaderStyle}" />

                                <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="8">
                                    <!-- First Stage -->
                                    <Border Grid.Column="0" Style="{StaticResource GlassCardStyle}" Padding="12">
                                        <VerticalStackLayout Spacing="6" HorizontalOptions="Center">
                                            <Border BackgroundColor="#10B98120" Padding="8" WidthRequest="40" HeightRequest="40" HorizontalOptions="Center">
                                                <Border.StrokeShape>
                                                    <Ellipse />
                                                </Border.StrokeShape>
                                                <Label Text="1" FontSize="16" FontAttributes="Bold" TextColor="#10B981" HorizontalOptions="Center" VerticalOptions="Center" />
                                            </Border>
                                            <Label Text="{Binding DashboardStats.FirstStageCount}"
                                                   Style="{StaticResource MediumMetricStyle}"
                                                   TextColor="#10B981"
                                                   HorizontalOptions="Center" />
                                            <Label Text="First" FontSize="11" HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                        </VerticalStackLayout>
                                    </Border>

                                    <!-- Second Stage -->
                                    <Border Grid.Column="1" Style="{StaticResource GlassCardStyle}" Padding="12">
                                        <VerticalStackLayout Spacing="6" HorizontalOptions="Center">
                                            <Border BackgroundColor="#3B82F620" Padding="8" WidthRequest="40" HeightRequest="40" HorizontalOptions="Center">
                                                <Border.StrokeShape>
                                                    <Ellipse />
                                                </Border.StrokeShape>
                                                <Label Text="2" FontSize="16" FontAttributes="Bold" TextColor="#3B82F6" HorizontalOptions="Center" VerticalOptions="Center" />
                                            </Border>
                                            <Label Text="{Binding DashboardStats.SecondStageCount}"
                                                   Style="{StaticResource MediumMetricStyle}"
                                                   TextColor="#3B82F6"
                                                   HorizontalOptions="Center" />
                                            <Label Text="Second" FontSize="11" HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                        </VerticalStackLayout>
                                    </Border>

                                    <!-- Third Stage -->
                                    <Border Grid.Column="2" Style="{StaticResource GlassCardStyle}" Padding="12">
                                        <VerticalStackLayout Spacing="6" HorizontalOptions="Center">
                                            <Border BackgroundColor="#8B5CF620" Padding="8" WidthRequest="40" HeightRequest="40" HorizontalOptions="Center">
                                                <Border.StrokeShape>
                                                    <Ellipse />
                                                </Border.StrokeShape>
                                                <Label Text="3" FontSize="16" FontAttributes="Bold" TextColor="#8B5CF6" HorizontalOptions="Center" VerticalOptions="Center" />
                                            </Border>
                                            <Label Text="{Binding DashboardStats.ThirdStageCount}"
                                                   Style="{StaticResource MediumMetricStyle}"
                                                   TextColor="#8B5CF6"
                                                   HorizontalOptions="Center" />
                                            <Label Text="Third" FontSize="11" HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                        </VerticalStackLayout>
                                    </Border>

                                    <!-- Fourth Stage -->
                                    <Border Grid.Column="3" Style="{StaticResource GlassCardStyle}" Padding="12">
                                        <VerticalStackLayout Spacing="6" HorizontalOptions="Center">
                                            <Border BackgroundColor="#EC489920" Padding="8" WidthRequest="40" HeightRequest="40" HorizontalOptions="Center">
                                                <Border.StrokeShape>
                                                    <Ellipse />
                                                </Border.StrokeShape>
                                                <Label Text="4" FontSize="16" FontAttributes="Bold" TextColor="#EC4899" HorizontalOptions="Center" VerticalOptions="Center" />
                                            </Border>
                                            <Label Text="{Binding DashboardStats.FourthStageCount}"
                                                   Style="{StaticResource MediumMetricStyle}"
                                                   TextColor="#EC4899"
                                                   HorizontalOptions="Center" />
                                            <Label Text="Fourth" FontSize="11" HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                        </VerticalStackLayout>
                                    </Border>
                                </Grid>

                                <!-- First Stage Phase Breakdown -->
                                <VerticalStackLayout Spacing="8" IsVisible="{Binding DashboardStats.FirstStageCount, Converter={StaticResource GreaterThanZeroConverter}}">
                                    <Label Text="First Stage Phases" FontSize="13" FontAttributes="Bold" TextColor="{AppThemeBinding Light=#475569, Dark=#94A3B8}" Margin="0,8,0,0" />
                                    <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="8">
                                        <VerticalStackLayout Grid.Column="0" HorizontalOptions="Center">
                                            <Label Text="{Binding DashboardStats.LatentPhaseCount}" FontSize="18" FontAttributes="Bold" TextColor="#10B981" HorizontalOptions="Center" />
                                            <Label Text="Latent" FontSize="10" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" HorizontalOptions="Center" />
                                            <Label Text="0-4cm" FontSize="9" TextColor="{AppThemeBinding Light=#94A3B8, Dark=#64748B}" HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                        <VerticalStackLayout Grid.Column="1" HorizontalOptions="Center">
                                            <Label Text="{Binding DashboardStats.ActiveEarlyPhaseCount}" FontSize="18" FontAttributes="Bold" TextColor="#F59E0B" HorizontalOptions="Center" />
                                            <Label Text="Active Early" FontSize="10" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" HorizontalOptions="Center" />
                                            <Label Text="5-7cm" FontSize="9" TextColor="{AppThemeBinding Light=#94A3B8, Dark=#64748B}" HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                        <VerticalStackLayout Grid.Column="2" HorizontalOptions="Center">
                                            <Label Text="{Binding DashboardStats.ActiveAdvancedPhaseCount}" FontSize="18" FontAttributes="Bold" TextColor="#EF4444" HorizontalOptions="Center" />
                                            <Label Text="Advanced" FontSize="10" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" HorizontalOptions="Center" />
                                            <Label Text="8-9cm" FontSize="9" TextColor="{AppThemeBinding Light=#94A3B8, Dark=#64748B}" HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                        <VerticalStackLayout Grid.Column="3" HorizontalOptions="Center">
                                            <Label Text="{Binding DashboardStats.TransitionPhaseCount}" FontSize="18" FontAttributes="Bold" TextColor="#8B5CF6" HorizontalOptions="Center" />
                                            <Label Text="Transition" FontSize="10" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" HorizontalOptions="Center" />
                                            <Label Text="10cm" FontSize="9" TextColor="{AppThemeBinding Light=#94A3B8, Dark=#64748B}" HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                    </Grid>
                                </VerticalStackLayout>
                            </VerticalStackLayout>
                        </Border>

                        <!-- ==================== CRITICAL ALERTS SECTION ==================== -->
                        <Border Grid.Row="3" Style="{StaticResource ModernCardStyle}"
                                IsVisible="{Binding HasCriticalPatients}"
                                BackgroundColor="{AppThemeBinding Light=#FEF2F2, Dark=#450A0A}">
                            <VerticalStackLayout Spacing="12">
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <!--<Border Grid.Column="0" BackgroundColor="#EF444420" Padding="8" WidthRequest="36" HeightRequest="36">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="8" />
                                        </Border.StrokeShape>
                                        <Label Text="&#x26A0;" FontSize="18" HorizontalOptions="Center" VerticalOptions="Center" />
                                    </Border>-->
                                    <Label Grid.Column="1"
                                           Text="Critical Patients"
                                           Style="{StaticResource SectionHeaderStyle}"
                                           TextColor="#EF4444"
                                           VerticalOptions="Center"
                                           Margin="12,0,0,0" />
                                    <Border Grid.Column="2" BackgroundColor="#EF4444" Padding="10,6" VerticalOptions="Center">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12" />
                                        </Border.StrokeShape>
                                        <Label Text="{Binding DashboardStats.CriticalPatients.Count}" FontSize="13" FontAttributes="Bold" />
                                    </Border>
                                </Grid>

                                <CollectionView ItemsSource="{Binding DashboardStats.CriticalPatients}" SelectionMode="None">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="models:CriticalPatientInfo">
                                            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E293B}"
                                                    StrokeThickness="0"
                                                    Margin="0,4"
                                                    Padding="12">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="12" />
                                                </Border.StrokeShape>
                                                <Border.Shadow>
                                                    <Shadow Brush="#10000000" Offset="0,2" Radius="8" />
                                                </Border.Shadow>

                                                <Grid ColumnDefinitions="4,*,Auto" ColumnSpacing="12">
                                                    <!-- Severity Bar -->
                                                    <BoxView Grid.Column="0"
                                                             Color="{Binding Severity, Converter={StaticResource SeverityToColorConverter}}"
                                                             CornerRadius="2"
                                                             VerticalOptions="Fill" />

                                                    <!-- Patient Details -->
                                                    <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                                                        <Label Text="{Binding PatientName}" FontSize="16" FontAttributes="Bold" />
                                                        <Label Text="{Binding HospitalNumber, StringFormat='ID: {0}'}" FontSize="12" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                                        <Label Text="{Binding ReasonForConcern}" FontSize="12" FontAttributes="Bold" TextColor="#EF4444" />
                                                        <HorizontalStackLayout Spacing="16">
                                                            <HorizontalStackLayout Spacing="4">
                                                                <Label Text="&#x23F1;" FontSize="12" VerticalOptions="Center" />
                                                                <Label Text="{Binding TimeInLabor}" FontSize="12" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                                            </HorizontalStackLayout>
                                                            <HorizontalStackLayout Spacing="4" IsVisible="{Binding CurrentDilation, Converter={StaticResource IsNotNullConverter}}">
                                                                <Label Text="&#x2B55;" FontSize="9" VerticalOptions="Center" />
                                                                <Label Text="{Binding CurrentDilation, StringFormat='{0}cm'}" FontSize="12" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                                            </HorizontalStackLayout>
                                                            <HorizontalStackLayout Spacing="4" IsVisible="{Binding LastFetalHeartRate, Converter={StaticResource IsNotNullConverter}}">
                                                                <Label Text="&#x1F493;" FontSize="12" VerticalOptions="Center" />
                                                                <Label Text="{Binding LastFetalHeartRate, StringFormat='{0} bpm'}" FontSize="12" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                                            </HorizontalStackLayout>
                                                        </HorizontalStackLayout>
                                                    </VerticalStackLayout>

                                                    <!-- View Button -->
                                                    <Button Grid.Column="2"
                                                            Text="View"
                                                            Command="{Binding Source={RelativeSource AncestorType={x:Type pagemodels:HomePageModel}}, Path=NavigateToCriticalPatientCommand, x:DataType=pagemodels:HomePageModel}"
                                        CommandParameter="{Binding .}"
                                                            BackgroundColor="#3B82F6"
                                                            TextColor="White"
                                                            Padding="16,8"
                                                            CornerRadius="8"
                                                            FontSize="14"
                                                            VerticalOptions="Center" />
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </VerticalStackLayout>
                        </Border>

                        <!-- ==================== ACTIVE ALERTS PANEL ==================== -->
                        <Border Grid.Row="4" Style="{StaticResource ModernCardStyle}"
                                IsVisible="{Binding HasAlerts}"
                                BackgroundColor="{AppThemeBinding Light=#FFFBEB, Dark=#422006}">
                            <VerticalStackLayout Spacing="12">
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <Border Grid.Column="0" BackgroundColor="#F59E0B20" Padding="8" WidthRequest="36" HeightRequest="36">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="8" />
                                        </Border.StrokeShape>
                                        <Label Text="&#x1F514;" FontSize="18" HorizontalOptions="Center" VerticalOptions="Center" />
                                    </Border>
                                    <Label Grid.Column="1"
                                           Text="Active Alerts"
                                           Style="{StaticResource SectionHeaderStyle}"
                                           TextColor="#D97706"
                                           VerticalOptions="Center"
                                           Margin="12,0,0,0" />
                                    <Border Grid.Column="2" BackgroundColor="#F59E0B" Padding="10,6" VerticalOptions="Center">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12" />
                                        </Border.StrokeShape>
                                        <Label Text="{Binding DashboardStats.ActiveAlerts.Count}" FontSize="13" FontAttributes="Bold" TextColor="White" />
                                    </Border>
                                </Grid>

                                <CollectionView ItemsSource="{Binding DashboardStats.ActiveAlerts}" SelectionMode="None">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="models:PatientAlert">
                                            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1E293B}"
                                                    StrokeThickness="0"
                                                    Margin="0,4"
                                                    Padding="12">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="10" />
                                                </Border.StrokeShape>

                                                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                                    <Label Grid.Column="0" Text="&#x26A0;" FontSize="20" VerticalOptions="Center" />
                                                    <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                                                        <Label Text="{Binding PatientName}" FontSize="14" FontAttributes="Bold" />
                                                        <Label Text="{Binding AlertMessage}" FontSize="12" TextColor="#D97706" />
                                                        <Label Text="{Binding TimeAgo, StringFormat='{0} ago'}" FontSize="11" TextColor="{AppThemeBinding Light=#94A3B8, Dark=#64748B}" />
                                                    </VerticalStackLayout>
                                                    <Button Grid.Column="2"
                                                            Text="View"
                                                            Command="{Binding Source={RelativeSource AncestorType={x:Type pagemodels:HomePageModel}}, Path=NavigateToAlertPatientCommand, x:DataType=pagemodels:HomePageModel}"
                                        CommandParameter="{Binding .}"
                                                            BackgroundColor="#F59E0B"
                                                            TextColor="White"
                                                            Padding="12,6"
                                                            CornerRadius="8"
                                                            FontSize="12"
                                                            VerticalOptions="Center" />
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </VerticalStackLayout>
                        </Border>

                        <!-- ==================== QUICK INSIGHTS ==================== -->
                        <Border Grid.Row="5" Style="{StaticResource ModernCardStyle}">
                            <VerticalStackLayout Spacing="16">
                                <Label Text="Today's Insights" Style="{StaticResource SectionHeaderStyle}" />

                                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12">
                                    <!-- Prolonged Labour -->
                                    <Border Grid.Column="0" BackgroundColor="{AppThemeBinding Light=#FEF3C7, Dark=#78350F}" Padding="12">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12" />
                                        </Border.StrokeShape>
                                        <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                                            <Label Text="{Binding DashboardStats.ProlongedLaborCount}"
                                                   FontSize="28"
                                                   FontAttributes="Bold"
                                                   TextColor="#D97706"
                                                   HorizontalOptions="Center" />
                                            <Label Text="Prolonged" FontSize="11" TextColor="#92400E" HorizontalOptions="Center" />
                                            <Label Text="&#x003E;12 hours" FontSize="9" TextColor="#B45309" HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                    </Border>

                                    <!-- Abnormal FHR -->
                                    <Border Grid.Column="1" BackgroundColor="{AppThemeBinding Light=#FEE2E2, Dark=#7F1D1D}" Padding="12">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12" />
                                        </Border.StrokeShape>
                                        <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                                            <Label Text="{Binding DashboardStats.AbnormalFHRCount}"
                                                   FontSize="28"
                                                   FontAttributes="Bold"
                                                   TextColor="#DC2626"
                                                   HorizontalOptions="Center" />
                                            <Label Text="Abnormal FHR" FontSize="11" TextColor="#991B1B" HorizontalOptions="Center" />
                                            <Label Text="&#x003C;110 or &#x003E;160" FontSize="9" TextColor="#B91C1C" HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                    </Border>

                                    <!-- Overdue Checks -->
                                    <Border Grid.Column="2" BackgroundColor="{AppThemeBinding Light=#EDE9FE, Dark=#4C1D95}" Padding="12">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12" />
                                        </Border.StrokeShape>
                                        <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                                            <Label Text="{Binding DashboardStats.OverdueChecksCount}"
                                                   FontSize="28"
                                                   FontAttributes="Bold"
                                                   TextColor="#7C3AED"
                                                   HorizontalOptions="Center" />
                                            <Label Text="Overdue" FontSize="11" TextColor="#5B21B6" HorizontalOptions="Center" />
                                            <Label Text="Checks needed" FontSize="9" TextColor="#6D28D9" HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                    </Border>
                                </Grid>

                                <BoxView HeightRequest="1" Color="{AppThemeBinding Light=#E5E7EB, Dark=#374151}" />

                                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12">
                                    <!-- High Risk -->
                                    <VerticalStackLayout Grid.Column="0" Spacing="4" HorizontalOptions="Center">
                                        <Label Text="{Binding DashboardStats.HighRiskCount}"
                                               FontSize="22"
                                               FontAttributes="Bold"
                                               TextColor="#EF4444"
                                               HorizontalOptions="Center" />
                                        <Label Text="High Risk" FontSize="11" HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                    </VerticalStackLayout>

                                    <!-- Admissions Today -->
                                    <VerticalStackLayout Grid.Column="1" Spacing="4" HorizontalOptions="Center">
                                        <Label Text="{Binding DashboardStats.AdmissionsToday}"
                                               FontSize="22"
                                               FontAttributes="Bold"
                                               TextColor="#10B981"
                                               HorizontalOptions="Center" />
                                        <Label Text="Admissions" FontSize="11" HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                    </VerticalStackLayout>

                                    <!-- Meconium Stained -->
                                    <VerticalStackLayout Grid.Column="2" Spacing="4" HorizontalOptions="Center">
                                        <Label Text="{Binding DashboardStats.MeconiumStainedCount}"
                                               FontSize="22"
                                               FontAttributes="Bold"
                                               TextColor="#F59E0B"
                                               HorizontalOptions="Center" />
                                        <Label Text="Meconium" FontSize="11" HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                    </VerticalStackLayout>
                                </Grid>
                            </VerticalStackLayout>
                        </Border>

                        <!-- ==================== ADMISSION TRENDS CHART ==================== -->
                        <Border Grid.Row="6" Style="{StaticResource ModernCardStyle}">
                            <VerticalStackLayout Spacing="12">
                                <HorizontalStackLayout Spacing="8">
                                    <!--<Label Text="&#x1F4CA;" FontSize="18" VerticalOptions="Center" />-->
                                    <Label Text="Today's Admissions" Style="{StaticResource SectionHeaderStyle}" VerticalOptions="Center" />
                                </HorizontalStackLayout>

                                <sf:SfCartesianChart HeightRequest="180">
                                    <sf:SfCartesianChart.XAxes>
                                        <sf:CategoryAxis ShowMajorGridLines="False" />
                                        <!--LabelStyle="{StaticResource SmallTextStyle}"-->
                                    </sf:SfCartesianChart.XAxes>

                                    <sf:SfCartesianChart.YAxes>
                                        <sf:NumericalAxis ShowMajorGridLines="True" Minimum="0" />
                                    </sf:SfCartesianChart.YAxes>

                                    <sf:SfCartesianChart.Series>
                                        <sf:ColumnSeries ItemsSource="{Binding DashboardStats.AdmissionTrends}"
                                                         XBindingPath="HourLabel"
                                                         YBindingPath="AdmissionCount"
                                                         Fill="#3B82F6"
                                                         CornerRadius="4,4,0,0"
                                                         ShowDataLabels="False" />
                                    </sf:SfCartesianChart.Series>
                                </sf:SfCartesianChart>
                            </VerticalStackLayout>
                        </Border>

                        <!-- ==================== SHIFT HANDOVER ==================== -->
                        <Border Grid.Row="7" Style="{StaticResource ModernCardStyle}">
                            <VerticalStackLayout Spacing="12">
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <!--<Border Grid.Column="0" BackgroundColor="#3B82F620" Padding="8" WidthRequest="36" HeightRequest="36">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="8" />
                                        </Border.StrokeShape>
                                        <Label Text="&#x1F4CB;" FontSize="18" HorizontalOptions="Center" VerticalOptions="Center" />
                                    </Border>-->
                                    <Label Grid.Column="1"
                                           Text="Handover Summary"
                                           Style="{StaticResource SectionHeaderStyle}"
                                           VerticalOptions="Center"
                                           Margin="12,0,0,0" />
                                    <Label Grid.Column="2"
                                           Text="{Binding CurrentShift}"
                                           FontSize="12"
                                           FontAttributes="Bold"
                                           TextColor="#3B82F6"
                                           VerticalOptions="Center" />
                                </Grid>

                                <CollectionView ItemsSource="{Binding DashboardStats.ShiftHandoverItems}" SelectionMode="None">
                                    <CollectionView.EmptyView>
                                        <VerticalStackLayout Padding="20" HorizontalOptions="Center">
                                            <Label Text="&#x2705;" FontSize="32" HorizontalOptions="Center" Margin="0,0,0,8" />
                                            <Label Text="No patients requiring handover"
                                                   FontSize="14"
                                                   TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}"
                                                   HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                    </CollectionView.EmptyView>

                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="models:ShiftHandoverItem">
                                            <Border BackgroundColor="{AppThemeBinding Light=#F8FAFC, Dark=#0F172A}"
                                                    StrokeThickness="1"
                                                    Stroke="{AppThemeBinding Light=#E2E8F0, Dark=#334155}"
                                                    Margin="0,4"
                                                    Padding="12">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="10" />
                                                </Border.StrokeShape>

                                                <Grid ColumnDefinitions="4,*" ColumnSpacing="12">
                                                    <BoxView Grid.Column="0"
                                                             Color="{Binding Status, Converter={StaticResource StatusColorConverter}}"
                                                             CornerRadius="2"
                                                             VerticalOptions="Fill" />

                                                    <VerticalStackLayout Grid.Column="1" Spacing="4">
                                                        <HorizontalStackLayout Spacing="8">
                                                            <Label Text="{Binding PatientName}" FontSize="14" FontAttributes="Bold" />
                                                            <Label Text="{Binding HospitalNumber, StringFormat='({0})'}" FontSize="12" TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                                        </HorizontalStackLayout>
                                                        <Label Text="{Binding KeyNotes}" FontSize="12" TextColor="{AppThemeBinding Light=#475569, Dark=#CBD5E1}" />
                                                        <Label Text="{Binding AdmissionTime, StringFormat='Admitted: {0:MMM dd, HH:mm}'}" FontSize="11" TextColor="{AppThemeBinding Light=#94A3B8, Dark=#64748B}" />
                                                    </VerticalStackLayout>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </VerticalStackLayout>
                        </Border>

                        <!-- ==================== WHO COMPLIANCE ==================== -->
                        <Border Grid.Row="8" Style="{StaticResource ModernCardStyle}">
                            <VerticalStackLayout Spacing="12">
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <HorizontalStackLayout Grid.Column="0" Spacing="8">
                                        <!--<Border BackgroundColor="#10B98120" Padding="8" WidthRequest="36" HeightRequest="36">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>
                                            <Label Text="&#x2696;" FontSize="18" HorizontalOptions="Center" VerticalOptions="Center" />
                                        </Border>-->
                                        <Label Text="WHO Compliance"
                                               Style="{StaticResource SectionHeaderStyle}"
                                               VerticalOptions="Center" />
                                    </HorizontalStackLayout>
                                    <Border Grid.Column="2"
                                            BackgroundColor="{Binding DashboardStats.ComplianceMetrics.ComplianceRate, Converter={StaticResource ComplianceToColorConverter}}"
                                            Padding="12,6"
                                            VerticalOptions="Center">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12" />
                                        </Border.StrokeShape>
                                        <Label Text="{Binding DashboardStats.ComplianceMetrics.ComplianceRate, StringFormat='{0:F0}%'}"
                                               FontSize="14"
                                               FontAttributes="Bold" />
                                    </Border>
                                </Grid>

                                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                                    <!-- Alert Line Crossings -->
                                    <Border Grid.Column="0" Grid.Row="0" BackgroundColor="{AppThemeBinding Light=#FEF3C7, Dark=#78350F}" Padding="12">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="10" />
                                        </Border.StrokeShape>
                                        <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                                            <Label Text="{Binding DashboardStats.ComplianceMetrics.AlertLineCrossings}"
                                                   FontSize="24"
                                                   FontAttributes="Bold"
                                                   TextColor="#D97706"
                                                   HorizontalOptions="Center" />
                                            <Label Text="Alert Line" FontSize="12" HorizontalOptions="Center" TextColor="#92400E" />
                                        </VerticalStackLayout>
                                    </Border>

                                    <!-- Action Line Crossings -->
                                    <Border Grid.Column="1" Grid.Row="0" BackgroundColor="{AppThemeBinding Light=#FEE2E2, Dark=#7F1D1D}" Padding="12">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="10" />
                                        </Border.StrokeShape>
                                        <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                                            <Label Text="{Binding DashboardStats.ComplianceMetrics.ActionLineCrossings}"
                                                   FontSize="24"
                                                   FontAttributes="Bold"
                                                   TextColor="#DC2626"
                                                   HorizontalOptions="Center" />
                                            <Label Text="Action Line" FontSize="12" HorizontalOptions="Center" TextColor="#991B1B" />
                                        </VerticalStackLayout>
                                    </Border>

                                    <!-- On-Time Assessments -->
                                    <Border Grid.Column="0" Grid.Row="1" BackgroundColor="{AppThemeBinding Light=#D1FAE5, Dark=#065F46}" Padding="12">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="10" />
                                        </Border.StrokeShape>
                                        <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                                            <Label Text="{Binding DashboardStats.ComplianceMetrics.OnTimeAssessments}"
                                                   FontSize="24"
                                                   FontAttributes="Bold"
                                                   TextColor="#059669"
                                                   HorizontalOptions="Center" />
                                            <Label Text="On-Time" FontSize="12" HorizontalOptions="Center" TextColor="#047857" />
                                        </VerticalStackLayout>
                                    </Border>

                                    <!-- Late Assessments -->
                                    <Border Grid.Column="1" Grid.Row="1" BackgroundColor="{AppThemeBinding Light=#F3F4F6, Dark=#374151}" Padding="12">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="10" />
                                        </Border.StrokeShape>
                                        <VerticalStackLayout Spacing="4" HorizontalOptions="Center">
                                            <Label Text="{Binding DashboardStats.ComplianceMetrics.LateAssessments}"
                                                   FontSize="24"
                                                   FontAttributes="Bold"
                                                   TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"
                                                   HorizontalOptions="Center" />
                                            <Label Text="Late" FontSize="12" HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}" />
                                        </VerticalStackLayout>
                                    </Border>
                                </Grid>
                            </VerticalStackLayout>
                        </Border>

                        <!-- ==================== RECENT ACTIVITY ==================== -->
                        <Border Grid.Row="9" Style="{StaticResource ModernCardStyle}">
                            <VerticalStackLayout Spacing="12">
                                <HorizontalStackLayout Spacing="8">
                                    <!--<Border BackgroundColor="#8B5CF620" Padding="8" WidthRequest="36" HeightRequest="36">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="8" />
                                        </Border.StrokeShape>
                                        <Label Text="&#x1F4AC;" FontSize="18" HorizontalOptions="Center" VerticalOptions="Center" />
                                    </Border>-->
                                    <Label Text="Recent Activity" Style="{StaticResource SectionHeaderStyle}" VerticalOptions="Center" />
                                </HorizontalStackLayout>

                                <CollectionView ItemsSource="{Binding DashboardStats.RecentActivities}" SelectionMode="None">
                                    <CollectionView.EmptyView>
                                        <Label Text="No recent activity"
                                               FontSize="14"
                                               TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}"
                                               HorizontalOptions="Center"
                                               Margin="0,20" />
                                    </CollectionView.EmptyView>

                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="models:RecentActivityItem">
                                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12" Padding="4,8">
                                                <!-- Activity Icon -->
                                                <Border Grid.Column="0"
                                                        WidthRequest="40"
                                                        HeightRequest="40"
                                                        BackgroundColor="{Binding Type, Converter={StaticResource ActivityTypeToColorConverter}}"
                                                        VerticalOptions="Center">
                                                    <Border.StrokeShape>
                                                        <Ellipse />
                                                    </Border.StrokeShape>
                                                    <Label Text="{Binding Type, Converter={StaticResource ActivityTypeToIconConverter}}"
                                                           FontSize="18"
                                                           TextColor="White"
                                                           HorizontalOptions="Center"
                                                           VerticalOptions="Center" />
                                                </Border>

                                                <!-- Activity Details -->
                                                <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                                                    <Label Text="{Binding Description}" FontSize="14" FontAttributes="Bold" />
                                                    <Label Text="{Binding TimeAgo, StringFormat='{0} ago'}" FontSize="12" TextColor="{AppThemeBinding Light=#94A3B8, Dark=#64748B}" />
                                                </VerticalStackLayout>

                                                <!-- Time Badge -->
                                                <Label Grid.Column="2"
                                                       Text="{Binding Timestamp, StringFormat='{0:HH:mm}'}"
                                                       FontSize="11"
                                                       TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}"
                                                       VerticalOptions="Center" />
                                            </Grid>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </VerticalStackLayout>
                        </Border>

                        <!-- Bottom Spacing -->
                        <!--<BoxView Grid.Row="10" HeightRequest="20" Color="Transparent" />-->

                    </Grid>
                </ScrollView>
            </RefreshView>
        </tabView:SfTabItem>

        <tabView:SfTabItem Header="Pending" ImageSource="pending_silent_mute_sound_audio_off_svgrepo.png">
            <views:PendingPatientsView x:Name="PendingPatients" Loaded="PendingPatients_Loaded" />
        </tabView:SfTabItem>

        <tabView:SfTabItem Header="Active" ImageSource="bell_active_svgrepo.png">
            <views:ActivePatientsView x:Name="ActivePatients" Loaded="ActivePatients_Loaded" />
        </tabView:SfTabItem>

        <tabView:SfTabItem Header="Completed" ImageSource="todo_done_svgrepo.png">
            <views:CompletedPatientsView x:Name="CompletedPatients" Loaded="CompletedPatients_Loaded" />
        </tabView:SfTabItem>
    </tabView:SfTabView>

</ContentPage>
