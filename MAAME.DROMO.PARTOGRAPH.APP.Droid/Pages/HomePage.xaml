<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.HomePage"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:sf="clr-namespace:Syncfusion.Maui.Toolkit.Charts;assembly=Syncfusion.Maui.Toolkit"
             xmlns:controls="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.Controls"
             xmlns:sfGauge="clr-namespace:Syncfusion.Maui.Gauges;assembly=Syncfusion.Maui.Gauges"
             xmlns:sfCards="clr-namespace:Syncfusion.Maui.Toolkit.Cards;assembly=Syncfusion.Maui.Toolkit"
             xmlns:models="clr-namespace:MAAME.DROMO.PARTOGRAPH.MODEL;assembly=MAAME.DROMO.PARTOGRAPH.MODEL"
             xmlns:pagemodels="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.PageModels"
             xmlns:views="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.Views"
             xmlns:converters="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Converters"
             xmlns:tabView="http://schemas.syncfusion.com/maui"
             xmlns:fonts="clr-namespace:Fonts"
             Title="Partograph Dashboard"
             BackgroundColor="{AppThemeBinding Light=#F8FAFC, Dark=#0F172A}">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior EventName="NavigatedTo" Command="{Binding NavigatedToCommand}" />
        <toolkit:EventToCommandBehavior EventName="Appearing" Command="{Binding AppearingCommand}" />
    </ContentPage.Behaviors>

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Converters -->
            <converters:SeverityToColorConverter x:Key="SeverityToColorConverter" />
            <converters:IsNotNullConverter x:Key="IsNotNullConverter" />
            <converters:StatusColorConverter x:Key="StatusColorConverter" />
            <converters:ComplianceToColorConverter x:Key="ComplianceToColorConverter" />
            <converters:ActivityTypeToColorConverter x:Key="ActivityTypeToColorConverter" />
            <converters:ActivityTypeToIconConverter x:Key="ActivityTypeToIconConverter" />
            <converters:PercentageToProgressConverter x:Key="PercentageToProgressConverter" />

            <!-- Modern Card Style -->
            <Style x:Key="ModernCardStyle" TargetType="Border">
                <Setter Property="StrokeThickness" Value="0" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=White, Dark=#1E293B}" />
                <Setter Property="Padding" Value="24" />
                <Setter Property="StrokeShape">
                    <RoundRectangle CornerRadius="20" />
                </Setter>
                <Setter Property="Shadow">
                    <Shadow Brush="{AppThemeBinding Light=#10000000, Dark=#30000000}"
                            Offset="0,8"
                            Radius="24"
                            Opacity="0.15" />
                </Setter>
            </Style>

            <!-- Stat Card Style -->
            <Style x:Key="StatCardStyle" TargetType="sfCards:SfCardView">
                <Setter Property="CornerRadius" Value="8" />
                <Setter Property="BorderWidth" Value="0" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=White, Dark=#1E293B}" />
            </Style>

            <!-- Header Text Style -->
            <Style x:Key="HeaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="32" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}" />
            </Style>

            <!-- Subheader Style -->
            <Style x:Key="SubheaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                <Setter Property="Margin" Value="0,0,0,24" />
            </Style>

            <!-- Metric Number Style -->
            <Style x:Key="MetricNumberStyle" TargetType="Label">
                <Setter Property="FontSize" Value="28" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="Margin" Value="0,8,0,4" />
            </Style>

            <!-- Metric Label Style -->
            <Style x:Key="MetricLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="Opacity" Value="0.8" />
                <Setter Property="Margin" Value="0,0,0,8" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <tabView:SfTabView x:Name="TabView" TabBarHeight="72" EnableSwiping="False" TabBarPlacement="Bottom">
        <tabView:SfTabItem Header="Home" ImagePosition="Top" ImageSource="home_svgrepo.png">
            <ScrollView>
                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,*" Padding="20" RowSpacing="24">

                    <!-- Enhanced Header Section -->
                    <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="Partograph Dashboard" Style="{StaticResource HeaderStyle}" />
                            <HorizontalStackLayout Spacing="12">
                                <Label Text="{Binding Today, StringFormat='{0:dddd, MMMM dd}'}"
                               Style="{StaticResource SubheaderStyle}" Margin="0,8" />
                                <Border BackgroundColor="#10B981" Padding="8,4" VerticalOptions="Center">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12" />
                                    </Border.StrokeShape>
                                    <HorizontalStackLayout Spacing="4">
                                        <Ellipse Fill="#FFFFFF" WidthRequest="6" HeightRequest="6" />
                                        <Label Text="Live Monitoring"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="White" />
                                    </HorizontalStackLayout>
                                </Border>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>

                        <!-- Quick Action FAB -->
                        <controls:AddButton Grid.Column="1"
                                    BackgroundColor="#3B82F6"
                                    WidthRequest="64"
                                    HeightRequest="64"
                                    FontSize="24"
                                    ToolTipProperties.Text="Admit New Patient"
                                    Command="{Binding AddNewPatientCommand}" />
                    </Grid>

                    <!-- Quick Patient Search -->
                    <!--<Border Grid.Row="1" Style="{StaticResource ModernCardStyle}" Padding="16">
                        <Grid ColumnDefinitions="*,Auto">
                            <Entry Grid.Column="0"
                                   Placeholder="Quick search by name or hospital number..."
                                   Text="{Binding SearchQuery}"
                                   ReturnCommand="{Binding PerformQuickSearchCommand}"
                                   ClearButtonVisibility="WhileEditing"
                                   FontSize="14"
                                   VerticalOptions="Center" />
                            <Button Grid.Column="1"
                                    Text="Search"
                                    Command="{Binding PerformQuickSearchCommand}"
                                    BackgroundColor="#3B82F6"
                                    TextColor="White"
                                    Padding="16,8"
                                    Margin="8,0,0,0"
                                    CornerRadius="8" />
                        </Grid>
                    </Border>-->

                    <!-- Advanced Metrics Grid -->
                    <Grid Grid.Row="2" ColumnDefinitions="*,*" RowDefinitions="*,*" ColumnSpacing="4" RowSpacing="4">
                        <!-- Active Labor -->
                        <sfCards:SfCardView Grid.Column="0" Style="{StaticResource StatCardStyle}" Padding="8">
                            <Grid RowDefinitions="Auto,*,Auto" RowSpacing="8">
                                <Label Grid.Row="0" Text="ACTIVE LABOUR" Style="{StaticResource MetricLabelStyle}" TextColor="#10B981" />

                                <VerticalStackLayout Grid.Row="1" VerticalOptions="Center">
                                    <Label Text="{Binding DashboardStats.ActiveLabor}" 
                                   Style="{StaticResource MetricNumberStyle}"
                                   TextColor="#10B981" />
                                    <HorizontalStackLayout Spacing="4">
                                        <Label Text="â—" FontSize="8" TextColor="#10B981" VerticalOptions="Center" />
                                        <Label Text="Real-time monitoring"
                                       FontSize="11"
                                       TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </Grid>
                            <sfCards:SfCardView.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding NavigateToActivePatientsCommand}" />
                            </sfCards:SfCardView.GestureRecognizers>
                        </sfCards:SfCardView>

                        <!-- Pre-Labor -->
                        <sfCards:SfCardView Grid.Column="1" Style="{StaticResource StatCardStyle}" Padding="8">
                            <Grid RowDefinitions="Auto,*,Auto" RowSpacing="8">
                                <Label Grid.Row="0" Text="PRE-LABOUR" Style="{StaticResource MetricLabelStyle}" TextColor="#F59E0B" />

                                <VerticalStackLayout Grid.Row="1" VerticalOptions="Center">
                                    <Label Text="{Binding DashboardStats.PendingLabor}" 
                                   Style="{StaticResource MetricNumberStyle}"
                                   TextColor="#F59E0B" />
                                    <HorizontalStackLayout Spacing="4">
                                        <Label Text="â–²" FontSize="12" TextColor="#10B981" VerticalOptions="Center" />
                                        <Label Text="+2 admissions today"
                                       FontSize="11"
                                       TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </Grid>
                            <sfCards:SfCardView.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding NavigateToPendingPatientsCommand}" />
                            </sfCards:SfCardView.GestureRecognizers>
                        </sfCards:SfCardView>

                        <!-- Delivered Today -->
                        <sfCards:SfCardView Grid.Column="0" Grid.Row="1" Style="{StaticResource StatCardStyle}" Padding="8">
                            <Grid RowDefinitions="Auto,*,Auto" RowSpacing="8">
                                <Label Grid.Row="0" Text="DELIVERED" Style="{StaticResource MetricLabelStyle}" TextColor="#3B82F6" />

                                <VerticalStackLayout Grid.Row="1" VerticalOptions="Center">
                                    <Label Text="{Binding DashboardStats.CompletedToday}" 
                                   Style="{StaticResource MetricNumberStyle}"
                                   TextColor="#3B82F6" />
                                    <HorizontalStackLayout Spacing="4">
                                        <Label Text="â±" FontSize="10" VerticalOptions="Center" />
                                        <Label Text="{Binding DashboardStats.AvgDeliveryTime, StringFormat='Avg: {0}h'}"
                                       FontSize="11"
                                       TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </Grid>
                            <sfCards:SfCardView.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding NavigateToCompletedPatientsCommand}" />
                            </sfCards:SfCardView.GestureRecognizers>
                        </sfCards:SfCardView>

                        <!-- Emergency Cases -->
                        <sfCards:SfCardView Grid.Column="1" Grid.Row="1" Style="{StaticResource StatCardStyle}" Padding="8">
                            <Grid RowDefinitions="Auto,*,Auto" RowSpacing="8">
                                <Label Grid.Row="0" Text="EMERGENCY" Style="{StaticResource MetricLabelStyle}" TextColor="#EF4444" />

                                <VerticalStackLayout Grid.Row="1" VerticalOptions="Center">
                                    <Label Text="{Binding DashboardStats.EmergencyCases}" 
                                   Style="{StaticResource MetricNumberStyle}"
                                   TextColor="#EF4444" />
                                    <HorizontalStackLayout Spacing="4">
                                        <Label Text="ðŸš¨" FontSize="10" VerticalOptions="Center" />
                                        <Label Text="Immediate attention"
                                       FontSize="11"
                                       TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </Grid>
                            <sfCards:SfCardView.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding NavigateToEmergencyPatientsCommand}" />
                            </sfCards:SfCardView.GestureRecognizers>
                        </sfCards:SfCardView>
                    </Grid>

                    <!-- Critical Patients Preview Section -->
                    <Border Grid.Row="3" Style="{StaticResource ModernCardStyle}" Padding="20"
                            IsVisible="{Binding HasCriticalPatients}">
                        <VerticalStackLayout Spacing="16">
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0"
                                       Text="Critical Patients Requiring Attention"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}" />
                                <Border Grid.Column="1"
                                        BackgroundColor="#EF4444"
                                        Padding="8,4"
                                        VerticalOptions="Center">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12" />
                                    </Border.StrokeShape>
                                    <Label Text="{Binding DashboardStats.CriticalPatients.Count}"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="White" />
                                </Border>
                            </Grid>

                            <CollectionView ItemsSource="{Binding DashboardStats.CriticalPatients}"
                                            SelectionMode="None">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="models:CriticalPatientInfo">
                                        <Border StrokeThickness="1"
                                                Margin="0,4"
                                                Padding="12">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>
                                            <Border.Stroke>
                                                <SolidColorBrush Color="{Binding Severity, Converter={StaticResource SeverityToColorConverter}}" />
                                            </Border.Stroke>

                                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                                <!-- Severity Indicator -->
                                                <Border Grid.Column="0"
                                                        WidthRequest="4"
                                                        HeightRequest="60"
                                                        VerticalOptions="Fill">
                                                    <Border.Background>
                                                        <SolidColorBrush Color="{Binding Severity, Converter={StaticResource SeverityToColorConverter}}" />
                                                    </Border.Background>
                                                </Border>

                                                <!-- Patient Info -->
                                                <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                                                    <Label Text="{Binding PatientName}"
                                                           FontSize="16"
                                                           FontAttributes="Bold" />
                                                    <Label Text="{Binding HospitalNumber, StringFormat='ID: {0}'}"
                                                           FontSize="12"
                                                           Opacity="0.7" />
                                                    <Label Text="{Binding ReasonForConcern}"
                                                           FontSize="13"
                                                           TextColor="#EF4444"
                                                           FontAttributes="Bold" />
                                                    <HorizontalStackLayout Spacing="12">
                                                        <Label Text="{Binding TimeInLabor, StringFormat='In labour: {0}'}"
                                                               FontSize="12"
                                                               Opacity="0.7" />
                                                        <Label Text="{Binding CurrentDilation, StringFormat='Dilation: {0}cm'}"
                                                               FontSize="12"
                                                               Opacity="0.7"
                                                               IsVisible="{Binding CurrentDilation, Converter={StaticResource IsNotNullConverter}}" />
                                                        <Label Text="{Binding LastFetalHeartRate, StringFormat='FHR: {0} bpm'}"
                                                               FontSize="12"
                                                               Opacity="0.7"
                                                               IsVisible="{Binding LastFetalHeartRate, Converter={StaticResource IsNotNullConverter}}" />
                                                    </HorizontalStackLayout>
                                                </VerticalStackLayout>

                                                <!-- Action Button -->
                                                <Button Grid.Column="2"
                                                        Text="View"
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type pagemodels:HomePageModel}}, Path=NavigateToCriticalPatientCommand}"
                                                        CommandParameter="{Binding .}"
                                                        BackgroundColor="#3B82F6"
                                                        TextColor="White"
                                                        Padding="16,8"
                                                        CornerRadius="8"
                                                        VerticalOptions="Center" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Real-time Alerts Panel -->
                    <Border Grid.Row="4" Style="{StaticResource ModernCardStyle}" Padding="20"
                            IsVisible="{Binding HasAlerts}">
                        <VerticalStackLayout Spacing="16">
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0"
                                       Text="Active Alerts"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}" />
                                <Border Grid.Column="1"
                                        BackgroundColor="#F59E0B"
                                        Padding="8,4"
                                        VerticalOptions="Center">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12" />
                                    </Border.StrokeShape>
                                    <Label Text="{Binding DashboardStats.ActiveAlerts.Count}"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="White" />
                                </Border>
                            </Grid>

                            <CollectionView ItemsSource="{Binding DashboardStats.ActiveAlerts}"
                                            SelectionMode="None">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="models:PatientAlert">
                                        <Border BackgroundColor="{AppThemeBinding Light=#FEF3C7, Dark=#78350F}"
                                                Margin="0,4"
                                                Padding="12">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>

                                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                                <!-- Alert Icon -->
                                                <Label Grid.Column="0"
                                                       Text="âš ï¸"
                                                       FontSize="24"
                                                       VerticalOptions="Center" />

                                                <!-- Alert Info -->
                                                <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                                                    <Label Text="{Binding PatientName}"
                                                           FontSize="14"
                                                           FontAttributes="Bold" />
                                                    <Label Text="{Binding AlertMessage}"
                                                           FontSize="13"
                                                           TextColor="#D97706" />
                                                    <Label Text="{Binding TimeAgo, StringFormat='{0} ago'}"
                                                           FontSize="11"
                                                           Opacity="0.7" />
                                                </VerticalStackLayout>

                                                <!-- Action Button -->
                                                <Button Grid.Column="2"
                                                        Text="View"
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type pagemodels:HomePageModel}}, Path=NavigateToAlertPatientCommand}"
                                                        CommandParameter="{Binding .}"
                                                        BackgroundColor="#F59E0B"
                                                        TextColor="White"
                                                        Padding="12,6"
                                                        CornerRadius="8"
                                                        FontSize="12"
                                                        VerticalOptions="Center" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Enhanced Insights Section -->
                    <Border Grid.Row="5" Style="{StaticResource ModernCardStyle}" Padding="20">
                        <VerticalStackLayout Spacing="12">
                            <Label Text="Today's Insights"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}" />

                            <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                                <!-- Prolonged Labor -->
                                <VerticalStackLayout Grid.Column="0" Spacing="4">
                                    <Label Text="{Binding DashboardStats.ProlongedLaborCount}"
                                           FontSize="24"
                                           FontAttributes="Bold"
                                           TextColor="#F59E0B"
                                           HorizontalOptions="Center" />
                                    <Label Text="Prolonged Labour"
                                           FontSize="11"
                                           HorizontalOptions="Center"
                                           HorizontalTextAlignment="Center"
                                           Opacity="0.7" />
                                </VerticalStackLayout>

                                <!-- High Risk -->
                                <VerticalStackLayout Grid.Column="1" Spacing="4">
                                    <Label Text="{Binding DashboardStats.HighRiskCount}"
                                           FontSize="24"
                                           FontAttributes="Bold"
                                           TextColor="#EF4444"
                                           HorizontalOptions="Center" />
                                    <Label Text="High Risk"
                                           FontSize="11"
                                           HorizontalOptions="Center"
                                           HorizontalTextAlignment="Center"
                                           Opacity="0.7" />
                                </VerticalStackLayout>

                            </Grid>

                            <BoxView HeightRequest="1" Color="{AppThemeBinding Light=#E5E7EB, Dark=#374151}" Margin="0,8" />

                            <Grid ColumnDefinitions="*,*" ColumnSpacing="8">

                                <!-- Overdue Checks -->
                                <VerticalStackLayout Grid.Column="0" Spacing="4">
                                    <Label Text="Overdue Checks"
                                           FontSize="11"
                                           HorizontalOptions="Center" 
                                           Opacity="0.7" />
                                    <Label Text="{Binding DashboardStats.OverdueChecksCount}"
                                           FontSize="24"
                                           FontAttributes="Bold"
                                           TextColor="#8B5CF6"
                                           HorizontalOptions="Center" />
                                </VerticalStackLayout>
                                
                                <VerticalStackLayout Grid.Column="1" Spacing="4">
                                    <Label Text="Admissions Today"
                                           FontSize="12"
                                           HorizontalOptions="Center"
                                           Opacity="0.7" />
                                    <Label Text="{Binding DashboardStats.AdmissionsToday}"
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           HorizontalOptions="Center"
                                           TextColor="#10B981" />
                                </VerticalStackLayout>

                                <!--<VerticalStackLayout Grid.Column="1" Spacing="4">
                                    <Label Text="This Shift"
                                           FontSize="12"
                                           HorizontalOptions="Center"
                                           Opacity="0.7" />
                                    <Label Text="{Binding DashboardStats.AdmissionsThisShift}"
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           HorizontalOptions="Center"
                                           TextColor="#3B82F6" />
                                </VerticalStackLayout>-->
                            </Grid>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Labor Progress Trends Chart -->
                    <Border Grid.Row="6" Style="{StaticResource ModernCardStyle}" Padding="20">
                        <VerticalStackLayout Spacing="16">
                            <Label Text="Admissions (Today)"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}" />

                            <sf:SfCartesianChart HeightRequest="200">
                                <sf:SfCartesianChart.XAxes>
                                    <sf:CategoryAxis ShowMajorGridLines="False" />
                                </sf:SfCartesianChart.XAxes>

                                <sf:SfCartesianChart.YAxes>
                                    <sf:NumericalAxis ShowMajorGridLines="True" />
                                </sf:SfCartesianChart.YAxes>

                                <sf:SfCartesianChart.Series>
                                    <sf:ColumnSeries ItemsSource="{Binding DashboardStats.AdmissionTrends}"
                                                     XBindingPath="HourLabel"
                                                     YBindingPath="AdmissionCount"
                                                     Fill="#3B82F6"
                                                     ShowDataLabels="True" />
                                </sf:SfCartesianChart.Series>
                            </sf:SfCartesianChart>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Shift Handover Summary -->
                    <Border Grid.Row="7" Style="{StaticResource ModernCardStyle}" Padding="20">
                        <VerticalStackLayout Spacing="16">
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0"
                                       Text="Handover Summary"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}" />
                                <!--<Label Grid.Column="1"
                                       Text="{Binding CurrentShift}"
                                       FontSize="14"
                                       TextColor="#3B82F6"
                                       FontAttributes="Bold" />-->
                            </Grid>

                            <CollectionView ItemsSource="{Binding DashboardStats.ShiftHandoverItems}"
                                            SelectionMode="None">
                                <CollectionView.EmptyView>
                                    <Label Text="No patients requiring handover"
                                           FontSize="14"
                                           Opacity="0.7"
                                           HorizontalOptions="Center"
                                           Margin="0,20" />
                                </CollectionView.EmptyView>

                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="models:ShiftHandoverItem">
                                        <Border BackgroundColor="{AppThemeBinding Light=#F8FAFC, Dark=#1E293B}"
                                                StrokeThickness="1"
                                                Stroke="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                                                Margin="0,4"
                                                Padding="12">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>

                                            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                                                <!-- Status Indicator -->
                                                <BoxView Grid.Column="0"
                                                         WidthRequest="4"
                                                         HeightRequest="50"
                                                         Color="{Binding Status, Converter={StaticResource StatusColorConverter}}"
                                                         CornerRadius="2" />

                                                <!-- Patient Info -->
                                                <VerticalStackLayout Grid.Column="1" Spacing="4">
                                                    <HorizontalStackLayout Spacing="8">
                                                        <Label Text="{Binding PatientName}"
                                                               FontSize="15"
                                                               FontAttributes="Bold" />
                                                        <Label Text="{Binding HospitalNumber, StringFormat='({0})'}"
                                                               FontSize="13"
                                                               Opacity="0.7" />
                                                    </HorizontalStackLayout>

                                                    <Label Text="{Binding KeyNotes}"
                                                           FontSize="13"
                                                           Opacity="0.8" />

                                                    <Label Text="{Binding AdmissionTime, StringFormat='Admitted: {0:MMM dd, HH:mm}'}"
                                                           FontSize="12"
                                                           Opacity="0.6" />
                                                </VerticalStackLayout>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Border>

                    <!-- WHO Compliance Dashboard -->
                    <Border Grid.Row="8" Style="{StaticResource ModernCardStyle}" Padding="20">
                        <VerticalStackLayout Spacing="16">
                            <HorizontalStackLayout Spacing="12">
                                <Label Text="WHO Labour Care Compliance"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}"
                                       VerticalOptions="Center" />
                                <Border BackgroundColor="{Binding DashboardStats.ComplianceMetrics.ComplianceRate, Converter={StaticResource ComplianceToColorConverter}}"
                                        Padding="8,4"
                                        VerticalOptions="Center">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12" />
                                    </Border.StrokeShape>
                                    <Label Text="{Binding DashboardStats.ComplianceMetrics.ComplianceRate, StringFormat='{0}%'}"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="White" />
                                </Border>
                            </HorizontalStackLayout>

                            <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                                <!-- Alert Line Crossings -->
                                <Border Grid.Column="0" Grid.Row="0"
                                        BackgroundColor="{AppThemeBinding Light=#FEF3C7, Dark=#78350F}"
                                        Padding="12">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8" />
                                    </Border.StrokeShape>
                                    <VerticalStackLayout Spacing="4">
                                        <Label Text="{Binding DashboardStats.ComplianceMetrics.AlertLineCrossings}"
                                               FontSize="24"
                                               FontAttributes="Bold"
                                               TextColor="#F59E0B"
                                               HorizontalOptions="Center" />
                                        <Label Text="Alert Line Crossings"
                                               FontSize="11"
                                               HorizontalOptions="Center"
                                               HorizontalTextAlignment="Center"
                                               Opacity="0.8" />
                                    </VerticalStackLayout>
                                </Border>

                                <!-- Action Line Crossings -->
                                <Border Grid.Column="1" Grid.Row="0"
                                        BackgroundColor="{AppThemeBinding Light=#FEE2E2, Dark=#7F1D1D}"
                                        Padding="12">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8" />
                                    </Border.StrokeShape>
                                    <VerticalStackLayout Spacing="4">
                                        <Label Text="{Binding DashboardStats.ComplianceMetrics.ActionLineCrossings}"
                                               FontSize="24"
                                               FontAttributes="Bold"
                                               TextColor="#EF4444"
                                               HorizontalOptions="Center" />
                                        <Label Text="Action Line Crossings"
                                               FontSize="11"
                                               HorizontalOptions="Center"
                                               HorizontalTextAlignment="Center"
                                               Opacity="0.8" />
                                    </VerticalStackLayout>
                                </Border>

                                <!-- On-Time Assessments -->
                                <Border Grid.Column="0" Grid.Row="1"
                                        BackgroundColor="{AppThemeBinding Light=#D1FAE5, Dark=#065F46}"
                                        Padding="12">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8" />
                                    </Border.StrokeShape>
                                    <VerticalStackLayout Spacing="4">
                                        <Label Text="{Binding DashboardStats.ComplianceMetrics.OnTimeAssessments}"
                                               FontSize="24"
                                               FontAttributes="Bold"
                                               TextColor="#10B981"
                                               HorizontalOptions="Center" />
                                        <Label Text="On-Time Assessments"
                                               FontSize="11"
                                               HorizontalOptions="Center"
                                               HorizontalTextAlignment="Center"
                                               Opacity="0.8" />
                                    </VerticalStackLayout>
                                </Border>

                                <!-- Late Assessments -->
                                <Border Grid.Column="1" Grid.Row="1"
                                        BackgroundColor="{AppThemeBinding Light=#F3F4F6, Dark=#374151}"
                                        Padding="12">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8" />
                                    </Border.StrokeShape>
                                    <VerticalStackLayout Spacing="4">
                                        <Label Text="{Binding DashboardStats.ComplianceMetrics.LateAssessments}"
                                               FontSize="24"
                                               FontAttributes="Bold"
                                               TextColor="{AppThemeBinding Light=#6B7280, Dark=#9CA3AF}"
                                               HorizontalOptions="Center" />
                                        <Label Text="Late Assessments"
                                               FontSize="11"
                                               HorizontalOptions="Center"
                                               HorizontalTextAlignment="Center"
                                               Opacity="0.8" />
                                    </VerticalStackLayout>
                                </Border>
                            </Grid>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Recent Activity Timeline -->
                    <Border Grid.Row="9" Style="{StaticResource ModernCardStyle}" Padding="20">
                        <VerticalStackLayout Spacing="16">
                            <Label Text="Recent Activity"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}" />

                            <CollectionView ItemsSource="{Binding DashboardStats.RecentActivities}"
                                            SelectionMode="None">
                                <CollectionView.EmptyView>
                                    <Label Text="No recent activity"
                                           FontSize="14"
                                           Opacity="0.7"
                                           HorizontalOptions="Center"
                                           Margin="0,20" />
                                </CollectionView.EmptyView>

                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="models:RecentActivityItem">
                                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12" Padding="8,4">
                                            <!-- Activity Icon -->
                                            <Border Grid.Column="0"
                                                    WidthRequest="40"
                                                    HeightRequest="40"
                                                    BackgroundColor="{Binding Type, Converter={StaticResource ActivityTypeToColorConverter}}"
                                                    VerticalOptions="Center">
                                                <Border.StrokeShape>
                                                    <Ellipse />
                                                </Border.StrokeShape>
                                                <Label Text="{Binding Type, Converter={StaticResource ActivityTypeToIconConverter}}"
                                                       FontSize="20"
                                                       TextColor="White"
                                                       HorizontalOptions="Center"
                                                       VerticalOptions="Center" />
                                            </Border>

                                            <!-- Activity Details -->
                                            <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                                                <Label Text="{Binding Description}"
                                                       FontSize="14"
                                                       FontAttributes="Bold" />
                                                <Label Text="{Binding TimeAgo, StringFormat='{0} ago'}"
                                                       FontSize="12"
                                                       Opacity="0.6" />
                                            </VerticalStackLayout>

                                            <!-- Time Badge -->
                                            <Label Grid.Column="2"
                                                   Text="{Binding Timestamp, StringFormat='{0:HH:mm}'}"
                                                   FontSize="12"
                                                   Opacity="0.7"
                                                   VerticalOptions="Center" />
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Resource Utilization -->
                    <!--<Border Grid.Row="10" Style="{StaticResource ModernCardStyle}" Padding="20">
                        <VerticalStackLayout Spacing="16">
                            <Label Text="Resource Utilization"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}" />

                            --><!-- Bed Occupancy --><!--
                            <VerticalStackLayout Spacing="8">
                                <HorizontalStackLayout Spacing="8">
                                    <Label Text="Bed Occupancy"
                                           FontSize="14"
                                           FontAttributes="Bold" />
                                    <Label Text="{Binding DashboardStats.Resources.OccupancyRate, StringFormat='{0}%'}"
                                           FontSize="14"
                                           TextColor="#3B82F6"
                                           FontAttributes="Bold" />
                                </HorizontalStackLayout>

                                <ProgressBar Progress="{Binding DashboardStats.Resources.OccupancyRate, Converter={StaticResource PercentageToProgressConverter}}"
                                             ProgressColor="#3B82F6"
                                             HeightRequest="8" />

                                <HorizontalStackLayout Spacing="16">
                                    <Label Text="{Binding DashboardStats.Resources.OccupiedBeds, StringFormat='Occupied: {0}'}"
                                           FontSize="12"
                                           Opacity="0.7" />
                                    <Label Text="{Binding DashboardStats.Resources.AvailableBeds, StringFormat='Available: {0}'}"
                                           FontSize="12"
                                           Opacity="0.7" />
                                    <Label Text="{Binding DashboardStats.Resources.TotalBeds, StringFormat='Total: {0}'}"
                                           FontSize="12"
                                           Opacity="0.7" />
                                </HorizontalStackLayout>
                            </VerticalStackLayout>

                            <BoxView HeightRequest="1" Color="{AppThemeBinding Light=#E5E7EB, Dark=#374151}" />

                            --><!-- Staff-to-Patient Ratio --><!--
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
                                <VerticalStackLayout Grid.Column="0" Spacing="4">
                                    <Label Text="Staff on Duty"
                                           FontSize="12"
                                           Opacity="0.7" />
                                    <Label Text="{Binding DashboardStats.Resources.TotalStaff}"
                                           FontSize="24"
                                           FontAttributes="Bold"
                                           TextColor="#10B981" />
                                </VerticalStackLayout>

                                <VerticalStackLayout Grid.Column="1" Spacing="4">
                                    <Label Text="Staff:Patient Ratio"
                                           FontSize="12"
                                           Opacity="0.7" />
                                    <Label Text="{Binding DashboardStats.Resources.StaffToPatientRatio, StringFormat='1:{0:F1}'}"
                                           FontSize="24"
                                           FontAttributes="Bold"
                                           TextColor="#3B82F6" />
                                </VerticalStackLayout>
                            </Grid>
                        </VerticalStackLayout>
                    </Border>-->

                </Grid>
            </ScrollView>
        </tabView:SfTabItem>
        
        <tabView:SfTabItem Header="Pending" ImageSource="pending_silent_mute_sound_audio_off_svgrepo.png">
            <views:PendingPatientsView x:Name="PendingPatients" Loaded="PendingPatients_Loaded" />
        </tabView:SfTabItem>

        <tabView:SfTabItem Header="Active" ImageSource="bell_active_svgrepo.png">
            <views:ActivePatientsView x:Name="ActivePatients" Loaded="ActivePatients_Loaded" />
        </tabView:SfTabItem>

        <tabView:SfTabItem Header="Completed" ImageSource="todo_done_svgrepo.png">
            <views:CompletedPatientsView x:Name="CompletedPatients" Loaded="CompletedPatients_Loaded" />
        </tabView:SfTabItem>
    </tabView:SfTabView>
    
</ContentPage>