<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.HomePage"             
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:sf="clr-namespace:Syncfusion.Maui.Toolkit.Charts;assembly=Syncfusion.Maui.Toolkit"
             xmlns:controls="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.Controls"
             xmlns:sfGauge="clr-namespace:Syncfusion.Maui.Gauges;assembly=Syncfusion.Maui.Gauges"
             xmlns:sfCards="clr-namespace:Syncfusion.Maui.Toolkit.Cards;assembly=Syncfusion.Maui.Toolkit"
             xmlns:models="clr-namespace:MAAME.DROMO.PARTOGRAPH.MODEL;assembly=MAAME.DROMO.PARTOGRAPH.MODEL"
             xmlns:pages="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages"
             xmlns:views="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.Views"
             xmlns:tabView="http://schemas.syncfusion.com/maui"
             xmlns:fonts="clr-namespace:Fonts"
             Title="Partograph Dashboard"
             BackgroundColor="{AppThemeBinding Light=#F8FAFC, Dark=#0F172A}">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior EventName="NavigatedTo" Command="{Binding NavigatedToCommand}" />
        <toolkit:EventToCommandBehavior EventName="Appearing" Command="{Binding AppearingCommand}" />
    </ContentPage.Behaviors>

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Modern Card Style -->
            <Style x:Key="ModernCardStyle" TargetType="Border">
                <Setter Property="StrokeThickness" Value="0" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=White, Dark=#1E293B}" />
                <Setter Property="Padding" Value="24" />
                <Setter Property="StrokeShape">
                    <RoundRectangle CornerRadius="20" />
                </Setter>
                <Setter Property="Shadow">
                    <Shadow Brush="{AppThemeBinding Light=#10000000, Dark=#30000000}"
                            Offset="0,8"
                            Radius="24"
                            Opacity="0.15" />
                </Setter>
            </Style>

            <!-- Stat Card Style -->
            <Style x:Key="StatCardStyle" TargetType="sfCards:SfCardView">
                <Setter Property="CornerRadius" Value="8" />
                <Setter Property="BorderWidth" Value="0" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=White, Dark=#1E293B}" />
            </Style>

            <!-- Header Text Style -->
            <Style x:Key="HeaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="32" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}" />
            </Style>

            <!-- Subheader Style -->
            <Style x:Key="SubheaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                <Setter Property="Margin" Value="0,0,0,24" />
            </Style>

            <!-- Metric Number Style -->
            <Style x:Key="MetricNumberStyle" TargetType="Label">
                <Setter Property="FontSize" Value="28" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="Margin" Value="0,8,0,4" />
            </Style>

            <!-- Metric Label Style -->
            <Style x:Key="MetricLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="Opacity" Value="0.8" />
                <Setter Property="Margin" Value="0,0,0,8" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <tabView:SfTabView x:Name="TabView" TabBarHeight="72" EnableSwiping="False" TabBarPlacement="Bottom">
        <tabView:SfTabItem Header="Home" ImagePosition="Top" ImageSource="home_svgrepo.png">
            <ScrollView>
                <Grid RowDefinitions="Auto,Auto,*" Padding="20" RowSpacing="32">

                    <!-- Enhanced Header Section -->
                    <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="Partograph Dashboard" Style="{StaticResource HeaderStyle}" />
                            <HorizontalStackLayout Spacing="12">
                                <Label Text="{Binding Today, StringFormat='{0:dddd, MMMM dd}'}" 
                               Style="{StaticResource SubheaderStyle}" Margin="0,8" />
                                <Border BackgroundColor="#10B981" Padding="8,4" VerticalOptions="Center">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12" />
                                    </Border.StrokeShape>
                                    <HorizontalStackLayout Spacing="4">
                                        <Ellipse Fill="#FFFFFF" WidthRequest="6" HeightRequest="6" />
                                        <Label Text="Live Monitoring" 
                                       FontSize="12" 
                                       FontAttributes="Bold"
                                       TextColor="White" />
                                    </HorizontalStackLayout>
                                </Border>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>

                        <!-- Quick Action FAB -->
                        <controls:AddButton Grid.Column="1"
                                    BackgroundColor="#3B82F6"
                                    WidthRequest="64"
                                    HeightRequest="64"
                                    FontSize="24"
                                    ToolTipProperties.Text="Admit New Patient"
                                    Command="{Binding AddNewPatientCommand}" />
                    </Grid>

                    <!-- Advanced Metrics Grid -->
                    <Grid Grid.Row="1" ColumnDefinitions="*,*" RowDefinitions="*,*" ColumnSpacing="4" RowSpacing="4">
                        <!-- Active Labor -->
                        <sfCards:SfCardView Grid.Column="0" Style="{StaticResource StatCardStyle}" Padding="8">
                            <Grid RowDefinitions="Auto,*,Auto" RowSpacing="8">
                                <Label Grid.Row="0" Text="ACTIVE LABOUR" Style="{StaticResource MetricLabelStyle}" TextColor="#10B981" />

                                <VerticalStackLayout Grid.Row="1" VerticalOptions="Center">
                                    <Label Text="{Binding DashboardStats.ActiveLabor}" 
                                   Style="{StaticResource MetricNumberStyle}"
                                   TextColor="#10B981" />
                                    <HorizontalStackLayout Spacing="4">
                                        <Label Text="â—" FontSize="8" TextColor="#10B981" VerticalOptions="Center" />
                                        <Label Text="Real-time monitoring"
                                       FontSize="11"
                                       TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </Grid>
                            <sfCards:SfCardView.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding NavigateToActivePatientsCommand}" />
                            </sfCards:SfCardView.GestureRecognizers>
                        </sfCards:SfCardView>

                        <!-- Pre-Labor -->
                        <sfCards:SfCardView Grid.Column="1" Style="{StaticResource StatCardStyle}" Padding="8">
                            <Grid RowDefinitions="Auto,*,Auto" RowSpacing="8">
                                <Label Grid.Row="0" Text="PRE-LABOUR" Style="{StaticResource MetricLabelStyle}" TextColor="#F59E0B" />

                                <VerticalStackLayout Grid.Row="1" VerticalOptions="Center">
                                    <Label Text="{Binding DashboardStats.PendingLabor}" 
                                   Style="{StaticResource MetricNumberStyle}"
                                   TextColor="#F59E0B" />
                                    <HorizontalStackLayout Spacing="4">
                                        <Label Text="â–²" FontSize="12" TextColor="#10B981" VerticalOptions="Center" />
                                        <Label Text="+2 admissions today"
                                       FontSize="11"
                                       TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </Grid>
                            <sfCards:SfCardView.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding NavigateToPendingPatientsCommand}" />
                            </sfCards:SfCardView.GestureRecognizers>
                        </sfCards:SfCardView>

                        <!-- Delivered Today -->
                        <sfCards:SfCardView Grid.Column="0" Grid.Row="1" Style="{StaticResource StatCardStyle}" Padding="8">
                            <Grid RowDefinitions="Auto,*,Auto" RowSpacing="8">
                                <Label Grid.Row="0" Text="DELIVERED" Style="{StaticResource MetricLabelStyle}" TextColor="#3B82F6" />

                                <VerticalStackLayout Grid.Row="1" VerticalOptions="Center">
                                    <Label Text="{Binding DashboardStats.CompletedToday}" 
                                   Style="{StaticResource MetricNumberStyle}"
                                   TextColor="#3B82F6" />
                                    <HorizontalStackLayout Spacing="4">
                                        <Label Text="â±" FontSize="10" VerticalOptions="Center" />
                                        <Label Text="{Binding DashboardStats.AvgDeliveryTime, StringFormat='Avg: {0}h'}"
                                       FontSize="11"
                                       TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </Grid>
                            <sfCards:SfCardView.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding NavigateToCompletedPatientsCommand}" />
                            </sfCards:SfCardView.GestureRecognizers>
                        </sfCards:SfCardView>

                        <!-- Emergency Cases -->
                        <sfCards:SfCardView Grid.Column="1" Grid.Row="1" Style="{StaticResource StatCardStyle}" Padding="8">
                            <Grid RowDefinitions="Auto,*,Auto" RowSpacing="8">
                                <Label Grid.Row="0" Text="EMERGENCY" Style="{StaticResource MetricLabelStyle}" TextColor="#EF4444" />

                                <VerticalStackLayout Grid.Row="1" VerticalOptions="Center">
                                    <Label Text="{Binding DashboardStats.EmergencyCases}" 
                                   Style="{StaticResource MetricNumberStyle}"
                                   TextColor="#EF4444" />
                                    <HorizontalStackLayout Spacing="4">
                                        <Label Text="ðŸš¨" FontSize="10" VerticalOptions="Center" />
                                        <Label Text="Immediate attention"
                                       FontSize="11"
                                       TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </Grid>
                            <sfCards:SfCardView.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding NavigateToEmergencyPatientsCommand}" />
                            </sfCards:SfCardView.GestureRecognizers>
                        </sfCards:SfCardView>
                    </Grid>
                </Grid>
            </ScrollView>
        </tabView:SfTabItem>
        
        <tabView:SfTabItem Header="Pending" ImageSource="pending_silent_mute_sound_audio_off_svgrepo.png">
            <views:PendingPatientsView x:Name="PendingPatients" Loaded="PendingPatients_Loaded" />
        </tabView:SfTabItem>

        <tabView:SfTabItem Header="Active" ImageSource="bell_active_svgrepo.png">
            <views:ActivePatientsView x:Name="ActivePatients" Loaded="ActivePatients_Loaded" />
        </tabView:SfTabItem>

        <tabView:SfTabItem Header="Completed" ImageSource="todo_done_svgrepo.png">
            <views:CompletedPatientsView x:Name="CompletedPatients" Loaded="CompletedPatients_Loaded" />
        </tabView:SfTabItem>
    </tabView:SfTabView>
    
</ContentPage>