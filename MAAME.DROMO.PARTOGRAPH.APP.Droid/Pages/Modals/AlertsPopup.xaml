<?xml version="1.0" encoding="utf-8" ?>
<sfPopup:SfPopup AnimationMode='SlideOnTop'
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sfPopup="clr-namespace:Syncfusion.Maui.Popup;assembly=Syncfusion.Maui.Popup"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:Services="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.Services"
             xmlns:pagemodels="clr-namespace:MAAME.DROMO.PARTOGRAPH.APP.Droid.PageModels"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.Modals.AlertsPopup">

    <sfPopup:SfPopup.HeaderTemplate>
        <DataTemplate>
            <Grid ColumnDefinitions="*,Auto" Padding="15,15,15,10">
                <VerticalStackLayout>
                    <Label Text="Clinical Alerts"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#1E293B, Dark=#F8FAFC}" />
                    <Label Text="{Binding AlertSummary}"
                           FontSize="12"
                           TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
                </VerticalStackLayout>
                <Button Grid.Column="1"
                        Text="Clear Acknowledged"
                        Command="{Binding ClearAcknowledgedAlertsCommand}"
                        BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                        TextColor="{AppThemeBinding Light=#333, Dark=White}"
                        FontSize="10"
                        Padding="8,4"
                        CornerRadius="5"
                        VerticalOptions="Center" />
            </Grid>
        </DataTemplate>
    </sfPopup:SfPopup.HeaderTemplate>

    <sfPopup:SfPopup.ContentTemplate>
        <DataTemplate>
            <ScrollView Padding="15,0,15,15">
                <VerticalStackLayout Spacing="10">
                    <!-- No Alerts Message -->
                    <Frame IsVisible="{Binding HasAlerts, Converter={toolkit:InvertedBoolConverter}}"
                           BackgroundColor="{AppThemeBinding Light=#E8F5E9, Dark=#1B5E20}"
                           BorderColor="{AppThemeBinding Light=#4CAF50, Dark=#81C784}"
                           CornerRadius="10"
                           Padding="20">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="10">
                            <Label Text="No Active Alerts"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="{AppThemeBinding Light=#2E7D32, Dark=#A5D6A7}" />
                            <Label Text="All clinical parameters are within normal limits."
                                   FontSize="12"
                                   HorizontalOptions="Center"
                                   TextColor="{AppThemeBinding Light=#388E3C, Dark=#81C784}" />
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Alert List -->
                    <CollectionView ItemsSource="{Binding ActiveAlerts}"
                                    IsVisible="{Binding HasAlerts}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="Services:ClinicalAlert">
                                <Border StrokeThickness="1"
                                        Stroke="{Binding SeverityColor}"
                                        Padding="15"
                                        Margin="0,6">
                                    <Border.Resources>
                                        <Style TargetType="Border">
                                            <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=White, Dark=#2A2A2A}" />
                                            <Style.Triggers>
                                                <DataTrigger TargetType="Border" Binding="{Binding Severity}" Value="Critical">
                                                    <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#FFEBEE, Dark=#450A0A}" />
                                                    <Setter Property="StrokeThickness" Value="2" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Border" Binding="{Binding Severity}" Value="Warning">
                                                    <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#FFF8E1, Dark=#3E2723}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Resources>
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12" />
                                    </Border.StrokeShape>
                                    <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="Auto,*,Auto">
                                        <!-- Icon and Title -->
                                        <Label Grid.Row="0" Grid.Column="0"
                                               Text="{Binding CategoryIcon}"
                                               FontSize="24"
                                               VerticalOptions="Start"
                                               Margin="0,0,12,0" />

                                        <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="2">
                                            <Label Text="{Binding Title}"
                                                   FontSize="16"
                                                   FontAttributes="Bold"
                                                   TextColor="{Binding SeverityColor}" />
                                            <Label Text="{Binding Message}"
                                                   FontSize="13"
                                                   TextColor="{AppThemeBinding Light=#424242, Dark=#EEEEEE}"
                                                   LineBreakMode="WordWrap" />
                                        </VerticalStackLayout>

                                        <Button Grid.Row="0" Grid.Column="2" Grid.RowSpan="2"
                                                Text="ACKNOWLEDGE"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type pagemodels:PartographPageModel}}, Path=AcknowledgeAlertCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="{Binding SeverityColor}"
                                                TextColor="White"
                                                FontSize="11"
                                                FontAttributes="Bold"
                                                Padding="12,6"
                                                CornerRadius="8"
                                                VerticalOptions="Start"
                                                IsVisible="{Binding IsAcknowledged, Converter={toolkit:InvertedBoolConverter}}">
                                            <Button.Shadow>
                                                <Shadow Brush="Black" Offset="0,2" Radius="3" Opacity="0.2" />
                                            </Button.Shadow>
                                        </Button>

                                        <!-- Acknowledged Badge -->
                                        <Border Grid.Row="0" Grid.Column="2"
                                                BackgroundColor="{AppThemeBinding Light=#E8F5E9, Dark=#1B5E20}"
                                                Padding="8,4"
                                                StrokeThickness="0"
                                                StrokeShape="RoundRectangle 6"
                                                IsVisible="{Binding IsAcknowledged}"
                                                VerticalOptions="Start">
                                            <Label Text="Acknowledged"
                                                   FontSize="10"
                                                   TextColor="{AppThemeBinding Light=#2E7D32, Dark=#A5D6A7}" />
                                        </Border>

                                        <!-- Measurement Info -->
                                        <Border Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2"
                                                BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#333333}"
                                                StrokeThickness="0"
                                                Padding="8,4"
                                                Margin="0,8,0,0"
                                                StrokeShape="RoundRectangle 6"
                                                HorizontalOptions="Start"
                                                IsVisible="{Binding MeasurementType, Converter={toolkit:IsNotNullConverter}}">
                                            <HorizontalStackLayout Spacing="8">
                                                <Label Text="{Binding MeasurementType}"
                                                       FontSize="11"
                                                       FontAttributes="Bold"
                                                       TextColor="{AppThemeBinding Light=#616161, Dark=#BDBDBD}" />
                                                <BoxView Color="Gray" WidthRequest="1" HeightRequest="10" VerticalOptions="Center" />
                                                <Label Text="{Binding CurrentValue}"
                                                       FontSize="11"
                                                       FontAttributes="Bold" />
                                                <Label Text="{Binding ExpectedRange, StringFormat='(Target: {0})'}"
                                                       FontSize="11"
                                                       Opacity="0.8" />
                                            </HorizontalStackLayout>
                                        </Border>

                                        <!-- Recommended Actions -->
                                        <VerticalStackLayout Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="2"
                                                             Margin="0,12,0,0"
                                                             IsVisible="{Binding RecommendedActions.Count, Converter={toolkit:CompareConverter ComparisonOperator=Greater, ComparingValue={x:Int32 0}}}">
                                            <Label Text="Recommended Actions:"
                                                   FontSize="11"
                                                   FontAttributes="Bold"
                                                   TextColor="{Binding SeverityColor}"
                                                   Margin="0,0,0,4" />
                                            <CollectionView ItemsSource="{Binding RecommendedActions}">
                                                <CollectionView.ItemTemplate>
                                                    <DataTemplate x:DataType="x:String">
                                                        <HorizontalStackLayout Spacing="6" Margin="0,2">
                                                            <Label Text="*" TextColor="{AppThemeBinding Light=#616161, Dark=#9E9E9E}" FontSize="12" />
                                                            <Label Text="{Binding .}"
                                                                   FontSize="12"
                                                                   TextColor="{AppThemeBinding Light=#212121, Dark=#F5F5F5}" />
                                                        </HorizontalStackLayout>
                                                    </DataTemplate>
                                                </CollectionView.ItemTemplate>
                                            </CollectionView>
                                        </VerticalStackLayout>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </ScrollView>
        </DataTemplate>
    </sfPopup:SfPopup.ContentTemplate>

</sfPopup:SfPopup>
