<?xml version="1.0" encoding="utf-8" ?>
<sfPopup:SfPopup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sfPopup="clr-namespace:Syncfusion.Maui.Popup;assembly=Syncfusion.Maui.Popup"
             xmlns:core="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
             xmlns:editors="clr-namespace:Syncfusion.Maui.Inputs;assembly=Syncfusion.Maui.Inputs"
             xmlns:buttons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
             xmlns:pickers="clr-namespace:Syncfusion.Maui.Picker;assembly=Syncfusion.Maui.Picker"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.Modals.DeliveryMomentPopup">

    <sfPopup:SfPopup.Resources>
        <ResourceDictionary>
            <Style x:Key="SectionTitle" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="Margin" Value="0,10,0,5" />
            </Style>
            <Style x:Key="CheckboxLabel" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="VerticalOptions" Value="Center" />
            </Style>
        </ResourceDictionary>
    </sfPopup:SfPopup.Resources>

    <sfPopup:SfPopup.HeaderTemplate>
        <DataTemplate>
            <StackLayout BackgroundColor="#4CAF50" Padding="15">
                <Label Text="Baby Delivered!"
                       VerticalOptions="Center"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="White" />
                <Label Text="Record delivery details to transition to Third Stage"
                       VerticalOptions="Center"
                       FontSize="12"
                       TextColor="White"
                       Opacity="0.9" />
            </StackLayout>
        </DataTemplate>
    </sfPopup:SfPopup.HeaderTemplate>

    <sfPopup:SfPopup.ContentTemplate>
        <DataTemplate>
            <ScrollView>
                <VerticalStackLayout Padding="15,10" Spacing="10">

                    <!-- Second Stage Summary -->
                    <Border BackgroundColor="#E3F2FD"
                            StrokeThickness="0"
                            Padding="12"
                            IsVisible="{Binding SecondStageSummary, Converter={StaticResource StringNotEmptyConverter}}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="8"/>
                        </Border.StrokeShape>
                        <Label Text="{Binding SecondStageSummary}"
                               FontSize="13"
                               TextColor="#1565C0" />
                    </Border>

                    <!-- Delivery Time -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Delivery Time" Style="{StaticResource SectionTitle}" />
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                            <DatePicker Grid.Column="0"
                                        Date="{Binding DeliveryTime}"
                                        MaximumDate="{x:Static sys:DateTime.Now}"
                                        Format="dd MMM yyyy"
                                        xmlns:sys="clr-namespace:System;assembly=netstandard" />
                            <TimePicker Grid.Column="1"
                                        Time="{Binding DeliveryTimeOfDay}"
                                        Format="HH:mm" />
                        </Grid>
                    </VerticalStackLayout>

                    <!-- Baby Sex -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Baby Sex *" Style="{StaticResource SectionTitle}" />
                        <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                            <Button Grid.Column="0"
                                    Text="Male"
                                    Command="{Binding SelectMaleCommand}"
                                    BackgroundColor="{Binding IsMale, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#2196F3|#E0E0E0'}"
                                    TextColor="{Binding IsMale, Converter={StaticResource BoolToColorConverter}, ConverterParameter='White|#333'}"
                                    HeightRequest="45"
                                    CornerRadius="8" />
                            <Button Grid.Column="1"
                                    Text="Female"
                                    Command="{Binding SelectFemaleCommand}"
                                    BackgroundColor="{Binding IsFemale, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#E91E63|#E0E0E0'}"
                                    TextColor="{Binding IsFemale, Converter={StaticResource BoolToColorConverter}, ConverterParameter='White|#333'}"
                                    HeightRequest="45"
                                    CornerRadius="8" />
                            <Button Grid.Column="2"
                                    Text="Undet."
                                    Command="{Binding SelectUndeterminedCommand}"
                                    BackgroundColor="{Binding SexUndetermined, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#9E9E9E|#E0E0E0'}"
                                    TextColor="{Binding SexUndetermined, Converter={StaticResource BoolToColorConverter}, ConverterParameter='White|#333'}"
                                    HeightRequest="45"
                                    CornerRadius="8" />
                        </Grid>
                    </VerticalStackLayout>

                    <!-- Delivery Mode -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Delivery Mode" Style="{StaticResource SectionTitle}" />
                        <Picker ItemsSource="{Binding DeliveryModes}"
                                SelectedIndex="{Binding DeliveryModeIndex}"
                                Title="Select delivery mode" />
                    </VerticalStackLayout>

                    <!-- Immediate Assessments -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Immediate Assessments" Style="{StaticResource SectionTitle}" />

                        <Border BackgroundColor="#F5F5F5" Padding="12" StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8"/>
                            </Border.StrokeShape>
                            <VerticalStackLayout Spacing="12">
                                <!-- Immediate Cry -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Grid.Column="0"
                                           Text="Immediate cry at birth?"
                                           Style="{StaticResource CheckboxLabel}" />
                                    <Switch Grid.Column="1"
                                            IsToggled="{Binding ImmediateCry}"
                                            OnColor="#4CAF50" />
                                </Grid>

                                <!-- Cord Clamping -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <VerticalStackLayout Grid.Column="0">
                                        <Label Text="Delayed cord clamping (1-3 min)?"
                                               Style="{StaticResource CheckboxLabel}" />
                                        <Label Text="WHO recommended"
                                               FontSize="11"
                                               TextColor="#666" />
                                    </VerticalStackLayout>
                                    <Switch Grid.Column="1"
                                            IsToggled="{Binding CordClampedDelayed}"
                                            OnColor="#4CAF50" />
                                </Grid>

                                <!-- Skin-to-Skin -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <VerticalStackLayout Grid.Column="0">
                                        <Label Text="Skin-to-skin contact initiated?"
                                               Style="{StaticResource CheckboxLabel}" />
                                        <Label Text="WHO recommended within first hour"
                                               FontSize="11"
                                               TextColor="#666" />
                                    </VerticalStackLayout>
                                    <Switch Grid.Column="1"
                                            IsToggled="{Binding SkinToSkinInitiated}"
                                            OnColor="#4CAF50" />
                                </Grid>
                            </VerticalStackLayout>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Validation Message -->
                    <Label Text="{Binding ValidationMessage}"
                           IsVisible="{Binding HasValidationError}"
                           TextColor="#F44336"
                           FontSize="13"
                           HorizontalOptions="Center" />

                    <!-- APGAR Reminder -->
                    <Border BackgroundColor="#FFF3E0"
                            StrokeThickness="0"
                            Padding="12"
                            Margin="0,10,0,0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="8"/>
                        </Border.StrokeShape>
                        <HorizontalStackLayout Spacing="10">
                            <Label Text="!"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="#E65100"
                                   VerticalOptions="Center" />
                            <VerticalStackLayout>
                                <Label Text="APGAR Score Reminders"
                                       FontAttributes="Bold"
                                       TextColor="#E65100"
                                       FontSize="13" />
                                <Label Text="1-minute APGAR will be due shortly after confirmation"
                                       FontSize="12"
                                       TextColor="#E65100" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>
                    </Border>

                    <!-- Action Buttons -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="15" Margin="0,15,0,20">
                        <Button Grid.Column="0"
                            Text="Cancel"
                            Command="{Binding CancelCommand}"
                            BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                            TextColor="{AppThemeBinding Light=#333, Dark=White}"
                            HeightRequest="50"
                            CornerRadius="10" />

                        <Button Grid.Column="1"
                            Text="Confirm Delivery"
                            Command="{Binding ConfirmDeliveryCommand}"
                            BackgroundColor="#4CAF50"
                            TextColor="White"
                            HeightRequest="50"
                            CornerRadius="10"
                            FontAttributes="Bold" />
                    </Grid>

                </VerticalStackLayout>
            </ScrollView>
        </DataTemplate>
    </sfPopup:SfPopup.ContentTemplate>

</sfPopup:SfPopup>
