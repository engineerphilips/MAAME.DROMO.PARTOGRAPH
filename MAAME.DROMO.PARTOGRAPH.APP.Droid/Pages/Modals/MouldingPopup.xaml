<?xml version="1.0" encoding="utf-8" ?>
<sfPopup:SfPopup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sfPopup="clr-namespace:Syncfusion.Maui.Popup;assembly=Syncfusion.Maui.Popup"
             xmlns:core="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
             xmlns:buttons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
             x:Class="MAAME.DROMO.PARTOGRAPH.APP.Droid.Pages.Modals.MouldingPopup">

    <sfPopup:SfPopup.Resources>
        <ResourceDictionary>
            <Color x:Key="PrimaryBlue">#0078D4</Color>
            <!-- Input Styles -->
            <Style x:Key="PatientInput" TargetType="core:SfTextInputLayout">
                <Setter Property="ContainerType" Value="Outlined" />
                <Setter Property="OutlineCornerRadius" Value="8" />
                <Setter Property="Stroke" Value="{StaticResource PrimaryBlue}" />
            </Style>
        </ResourceDictionary>
    </sfPopup:SfPopup.Resources>
    <sfPopup:SfPopup.HeaderTemplate>
        <DataTemplate>
            <Grid BackgroundColor="{StaticResource PrimaryBlue}" Padding="15,12">
                <Label Text="Moulding"
                       VerticalOptions="Center"
                       FontAttributes="Bold"
                       FontSize="18"
                       TextColor="White" />
            </Grid>
        </DataTemplate>
    </sfPopup:SfPopup.HeaderTemplate>
    <sfPopup:SfPopup.ContentTemplate>
        <DataTemplate>
            <ScrollView>
                <VerticalStackLayout Padding="15,10" Spacing="10">
                    <core:SfTextInputLayout Hint="Date"
                                        Style="{StaticResource PatientInput}"
                                        HelperText="Recording time">
                        <DatePicker Date="{Binding RecordingDate}" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Hint="Time"
                                        Style="{StaticResource PatientInput}"
                                        HelperText="Recording time">
                        <TimePicker Time="{Binding RecordingTime}" />
                    </core:SfTextInputLayout>

                    <VerticalStackLayout Padding="10,0,0,0">
                        <Label Text="What is the moulding?" FontAttributes="Bold"/>

                        <buttons:SfSegmentedControl x:Name="segmentedControl" CornerRadius="8" Margin="-10,0,0,0" VisibleSegmentsCount="4" SelectedIndex="{Binding DegreeIndex, Mode=TwoWay}">
                            <buttons:SfSegmentedControl.ItemsSource>
                                <x:Array Type="{x:Type x:String}">
                                    <x:String>0</x:String>
                                    <x:String>+</x:String>
                                    <x:String>++</x:String>
                                    <x:String>+++</x:String>
                                </x:Array>
                            </buttons:SfSegmentedControl.ItemsSource>
                        </buttons:SfSegmentedControl>
                    </VerticalStackLayout>

                    <!-- Measurement History Section -->
                    <Frame IsVisible="{Binding HasHistory}"
                           BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2C2C2C}"
                           BorderColor="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                           CornerRadius="10"
                           Padding="12"
                           Margin="0,5,0,10">
                        <VerticalStackLayout Spacing="8">
                            <Label Text="Previous Measurements"
                                   FontAttributes="Bold"
                                   FontSize="14"
                                   TextColor="{AppThemeBinding Light=#333, Dark=White}" />
                            <CollectionView ItemsSource="{Binding MeasurementHistory}"
                                            HeightRequest="120">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="Auto,*,Auto"
                                              Padding="8,6"
                                              ColumnSpacing="10">
                                            <Frame Grid.Column="0"
                                                   BackgroundColor="#FFF3E0"
                                                   CornerRadius="15"
                                                   Padding="8,4"
                                                   HasShadow="False">
                                                <Label Text="{Binding Value}"
                                                       FontAttributes="Bold"
                                                       FontSize="13"
                                                       TextColor="#E65100"
                                                       VerticalOptions="Center" />
                                            </Frame>
                                            <Label Grid.Column="1"
                                                   Text="{Binding DateTimeDisplay}"
                                                   FontSize="12"
                                                   TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"
                                                   VerticalOptions="Center" />
                                            <Label Grid.Column="2"
                                                   Text="{Binding RecordedBy}"
                                                   FontSize="11"
                                                   FontAttributes="Italic"
                                                   TextColor="{AppThemeBinding Light=#888, Dark=#888}"
                                                   VerticalOptions="Center" />
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Frame>

                    <core:SfTextInputLayout Hint="Additional Notes"
                                        Style="{StaticResource PatientInput}"
                                        HelperText="Any other observations...">
                        <Entry Text="{Binding Notes}"
                           Keyboard="Text"
                           ReturnType="Next" />
                    </core:SfTextInputLayout>

                    <!-- WHO 2020 Enhanced Assessment -->
                    <!--<Label Text="WHO 2020 Detailed Assessment" FontAttributes="Bold" FontSize="16" Margin="0,15,0,5"/>

                    <Label Text="Suture Assessment" FontAttributes="Bold" Margin="0,10,0,5"/>
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10" RowDefinitions="Auto,Auto" RowSpacing="10">
                        <VerticalStackLayout Grid.Row="0" Grid.Column="0">
                            <Label Text="Sutures Overlapping"/>
                            <Switch IsToggled="{Binding SuturesOverlapping}" HorizontalOptions="Start"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Row="0" Grid.Column="1">
                            <Label Text="Reducible"/>
                            <Switch IsToggled="{Binding Reducible}" HorizontalOptions="Start"/>
                        </VerticalStackLayout>
                    </Grid>

                    <core:SfTextInputLayout Hint="Location"
                                        Style="{StaticResource PatientInput}"
                                        HelperText="Anatomical location">
                        <Entry Text="{Binding Location}" Keyboard="Text" />
                    </core:SfTextInputLayout>

                    <Label Text="Affected Sutures" FontAttributes="Bold" Margin="0,10,0,5"/>
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Sagittal"/>
                            <Switch IsToggled="{Binding SagittalSuture}" HorizontalOptions="Start"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Coronal"/>
                            <Switch IsToggled="{Binding CoronalSuture}" HorizontalOptions="Start"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="2">
                            <Label Text="Lambdoid"/>
                            <Switch IsToggled="{Binding LambdoidSuture}" HorizontalOptions="Start"/>
                        </VerticalStackLayout>
                    </Grid>

                    <core:SfTextInputLayout Hint="Severity"
                                        Style="{StaticResource PatientInput}"
                                        HelperText="Mild, Moderate, Severe">
                        <Entry Text="{Binding Severity}" Keyboard="Text" />
                    </core:SfTextInputLayout>

                    <Label Text="Progression" FontAttributes="Bold" Margin="0,10,0,5"/>
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Increasing"/>
                            <Switch IsToggled="{Binding Increasing}" HorizontalOptions="Start"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Reducing"/>
                            <Switch IsToggled="{Binding Reducing}" HorizontalOptions="Start"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="2">
                            <Label Text="Stable"/>
                            <Switch IsToggled="{Binding Stable}" HorizontalOptions="Start"/>
                        </VerticalStackLayout>
                    </Grid>

                    <core:SfTextInputLayout Hint="Progression Rate"
                                        Style="{StaticResource PatientInput}"
                                        HelperText="Rate of change">
                        <Entry Text="{Binding ProgressionRate}" Keyboard="Text" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Hint="First Detected (Date/Time)"
                                        Style="{StaticResource PatientInput}"
                                        HelperText="When first detected">
                        <DatePicker Date="{Binding FirstDetectedTime}" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Hint="Duration (Hours)"
                                        Style="{StaticResource PatientInput}"
                                        HelperText="Duration in hours">
                        <Entry Text="{Binding DurationHours}" Keyboard="Numeric" />
                    </core:SfTextInputLayout>

                    <Label Text="Caput Assessment" FontAttributes="Bold" Margin="0,10,0,5"/>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                        <Label Grid.Column="0" Text="Caput Present" VerticalOptions="Center"/>
                        <Switch Grid.Column="1" IsToggled="{Binding CaputPresent}" HorizontalOptions="Start"/>
                    </Grid>

                    <core:SfTextInputLayout Hint="Caput Degree"
                                        Style="{StaticResource PatientInput}"
                                        HelperText="0, +, ++, +++">
                        <Entry Text="{Binding CaputDegree}" Keyboard="Text" />
                    </core:SfTextInputLayout>

                    <Label Text="Clinical Indicators" FontAttributes="Bold" Margin="0,10,0,5"/>
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Suggests Obstruction"/>
                            <Switch IsToggled="{Binding SuggestsObstruction}" HorizontalOptions="Start"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Suggests CPD"/>
                            <Switch IsToggled="{Binding SuggestsCPD}" HorizontalOptions="Start"/>
                        </VerticalStackLayout>
                    </Grid>

                    <core:SfTextInputLayout Hint="Change From Previous"
                                        Style="{StaticResource PatientInput}"
                                        HelperText="Describe changes">
                        <Entry Text="{Binding ChangeFromPrevious}" Keyboard="Text" />
                    </core:SfTextInputLayout>

                    <core:SfTextInputLayout Hint="Clinical Alert"
                                        Style="{StaticResource PatientInput}"
                                        HelperText="Any alerts or concerns"
                                        ContainerBackground="LightYellow">
                        <Entry Text="{Binding ClinicalAlert}" Keyboard="Text" />
                    </core:SfTextInputLayout>-->

                    <!-- Action Buttons -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="15" Margin="0,20,0,40">
                        <Button Grid.Column="0"
                            Text="Cancel"
                            Command="{Binding CancelCommand}"
                            BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                            TextColor="{AppThemeBinding Light=#333, Dark=White}"
                            HeightRequest="50"
                            CornerRadius="10" />

                        <Button Grid.Column="1"
                            Text="Save Assessment"
                            Command="{Binding SaveCommand}"
                            BackgroundColor="{StaticResource PrimaryBlue}"
                            TextColor="White"
                            HeightRequest="50"
                            CornerRadius="10" />
                    </Grid>

                </VerticalStackLayout>
            </ScrollView>
        </DataTemplate>
    </sfPopup:SfPopup.ContentTemplate>

</sfPopup:SfPopup>
